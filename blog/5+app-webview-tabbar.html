<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mui 初级入门教程（二）— html5+ webview 底部栏用法详解 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/44.487d119d.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>mui 初级入门教程（二）— html5+ webview 底部栏用法详解</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/5%2Bapp-webview-tabbar.html#写在前面" class="sidebar-link">写在前面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/5%2Bapp-webview-tabbar.html#webview-基本知识" class="sidebar-link">webview 基本知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#什么是窗口？什么是-webview" class="sidebar-link">什么是窗口？什么是 webview?</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#创建新的-webview-窗口" class="sidebar-link">创建新的 Webview 窗口</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#显示-webview-窗口" class="sidebar-link">显示 Webview 窗口</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#隐藏-webview-窗口" class="sidebar-link">隐藏 Webview 窗口</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#获取当前窗口的-webviewobject-对象" class="sidebar-link">获取当前窗口的 WebviewObject 对象</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#查找指定标识的-webviewobject-窗口" class="sidebar-link">查找指定标识的 WebviewObject 窗口</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#创建并打开-webview-窗口" class="sidebar-link">创建并打开 Webview 窗口</a></li></ul></li><li><a href="/blog/5%2Bapp-webview-tabbar.html#mui-双-webview-模式" class="sidebar-link">mui 双 webview 模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#页面初始化" class="sidebar-link">页面初始化</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#创建子页面" class="sidebar-link">创建子页面</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#打开新页面" class="sidebar-link">打开新页面</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#关闭页面" class="sidebar-link">关闭页面</a></li></ul></li><li><a href="/blog/5%2Bapp-webview-tabbar.html#项目实战" class="sidebar-link">项目实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#开始写布局文件" class="sidebar-link">开始写布局文件</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#动态页面切换" class="sidebar-link">动态页面切换</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#兼容浏览器的处理办法" class="sidebar-link">兼容浏览器的处理办法</a></li><li class="sidebar-sub-header"><a href="/blog/5%2Bapp-webview-tabbar.html#双首页配置的优化方案" class="sidebar-link">双首页配置的优化方案</a></li></ul></li><li><a href="/blog/5%2Bapp-webview-tabbar.html#后记" class="sidebar-link">后记</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mui-初级入门教程（二）—-html5-webview-底部栏用法详解">mui 初级入门教程（二）— html5+ webview 底部栏用法详解</h1> <h2 id="写在前面">写在前面</h2> <p>本系列文章我们将利用 mui 基于网易云音乐 API 实现一个音乐播放器 APP，同时基于环形或者融云实现聊天功能。作为本系列文章的第一篇，本文会详细讲解 html5+中管理应用窗口界面的 Webview 模块的用法，因为是初级教程篇不过多讲解原理部分，初级用户只需要知道基本用法就可以，并使用 mui.js 中的组件进行页面效果展示。</p> <h2 id="webview-基本知识">webview 基本知识</h2> <blockquote><p>Webview 模块管理应用窗口界面，实现多窗口的逻辑控制管理操作。通过 plus.webview 可获取应用界面管理对象。</p></blockquote> <h3 id="什么是窗口？什么是-webview">什么是窗口？什么是 webview?</h3> <p>这里我们首先来举个例子，大家都用过浏览器，常用的浏览器可以打开多个网页。电脑屏幕就是一个窗口，不同的页面我们可以什么是不同的 webview，我们可以通过控制 webview 的切换从而控制浏览不同的页面。</p> <p>对于我们这里就是一个 html 页面就是一个窗口，一个 html 页面可以创建多个 webview。这个 webview 是原生 APP 中浏览网页的组件，android 和 iOS 都有，html5plus 中的 webview 是对原生 webview 的封装，可以用 js 进行调用，所以它的运行环境是 APP 环境，普通浏览器不支持。</p> <p>首先我们现在 html5plus 官网看一下**<a href="http://www.html5plus.org/doc/zh_cn/webview.html" target="_blank" rel="noopener noreferrer">webview API 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>**,这里我们重点看一下下面几个方法:</p> <h3 id="创建新的-webview-窗口">创建新的 Webview 窗口</h3> <div class="language-js extra-class"><pre class="language-js"><code>WebviewObject plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> url<span class="token punctuation">,</span> id<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> extras <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明:</strong>
创建 Webview 窗口，用于加载新的 HTML 页面，可通过 styles 设置 Webview 窗口的样式，创建完成后需要调用 show 方法才能将 Webview 窗口显示出来。</p> <h3 id="显示-webview-窗口">显示 Webview 窗口</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">void</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>id_wvobj<span class="token punctuation">,</span> aniShow<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> showedCB<span class="token punctuation">,</span> extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明：</strong>
显示已创建或隐藏的 Webview 窗口，需先获取窗口对象或窗口 id，并可指定显示窗口的动画及动画持续时间。</p> <h3 id="隐藏-webview-窗口">隐藏 Webview 窗口</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">void</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>id_wvobj<span class="token punctuation">,</span> aniHide<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> extras<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明：</strong>
根据指定的 WebviewObject 对象或 id 隐藏 Webview 窗口，使得窗口不可见。</p> <h3 id="获取当前窗口的-webviewobject-对象">获取当前窗口的 WebviewObject 对象</h3> <div class="language-js extra-class"><pre class="language-js"><code>WebviewObject plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明：</strong>
获取当前页面所属的 Webview 窗口对象。</p> <h3 id="查找指定标识的-webviewobject-窗口">查找指定标识的 WebviewObject 窗口</h3> <div class="language-js extra-class"><pre class="language-js"><code>WebviewObject plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">getWebviewById</span><span class="token punctuation">(</span> id <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明：</strong>
在已创建的窗口列表中查找指定标识的 Webview 窗口并返回。 若没有查找到指定标识的窗口则返回 null，若存在多个相同标识的 Webview 窗口，则返回第一个创建的 Webview 窗口。 如果要获取应用入口页面所属的 Webview 窗口，其标识为应用的%APPID%，可通过 plus.runtime.appid 获取。</p> <h3 id="创建并打开-webview-窗口">创建并打开 Webview 窗口</h3> <div class="language-js extra-class"><pre class="language-js"><code>WebviewObject plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span> url<span class="token punctuation">,</span> id<span class="token punctuation">,</span> styles<span class="token punctuation">,</span> aniShow<span class="token punctuation">,</span> duration<span class="token punctuation">,</span> showedCB <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>说明：</strong>
创建并显示 Webview 窗口，用于加载新的 HTML 页面，可通过 styles 设置 Webview 窗口的样式，创建完成后自动将 Webview 窗口显示出来。</p> <blockquote><p>以上来源于 html5plus 文档，只列举了部分最常用的方法，旨在为后文做铺垫，由于不是文档，所以也得也不清楚，如果想详细了解请看这里<a href="http://www.html5plus.org/doc/zh_cn/webview.html" target="_blank" rel="noopener noreferrer">html5plus webview API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote> <h2 id="mui-双-webview-模式">mui 双 webview 模式</h2> <p>首先我们要了解 mui 为了解决窗体切换白屏和区域滚动提出的双 webview 模式。</p> <h3 id="页面初始化">页面初始化</h3> <blockquote><p>mui 框架将很多功能配置都集中在<code>mui.init</code>方法中，要使用某项功能，只需要在<code>mui.init</code>方法中完成对应参数配置即可，目前支持在<code>mui.init</code>方法中配置的功能包括：创建子页面、关闭页面、手势事件配置、预加载、下拉刷新、上拉加载、设置系统状态栏背景颜色。mui 需要在页面加载时初始化很多基础控件,如监听返回键,因此务必在每个页面中调用.</p></blockquote> <p><strong>以下是可以配置的参数：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//子页面</span>
  <span class="token literal-property property">subpages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">//...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">//预加载</span>
  <span class="token literal-property property">preloadPages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">//下拉刷新、上拉加载</span>
  <span class="token literal-property property">pullRefresh</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//手势配置</span>
  <span class="token literal-property property">gestureConfig</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//侧滑关闭</span>
  <span class="token literal-property property">swipeBack</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//Boolean(默认false)启用右滑关闭功能</span>

  <span class="token comment">//监听Android手机的back、menu按键</span>
  <span class="token literal-property property">keyEventBind</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">backbutton</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//Boolean(默认truee)关闭back按键监听</span>
    <span class="token literal-property property">menubutton</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//Boolean(默认true)关闭menu按键监听</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//处理窗口关闭前的业务</span>
  <span class="token function-variable function">beforeback</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//... //窗口关闭前处理其他业务详情点击 ↑ &quot;关闭页面&quot;链接查看</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//设置状态栏颜色</span>
  <span class="token literal-property property">statusBarBackground</span><span class="token operator">:</span> <span class="token string">&quot;#9defbcg&quot;</span><span class="token punctuation">,</span> <span class="token comment">//设置状态栏颜色,仅iOS可用</span>
  <span class="token literal-property property">preloadLimit</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token comment">//预加载窗口数量限制(一旦超出,先进先出)默认不限制</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在<code>app</code>开发中，若要使用<code>HTML5+</code>扩展<code>api</code>，必须等<code>plusready</code>事件发生后才能正常使用，mui 将该事件封装成了<code>mui.plusReady()</code>方法，涉及到<code>HTML5+</code>的<code>api</code>，建议都写在<code>mui.plusReady</code>方法中。</p> <p>如下为打印当前页面 URL 的示例：</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;当前页面URL：&quot;</span> <span class="token operator">+</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="创建子页面">创建子页面</h3> <p>在 mobile app 开发过程中，经常遇到卡头卡尾的页面，此时若使用局部滚动，在 android 手机上会出现滚动不流畅的问题； mui 的解决思路是：将需要滚动的区域通过单独的 webview 实现，完全使用原生滚动。具体做法则是：将目标页面分解为主页面和内容页面，主页面显示卡头卡尾区域，比如顶部导航、底部选项卡等；内容页面显示具体需要滚动的内容，然后在主页面中调用 mui.init 方法初始化内容页面。</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">subpages</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span>your<span class="token operator">-</span>subpage<span class="token operator">-</span>url<span class="token punctuation">,</span><span class="token comment">//子页面HTML地址，支持本地地址和网络地址</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span>your<span class="token operator">-</span>subpage<span class="token operator">-</span>id<span class="token punctuation">,</span><span class="token comment">//子页面标志</span>
      <span class="token literal-property property">styles</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span>subpage<span class="token operator">-</span>top<span class="token operator">-</span>position<span class="token punctuation">,</span><span class="token comment">//子页面顶部位置</span>
        <span class="token literal-property property">bottom</span><span class="token operator">:</span>subpage<span class="token operator">-</span>bottom<span class="token operator">-</span>position<span class="token punctuation">,</span><span class="token comment">//子页面底部位置</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span>subpage<span class="token operator">-</span>width<span class="token punctuation">,</span><span class="token comment">//子页面宽度，默认为100%</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span>subpage<span class="token operator">-</span>height<span class="token punctuation">,</span><span class="token comment">//子页面高度，默认为100%</span>
        <span class="token operator">...</span><span class="token operator">...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">extras</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token comment">//额外扩展参数</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>参数说明：</strong>
**styles:**表示窗口属性，参考 5+规范中的 WebviewStyle；特别注意，height 和 width 两个属性,即使不设置，也默认按 100%计算；因此若设置了 top 值为非&quot;0px&quot;的情况，建议同时设置 bottom 值，否则 5+ runtime 根据高度 100%计算，可能会造成页面真实底部位置超出屏幕范围的情况；left、right 同理。</p> <p><strong>示例：Hello mui 的首页其实就是 index.html 加 list.html 合并而成的，如下：</strong></p> <p><img src="https://segmentfault.com/img/remote/1460000005340870" alt></p> <p>index.html 的作用就是显示固定导航，list.html 显示具体列表内容，列表项的滚动是在 list.html 所在 webview 中使用原生滚动，既保证了滚动条不会穿透顶部导航，符合 app 的体验，也保证了列表流畅滚动，解决了区域滚动卡顿的问题。 list.html 就是 index.html 的子页面，创建代码比较简单，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">subpages</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;list.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;list.html&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;45px&quot;</span><span class="token punctuation">,</span> <span class="token comment">//mui标题栏默认高度为45px；</span>
        <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;0px&quot;</span> <span class="token comment">//默认为0px，可不定义；</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="打开新页面">打开新页面</h3> <p>做<code>web app</code>，一个无法避开的问题就是转场动画；<code>web</code>是基于链接构建的，从一个页面点击链接跳转到另一个页面，如果通过有刷新的打开方式，用户要面对一个空白的页面等待；如果通过无刷新的方式，用<code>Javascript</code>移入 DOM 节点（常见的<code>SPA</code>解决方案），会碰到很高的性能挑战：DOM 节点繁多，页面太大，转场动画不流畅甚至导致浏览器崩溃； mui 的解决思路是：单<code>webview</code>只承载单个页面的 dom，减少 dom 层级及页面大小；页面切换使用原生动画，将最耗性能的部分交给原生实现。</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">openWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token operator">-</span>page<span class="token operator">-</span>url<span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span><span class="token keyword">new</span><span class="token operator">-</span>page<span class="token operator">-</span>id<span class="token punctuation">,</span>
    <span class="token literal-property property">styles</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">top</span><span class="token operator">:</span>newpage<span class="token operator">-</span>top<span class="token operator">-</span>position<span class="token punctuation">,</span><span class="token comment">//新页面顶部位置</span>
      <span class="token literal-property property">bottom</span><span class="token operator">:</span>newage<span class="token operator">-</span>bottom<span class="token operator">-</span>position<span class="token punctuation">,</span><span class="token comment">//新页面底部位置</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span>newpage<span class="token operator">-</span>width<span class="token punctuation">,</span><span class="token comment">//新页面宽度，默认为100%</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span>newpage<span class="token operator">-</span>height<span class="token punctuation">,</span><span class="token comment">//新页面高度，默认为100%</span>
      <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">extras</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//自定义扩展参数，可以用来处理页面间传值</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">createNew</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//是否重复创建同样id的webview，默认为false:不重复创建，直接显示</span>
    <span class="token literal-property property">show</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">autoShow</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//页面loaded事件发生后自动显示，默认为true</span>
      <span class="token literal-property property">aniShow</span><span class="token operator">:</span>animationType<span class="token punctuation">,</span><span class="token comment">//页面显示动画，默认为”slide-in-right“；</span>
      <span class="token literal-property property">duration</span><span class="token operator">:</span>animationTime<span class="token comment">//页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">waiting</span><span class="token operator">:</span><span class="token punctuation">{</span>
      <span class="token literal-property property">autoShow</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//自动显示等待框，默认为true</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'正在加载...'</span><span class="token punctuation">,</span><span class="token comment">//等待对话框上显示的提示内容</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span>waiting<span class="token operator">-</span>dialog<span class="token operator">-</span>widht<span class="token punctuation">,</span><span class="token comment">//等待框背景区域宽度，默认根据内容自动计算合适宽度</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span>waiting<span class="token operator">-</span>dialog<span class="token operator">-</span>height<span class="token punctuation">,</span><span class="token comment">//等待框背景区域高度，默认根据内容自动计算合适高度</span>
        <span class="token operator">...</span><span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>参数说明：</strong></p> <ul><li>**styles:**表示窗口参数，<a href="http://www.html5plus.org/doc/zh_cn/webview.html#plus.webview.WebviewStyles" target="_blank" rel="noopener noreferrer">参考 5+规范中的 WebviewStyle<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；特别注意，<code>height</code>和<code>width</code>两个属性,即使不设置，也默认按<code>100%</code>计算；因此若设置了<code>top</code>值为非<code>&quot;0px&quot;</code>的情况，建议同时设置<code>bottom</code>值，否则<code>5+ runtime</code>根据高度<code>100%</code>计算，可能会造成页面真实底部位置超出屏幕范围的情况,<code>left</code>、<code>right</code>同理。</li> <li>**extras:**新窗口的额外扩展参数，可用来处理页面间传值；例如：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> webview <span class="token operator">=</span> mui<span class="token punctuation">.</span><span class="token function">openWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;info.html&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">extras</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mui&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webview<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>控制台会输出&quot;mui&quot;字符串；注意：扩展参数仅在打开新窗口时有效，若目标窗口为预加载页面，则通过 mui.openWindow 方法打开时传递的 extras 参数无效。</p> <ul><li>**createNew:**是否重复创建相同 id 的<code>webview</code>；为优化性能、避免 app 中重复创建 webview，mui v1.7.0 开始增加<code>createNew</code>参数，默认为 false；判断逻辑如下：若 createNew 为 true，则不判断重复，每次都新建<code>webview</code>；若为 fasle，则先计算当前 App 中是否已存在同样 id 的 webview，若存在则直接显示；否则新创建并根据 show 参数执行显示逻辑；该参数可能导致的影响：若业务写在<code>plusReady</code>事件中，而<code>plusReady</code>事件仅首次创建时会触发，则下次再次通过<code>mui.openWindow</code>方法打开同样 webview 时，是不会再次触发<code>plusReady</code>事件的，此时可通过自定义事件触发；案例参考：<code>http://ask.dcloud.net.cn/question/6514</code>;</li> <li>**show:**表示窗口显示控制。autoShow：目标窗口 loaded 事件发生后，是否自动显示；若目标页面为预加载页面，则该参数无效；aniShow 表示页面显示动画，比如从右侧划入、从下侧划入等，具体可参考<a href="http://www.html5plus.org/doc/zh_cn/webview.html#plus.webview.AnimationTypeShow" target="_blank" rel="noopener noreferrer">5+规范中的 AnimationTypeShow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>**waiting:**表示系统等待框；mui 框架在打开新页面时等待框的处理逻辑为：显示等待框--&gt;创建目标页面 webview--&gt;目标页面 loaded 事件发生--&gt;关闭等待框；因此，只有当新页面为新创建页面（webview）时，会显示等待框，否则若为预加载好的页面，则直接显示目标页面，不会显示等待框。waiting 中的参数：autoShow 表示自动显示等待框，默认为 true，若为 false，则不显示等待框；注意：若显示了等待框，但目标页面不自动显示，则需在目标页面中通过如下代码关闭等待框<code>plus.nativeUI.closeWaiting()</code>;。title 表示等待框上的提示文字，options 表示等待框显示参数，比如宽高、背景色、提示文字颜色等，具体可参考<a href="http://www.html5plus.org/doc/zh_cn/nativeui.html#plus.nativeUI.WaitingOptions" target="_blank" rel="noopener noreferrer">5+规范中的 WaitingOption<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <p><strong>示例 1：Hello mui 中，点击首页右上角的图标，会打开关于页面，实现代码如下：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//tap为mui封装的单击事件，可参考手势事件章节</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//打开关于页面</span>
  mui<span class="token punctuation">.</span><span class="token function">openWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;examples/info.html&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&quot;info&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>因没有传入 styles 参数，故默认全屏显示；也没有传入 show 参数，故使用<code>slide-in-right</code>动画，新页面从右侧滑入。</p> <p><strong>示例 2：从 A 页面打开 B 页面，B 页面为一个需要从服务端加载的列表页面，若在 B 页面 loaded 事件发生时就将其显示出来，因服务器数据尚未加载完毕，列表页面为空，用户体验不好；可通过如下方式改善用户体验（最好的用户体验应该是通过预加载的方式）</strong></p> <p>第一步，B 页面 loaded 事件发生后，不自动显示</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//A页面中打开B页面，设置show的autoShow为false，则B页面在其loaded事件发生后，不会自动显示；</span>
mui<span class="token punctuation">.</span><span class="token function">openWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;B.html&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">show</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">autoShow</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第二步，在 B 页面获取列表数据后，再关闭等待框、显示 B 页面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//B页面onload从服务器获取列表数据；</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//从服务器获取数据</span>
  <span class="token operator">...</span><span class="token punctuation">.</span>
  <span class="token comment">//业务数据获取完毕，并已插入当前页面DOM；</span>
  <span class="token comment">//注意：若为ajax请求，则需将如下代码放在处理完ajax响应数据之后；</span>
  mui<span class="token punctuation">.</span><span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//关闭等待框</span>
    plus<span class="token punctuation">.</span>nativeUI<span class="token punctuation">.</span><span class="token function">closeWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//显示当前页面</span>
    mui<span class="token punctuation">.</span>currentWebview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="关闭页面">关闭页面</h3> <p>mui 框架将窗口关闭功能封装在 mui.back 方法中，具体执行逻辑是：若当前 webview 为预加载页面，则 hide 当前 webview；否则，close 当前 webview。</p> <p>在 mui 框架中，有三种操作会触发页面关闭（执行 mui.back 方法）。</p> <ul><li>点击包含.mui-action-back 类的控件</li> <li>在页面上，向右快速滑动</li> <li>Android 手机按下 back 按键</li></ul> <p>hbuilder 中敲 mheader 生成的代码块，会自动生成带有返回导航箭头的标题栏，点击返回箭头可关闭当前页面，原因就是因为该返回箭头包含.mui-action-back 类，代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-bar mui-bar-nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-action-back mui-icon mui-icon-left-nav mui-pull-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>若希望在顶部导航栏之外的其它区域添加关闭页面的控件，只需要在对应控件上添加.mui-action-back 类即可，如下为一个关闭按钮示例：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>mui-btn mui-btn-danger mui-action-back<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>关闭<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>mui 框架封装的页面右滑关闭功能，默认未启用，若要使用右滑关闭功能，需要在<code>mui.init()</code>;方法中设置<code>swipeBack</code>参数，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">swipeBack</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//启用右滑关闭功能</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>mui 框架默认会监听 Android 手机的 back 按键，然后执行页面关闭逻辑； 若不希望 mui 自动处理 back 按键，可通过如下方式关闭 mui 的 back 按键监听；</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">keyEventBind</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">backbutton</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//关闭back按键监听</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>除了如上三种操作外，也可以直接调用<code>mui.back()</code>方法，执行窗口关闭逻辑；<code>mui.back()</code>仅处理窗口逻辑，若希望在窗口关闭之前再处理一些其它业务逻辑，则可将业务逻辑抽象成一个具体函数，然后注册为<code>mui.init</code>方法的<code>beforeback</code>参数;<code>beforeback</code>的执行逻辑为：</p> <p>执行<code>beforeback</code>参数对应的函数若返回 false，则不再执行 mui.back()方法；否则（返回 true 或无返回值），继续执行 mui.back()方法；</p> <p>示例：从列表打开详情页面，从详情页面再返回后希望刷新列表界面，此时可注册 beforeback 参数，然后通过自定义事件通知列表页面刷新数据，示例代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>mui<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">beforeback</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获得列表界面的webview</span>
    <span class="token keyword">var</span> list <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">getWebviewById</span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//触发列表界面的自定义事件（refresh）,从而进行数据刷新</span>
    mui<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">&quot;refresh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回true，继续页面关闭逻辑</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：<code>beforeback</code>的执行返回必须是同步的（阻塞模式），若使用<code>nativeUI</code>这种异步 js（非阻塞模式），则可能会出现意想不到的结果；比如：通过<code>plus.nativeUI.confirm()</code>弹出确认框，可能用户尚未选择，页面已经返回了（<code>beforeback</code>同步执行完毕，无返回值，继续执行<code>mui.back()</code>方法，<code>nativeUI</code>不会阻塞 js 进程）：在这种情况下，若要自定义业务逻辑，就需要复写<code>mui.back</code>方法了；如下为一个自定义示例，每次都需要用户确认后，才会关闭当前页面。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//备份mui.back，mui.back已将窗口关闭逻辑封装的比较完善（预加载及父子窗口），因此最好复用mui.back</span>
<span class="token keyword">var</span> old_back <span class="token operator">=</span> mui<span class="token punctuation">.</span>back<span class="token punctuation">;</span>
mui<span class="token punctuation">.</span><span class="token function-variable function">back</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> btn <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;确定&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;取消&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  mui<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">&quot;确认关闭当前窗口？&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello MUI&quot;</span><span class="token punctuation">,</span> btn<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//执行mui封装好的窗口关闭逻辑；</span>
      <span class="token function">old_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>注意：自定义关闭逻辑时，一定要重写<code>mui.back</code>，不能简单通过<code>addEventListener</code>增加 back 按键监听， 因为<code>addEventListener</code>只会增加新的执行逻辑，老的监听逻辑依然会执行；</p> <h2 id="项目实战">项目实战</h2> <p>这个系列的教程我准备带大家一起实现音乐播放器和即时通讯的功能,先上图不多说：
<img src="http://i.imgur.com/ZUU01cb.jpg" alt></p> <p>开始的页面效果很简单，就是一个 tab bar 页面切换组件，我们重点讲解实现方法，至于美化是后面的事。在开始项目之前我先抄了文档的内容，不是为了凑内容，只是想让新手在开始项目之前还是多看看基本概念，俗话说磨刀不误砍柴工，我们对 mui 的设计思路有一定了解之后写起来才能得心应手。</p> <p>相信大家对于<code>mui</code>的双<code>webview</code>模式有初步认识，我们可以分析一下我们接下来要做的这个的实际例子，首先我们的入口文件<code>index.html</code>是一个包括头部和底部的导航栏的<code>webview</code>,中间是一个动态的<code>webview</code>，我们通过点击底部导航栏进行页面切换，并且动态的改变顶部导航栏的内容。</p> <p>下面我们新建一个 mui 项目，这里我命名为 M-BOX：</p> <ul><li>点击【文件】=》【新建】=》【移动 APP】</li> <li>设置应用名称、文件存储路径、选择模板
<img src="http://i.imgur.com/1YeZtIP.png" alt></li> <li>js,css,fonts 文件的详细介绍请戳这里<a href="https://zhaomenghuan.gitbooks.io/mui/content/1-1.html" target="_blank" rel="noopener noreferrer">手把手教你开发 HelloWord<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>**<a href="http://ask.dcloud.net.cn/docs/#http://ask.dcloud.net.cn/article/483" target="_blank" rel="noopener noreferrer">HBuilder 对前端代码的调试方式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>**这个是很重要的一个部分，限于篇幅，这里不能讲解，请自己看教程。</li></ul> <h3 id="开始写布局文件">开始写布局文件</h3> <p>相信很多人看了前面那么多文档介绍内心肯定是崩溃的，其实我也是，毕竟写了那么多还没有开始写代码我也是拒绝的，只是考虑到很多新手对于找文档这事不一定有经验，那还是先贴一下，大不了回过头再去看咯。
<img src="http://i.imgur.com/RbeJl2R.gif" alt></p> <p>好，那我们开始写布局文件：</p> <p>在<a href="http://ask.dcloud.net.cn/article/122" target="_blank" rel="noopener noreferrer">MUI 开发注意事项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这篇文章中提到了几个重要的注意事项，我们在一个就注意一下会比较好，这里不再一一详细列举了，读者自己去看。</p> <p>文章中 DOM 结构提到：</p> <ul><li>固定栏靠前</li></ul> <p>所谓的固定栏，也就是带有.mui-bar 属性的节点，都是基于 fixed 定位的元素；常见组件包括：顶部导航栏（.mui-bar-nav）、底部工具条(.mui-bar-footer)、底部选项卡（.mui-bar-tab）;这些元素使用时需遵循一个规则：放在.mui-content 元素之前，即使是底部工具条和底部选项卡，也要放在.mui-content 之前，否则固定栏会遮住部分主内容；</p> <ul><li>一切内容都要包裹在 mui-content 中</li></ul> <p>除了固定栏之外，其它内容都要包裹在.mui-content 中，否则就有可能被固定栏遮罩，原因：固定栏基于 Fixed 定位，不受流式布局限制，普通内容依然会从 top:0 的位置开始布局，这样就会被固定栏遮罩，mui 为了解决这个问题，定义了如下 css 代码：</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.mui-bar-nav ~ .mui-content</span> <span class="token punctuation">{</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.mui-bar-footer ~ .mui-content</span> <span class="token punctuation">{</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.mui-bar-tab ~ .mui-content</span> <span class="token punctuation">{</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们这里重点看这两条规则，因为这个对于我们正确布局是至关重要的。</p> <p>下面我们体验一下<code>hbuilder</code>的代码块功能，在<code>index.html</code>文件的<code>body</code>之间输入<code>mheader</code>，回车试试。</p> <p>哈哈，页面头部出来了，不错，这里我们然后删除下面的：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-action-back mui-icon mui-icon-left-nav mui-pull-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>先去掉返回箭头。</p> <p>然后继续输入<code>mtab</code>,回车，底部导航栏也出来了，我们修改一下导航栏的内容,把代码稍微调整一下。整体代码如下：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>M-BOX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>css/mui.min.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-bar mui-bar-nav<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-bar mui-bar-tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-item mui-active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html/home.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-icon mui-icon-home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html/message.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-icon mui-icon-chatboxes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>消息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>html/setting.html<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-icon mui-icon-gear<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mui-tab-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>设置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>js/mui.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>;
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
     <span class="token comment">// 初始化mui.init()写在这里</span>
	</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>首页的静态布局我们写完了，我们接下来新建三个含 mui 的 html 文件：</p> <ul><li>选择工程名，邮件就可以看到【新建】，然后就是选择【目录】新建文件夹和【html 文件】新建含 mui 的 html 文件。我们新建一个文件夹<code>html</code>，并且在 html 文件夹下新建，<code>home.html</code>，<code>message.html</code>,<code>setting.html</code>。</li> <li>在三个页面<code>body</code>之间分别输入<code>mbody</code>,就可以开始分别写页面了，比如可以先在页面上写上文件名，我们先来完善首页的子页切换逻辑。</li></ul> <h3 id="动态页面切换">动态页面切换</h3> <h4 id="_1-创建子页面，首个选项卡页面显示，其它均隐藏">1.创建子页面，首个选项卡页面显示，其它均隐藏</h4> <p>主要方法就是用<code>plus.webview.create</code>和<code>plus.webview.hide();</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//设置默认打开首页显示的子页序号；</span>
<span class="token keyword">var</span> Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//把子页的路径写在数组里面</span>
<span class="token keyword">var</span> subpages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;html/home.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;html/message.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;html/setting.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//所有的plus-*方法写在mui.plusReady中或者后面。</span>
mui<span class="token punctuation">.</span><span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//获取当前页面所属的Webview窗口对象</span>
  <span class="token keyword">var</span> self <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//创建webview子页</span>
    <span class="token keyword">var</span> sub <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
      subpages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//子页url</span>
      subpages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//子页id</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;45px&quot;</span><span class="token punctuation">,</span> <span class="token comment">//设置距离顶部的距离</span>
        <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;50px&quot;</span> <span class="token comment">//设置距离底部的距离</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如不是我们设置的默认的子页则隐藏，否则添加到窗口中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> Index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sub<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//将webview对象填充到窗口</span>
    self<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注：如果 Index 不是 0，需要将 nav 下的 a 标签中的<code>.mui-active</code>属性写到对应的 a 标签下。</p> <p>执行完我们会发现 home.html 的内容显示出来了，但是底部切换还不能，因为这里我们还没有监听底部的点击事件。在进行下一步之前，我们可以先做一个小实验，将上面的代码中的 top 或者 bottom 改为 0,我们会发现，底部栏或者底部栏会被覆盖，这是因为 mui 一个重要的<strong>潜规则</strong>，<strong>父子结构的页面子页面会比父页面层级高</strong>，说白了就是子页面可以盖住父页面。这会导致开发者常犯的一个错误：将弹出层或者弹出菜单写在父页面被子页面盖住的 bug。</p> <blockquote><p>这里的 apend()方法在 html5plus 文档中没有提到，这里的这个方法是将 webview 对象填充到窗口的方法。</p></blockquote> <h4 id="_2-选项卡点击事件">2.选项卡点击事件</h4> <p>mui 内部封装了一些常用的方法，其中 DOM 选择器、事件绑定等事件管理。具体可以参考文档：<a href="http://dev.dcloud.net.cn/mui/util/#selector" target="_blank" rel="noopener noreferrer">选择器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="http://dev.dcloud.net.cn/mui/event/" target="_blank" rel="noopener noreferrer">事件管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <blockquote><p>mui()</p></blockquote> <p>mui 使用 css 选择器获取 HTML 元素，返回 mui 对象数组。</p> <ul><li><code>mui(&quot;p&quot;)</code>：选取所有<code>p</code>元素</li> <li><code>mui(&quot;p.title&quot;)</code>：选取所有包含<code>.title</code>类的<code>&lt;p&gt;</code>元素</li></ul> <p>若要将 mui 对象转化成 dom 对象，可使用如下方法（类似 jquery 对象转成 dom 对象）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//obj1是mui对象</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">&quot;#title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//obj2是dom对象</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>.on( event , selector , handler )</p></blockquote> <ul><li>event</li> <li>Type: String</li> <li>需监听的事件名称，例如：'tap'</li> <li>selector</li> <li>Type: String -选择器</li> <li>handler</li> <li>Type: Function( Event event )</li> <li>事件触发时的回调函数，通过回调中的 event 参数可以获得事件详情</li></ul> <p>除了可以使用 addEventListener()方法监听某个特定元素上的事件外， 也可以使用.on()方法实现批量元素的事件绑定。</p> <p>这里我们将为底部导航按钮添加事件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//选项卡点击事件</span>
<span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-bar-tab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当我们点击底部选项卡的时候会弹出<code>true</code>，这不够，我们要能够分辨当前对象具体是哪一个，有两种思路:</p> <ul><li>第一我们能够知道当前点击的 a 标签所在序号就好了，就是找到<code>index</code>,然后根据上面那个<code>subpages</code>数组，利用<code>plus.webview.show(subpages[index])</code>方法显示。</li> <li>我们给当前点击的 a 标签添加一个可以识别的属性，然后根据那个属性获取当前 a 的特征，然后就可以显示点击的子页，隐藏当前子页。</li></ul> <p>第一种方法需要遍历此案获取<code>index</code>，第二种方法添加一个<code>href</code>很容易拿到子页<code>id</code>，我们采用第二种方案。</p> <blockquote><p>getAttribute()</p></blockquote> <p>getAttribute() 方法返回指定属性名的属性值。提示：如果您希望以<code>Attr</code>对象返回属性，请使用<code>getAttributeNode</code>。</p> <p>于是我们可以这样写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//当前激活选项</span>
<span class="token keyword">var</span> activeTab <span class="token operator">=</span> subpages<span class="token punctuation">[</span>Index<span class="token punctuation">]</span><span class="token punctuation">,</span>
  title <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选项卡点击事件</span>
<span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-bar-tab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//获取目标子页的id</span>
  <span class="token keyword">var</span> targetTab <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetTab <span class="token operator">==</span> activeTab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//更换标题</span>
  title<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-tab-label&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
  <span class="token comment">//显示目标选项卡</span>
  plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>targetTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//隐藏当前选项卡</span>
  plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>activeTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//更改当前活跃的选项卡</span>
  activeTab <span class="token operator">=</span> targetTab<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="兼容浏览器的处理办法">兼容浏览器的处理办法</h3> <p>这是后面补充的内容，最开始写的时候没有这个内容，在这里加上吧。为啥要加这个内容呢，因为很多人思维还是比较局限，用 mui 依然还是用原来的方法，有很多人依然使用 href,之所以这么用就是大家改不了习惯，这就是被很多人说的坑。。。但是真的是坑吗？与其说是坑，我觉得是大家思维上没有转变过来，不明白 mui 为啥要禁用 href 这种方式，也不明白自己该怎么做。</p> <p>下面贴出一个用 iframe 代替多子 webview 形式的 tabbar 在浏览器的兼容处理方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">createIframe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> opt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> elContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-iframe-wrapper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建wrapper 和 iframe</span>
    wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;mui-iframe-wrapper&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> opt<span class="token punctuation">.</span>style<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wrapper<span class="token punctuation">.</span>style<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> opt<span class="token punctuation">.</span>style<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> opt<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>id <span class="token operator">=</span> opt<span class="token punctuation">.</span>id <span class="token operator">||</span> opt<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>name <span class="token operator">=</span> opt<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> iframe <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> opt<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>id <span class="token operator">=</span> opt<span class="token punctuation">.</span>id <span class="token operator">||</span> opt<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span>name <span class="token operator">=</span> iframe<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>调用也很简单：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//当前激活选项</span>
<span class="token keyword">var</span> activeTab <span class="token operator">=</span> subpages<span class="token punctuation">[</span>Index<span class="token punctuation">]</span><span class="token punctuation">,</span>
  title <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-bar-tab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取目标子页的id</span>
  <span class="token keyword">var</span> targetTab <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetTab <span class="token operator">==</span> activeTab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 更换标题</span>
  title<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-tab-label&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>
  <span class="token comment">// 子页内容切换</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mui<span class="token punctuation">.</span>os<span class="token punctuation">.</span>plus<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 显示目标webview</span>
    plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span>targetTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 隐藏当前webview</span>
    plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>activeTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 更改当前活跃的选项卡</span>
    activeTab <span class="token operator">=</span> targetTab<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建iframe代替子页面</span>
    <span class="token function">createIframe</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-content&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> targetTab<span class="token punctuation">,</span>
      <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;45px&quot;</span><span class="token punctuation">,</span> <span class="token comment">//设置距离顶部的距离</span>
        <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;50px&quot;</span> <span class="token comment">//设置距离底部的距离</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样你就可以一套代码实现在多平台的利用啦，是不是很棒。完整代码可以看这里：
<a href="https://rawgit.com/zhaomenghuan/mui-demo/master/example/tabbar-with-iframe/tab-webview-main.html" target="_blank" rel="noopener noreferrer">iframe 兼容处理 tababr 的方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="双首页配置的优化方案">双首页配置的优化方案</h3> <p>HBuilder8.0.1 版更新说明 App 中有一条：
<strong>【重要】新增双首页配置（manifest-&gt;plus-&gt;secondwebview），加速首页为双 webview 模式时的应用启动速度。</strong>
这对于我们优化 app 很有帮助，以前的方案中父子页面都在启动页，首页显示会过慢，8.0 后的这次大更新可以很好的处理这个问题，官方配置说明见：<a href="http://ask.dcloud.net.cn/article/1196" target="_blank" rel="noopener noreferrer">【示例】双首页 secondwebview 配置的使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,但是官方文档中没有说明父子页的配置方法，这里给出一种方案：</p> <p>1.按照文档配置 manifest.json 文件中的 secondwebview 节点 2.将动态创建子页面放在点击事件中，例如：</p> <p>manifest.json 文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>
<span class="token string-property property">&quot;secondwebview&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;launch_path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_www/html/home.html&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;html/home.html&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;top&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0px&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;bottom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;51px&quot;</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre></div><p>首页的逻辑：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> subpages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;html/home.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;html/message.html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;html/person.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> subpage_style <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&quot;0px&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&quot;51px&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 当前激活选项</span>
<span class="token keyword">var</span> activeTab <span class="token operator">=</span> subpages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 创建子页面，首个选项卡页面显示，其它均隐藏；</span>
<span class="token keyword">var</span> currentWebview<span class="token punctuation">;</span>
mui<span class="token punctuation">.</span><span class="token function">plusReady</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentWebview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> secondWebview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">getSecondWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentWebview<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>secondWebview<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 选项卡点击事件</span>
<span class="token function">mui</span><span class="token punctuation">(</span><span class="token string">&quot;.mui-bar-tab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;tap&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> targetTab <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>targetTab <span class="token operator">==</span> activeTab<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">var</span> targetWebview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">getWebviewById</span><span class="token punctuation">(</span>targetTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetWebview<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    targetWebview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>targetTab<span class="token punctuation">,</span> targetTab<span class="token punctuation">,</span> subpage_style<span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentWebview<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>targetWebview<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  targetWebview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">&quot;fade-in&quot;</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 隐藏当前;</span>
  plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span>activeTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 更改当前活跃的选项卡</span>
  activeTab <span class="token operator">=</span> targetTab<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="后记">后记</h2> <p>虽然最后实现的效果很简单，好像直接看 demo 就可以写出来，但是新手甚至写了一段时间的同学也不见得对<code>webview</code>掌握得很好，这篇文章花了很长的篇幅去讲解<code>webview</code>的用法，旨在为新手建立一种学习 mui 这边的思路，那就是先看 html5plus 里面的模块，然后看 mui 对应的文档，最后看<code>hello mui</code>的<code>demo</code>,把握这种学习路线个人觉得是一种最佳的方案。本文作为系列文章第一篇讲代码的，所以做了很多铺垫，所以有一定基础的同学可能会觉得写得并没有什么看点，后面的肯定会有所不一样的。下一篇讲解的是网络请求<code>XMLHttpRequest</code>模块，下一讲会结合<code>mui.ajax</code>和网易云音乐<code>API</code>一起讲解。</p> <p>mui-demo 仓库地址：</p> <blockquote><p>https://github.com/zhaomenghuan/mui-demo</p></blockquote> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/44.487d119d.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
