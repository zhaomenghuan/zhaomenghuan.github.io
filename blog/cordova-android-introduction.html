<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cordova 研习笔记(一) —— 初试牛刀之 cordova.js 概要 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/55.80aa3d86.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>cordova 研习笔记(一) —— 初试牛刀之 cordova.js 概要</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/cordova-android-introduction.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/cordova-android-introduction.html#创建第一个-app" class="sidebar-link">创建第一个 App</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_1-安装-cordova-cli" class="sidebar-link">1.安装 Cordova CLI</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_2-新建项目" class="sidebar-link">2.新建项目</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_3-添加平台" class="sidebar-link">3.添加平台</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_4-构建-app" class="sidebar-link">4.构建 App</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_5-运行-app" class="sidebar-link">5.运行 App</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_6-安装插件" class="sidebar-link">6.安装插件</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_7-平台为中心的工作流开发-app" class="sidebar-link">7.平台为中心的工作流开发 App</a></li></ul></li><li><a href="/blog/cordova-android-introduction.html#自定义插件开发" class="sidebar-link">自定义插件开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_1-安装-plugman-，使用-plugman-创建插件模板" class="sidebar-link">1.安装 plugman ，使用 plugman 创建插件模板</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_2-修改配置文件" class="sidebar-link">2.修改配置文件</a></li><li class="sidebar-sub-header"><a href="/blog/cordova-android-introduction.html#_3-导入到平台工程中的目录结构" class="sidebar-link">3.导入到平台工程中的目录结构</a></li></ul></li><li><a href="/blog/cordova-android-introduction.html#android-插件开发指南" class="sidebar-link">Android 插件开发指南</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/cordova-android-introduction.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="cordova-研习笔记-一-——-初试牛刀之-cordova-js-概要">cordova 研习笔记(一) —— 初试牛刀之 cordova.js 概要</h1> <h2 id="前言">前言</h2> <p>来新公司的第一个任务，研究 hybrid App 中间层实现原理，做中间层插件开发。这个任务挺有意思，也很有挑战性，之前在 DCloud 虽然做过 5+ App 开发，但是中间层的东西确实涉及不多。本系列文章属于系列开篇 cordova 学习笔记，本文主要是从零开始搭建一个 cordova 工程，并了解 cordova 开发的基本内容。</p> <h2 id="创建第一个-app">创建第一个 App</h2> <p>Apache Cordova 是一个开源的移动开发框架。允许你用标准的 web 技术-HTML5,CSS3 和 JavaScript 做跨平台开发。 应用在每个平台的具体执行被封装了起来，并依靠符合标准的 API 绑定去访问每个设备的功能，比如说：传感器、数据、网络状态等。</p> <p><img src="http://upload-images.jianshu.io/upload_images/1945738-7927196c17c8bee2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cordova应用架构"></p> <p>Cordova 官网：http://cordova.apache.org/
Cordova 中文网：http://cordova.axuer.com/
Cordova 中文站：http://www.cordova.org.cn/</p> <h3 id="_1-安装-cordova-cli">1.安装 Cordova CLI</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install <span class="token operator">-</span>g cordova
</code></pre></div><p>安装完成可以通过<code>cordova -v</code>查看版本号，本文是在 V6.5.0 下构建。</p> <h3 id="_2-新建项目">2.新建项目</h3> <div class="language-js extra-class"><pre class="language-js"><code>cordova create <span class="token operator">&lt;</span><span class="token constant">PATH</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token constant">ID</span> <span class="token punctuation">[</span><span class="token constant">NAME</span> <span class="token punctuation">[</span><span class="token constant">CONFIG</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>
</code></pre></div><p><strong>Create a Cordova project：</strong></p> <ul><li>PATH —— 项目路径</li> <li>ID —— app 包名 - used in <code>&lt;widget id&gt;</code></li> <li>NAME —— app 名称</li> <li>CONFIG —— 配置文件地址 json string whose key/values will be included in [PATH]/.cordova/config.json</li></ul> <p><strong>Options：</strong></p> <ul><li><code>--template=&lt;PATH|NPM PACKAGE|GIT URL&gt;</code> ... use a custom template located locally, in NPM, or GitHub.</li> <li><code>--copy-from|src=&lt;PATH&gt;</code> .................. deprecated, use --template instead.</li> <li><code>--link-to=&lt;PATH&gt;</code> ........................ symlink to custom www assets without creating a copy.</li></ul> <p><strong>Example：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>cordova create hello<span class="token operator">-</span>cordova io<span class="token punctuation">.</span>zhaomenghuan HelloCordova
</code></pre></div><p>这将会为你的 cordova 应用创造必须的目录。默认情况下，cordova create 命令生成基于 web 的应用程序的骨骼，项目的主页是 www/index.html 文件。</p> <p><img src="http://upload-images.jianshu.io/upload_images/1945738-d58f8fe035702f11.png" alt="图为创建好的项目"></p> <h3 id="_3-添加平台">3.添加平台</h3> <p>所有后续命令都需要在项目目录或者项目目录的任何子目录运行：</p> <div class="language-js extra-class"><pre class="language-js"><code>cd hello<span class="token operator">-</span>cordova
</code></pre></div><p>给你的 App 添加目标平台。我们将会添加<code>ios</code>和<code>android</code>平台，并确保他们保存在了 config.xml 中：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova platform add ios <span class="token operator">--</span>save
cordova platform add android <span class="token operator">--</span>save
</code></pre></div><p>运行<code>add</code>或者<code>remove</code>平台的命令将会影响项目<code>platforms</code>的内容，在这个目录中每个指定平台都有一个子目录。</p> <blockquote><p>注意：在你使用 CLI 创建应用的时候， 不要 修改 <code>/platforms/</code> 目录中的任何文件。当准备构建应用或者重新安装插件时这个目录通常会被重写。</p></blockquote> <p>检查你当前平台设置状况：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova platform is

Installed platforms<span class="token operator">:</span>
  android <span class="token number">6.1</span><span class="token number">.2</span>
Available platforms<span class="token operator">:</span>
  amazon<span class="token operator">-</span>fireos <span class="token operator">~</span><span class="token number">3.6</span><span class="token number">.3</span> <span class="token punctuation">(</span>deprecated<span class="token punctuation">)</span>
  blackberry10 <span class="token operator">~</span><span class="token number">3.8</span><span class="token number">.0</span>
  browser <span class="token operator">~</span><span class="token number">4.1</span><span class="token number">.0</span>
  firefoxos <span class="token operator">~</span><span class="token number">3.6</span><span class="token number">.3</span>
  webos <span class="token operator">~</span><span class="token number">3.7</span><span class="token number">.0</span>
  windows <span class="token operator">~</span><span class="token number">4.4</span><span class="token number">.0</span>
  wp8 <span class="token operator">~</span><span class="token number">3.8</span><span class="token number">.2</span> <span class="token punctuation">(</span>deprecated<span class="token punctuation">)</span>
</code></pre></div><p>安装构建先决条件：要构建和运行 App，你需要安装每个你需要平台的 SDK。另外，当你使用浏览器开发你可以添加 browser 平台，它不需要任何平台 SDK。</p> <p>检测你是否满足构建平台的要求：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova requirements

Requirements check results <span class="token keyword">for</span> <span class="token literal-property property">android</span><span class="token operator">:</span>
Java <span class="token constant">JDK</span><span class="token operator">:</span> installed <span class="token number">1.8</span><span class="token number">.0</span>
Android <span class="token constant">SDK</span><span class="token operator">:</span> installed <span class="token boolean">true</span>
Android target<span class="token operator">:</span> installed android<span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">17</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">21</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">22</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">23</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">,</span>android<span class="token operator">-</span><span class="token number">25</span>
<span class="token literal-property property">Gradle</span><span class="token operator">:</span> installed
</code></pre></div><p>初次使用我们可能会遇到下面的报错：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">Error</span><span class="token operator">:</span> Failed to find <span class="token string">'ANDROID_HOME'</span> environment variable<span class="token punctuation">.</span> Try setting setting it manually<span class="token punctuation">.</span>
Failed to find <span class="token string">'android'</span> command <span class="token keyword">in</span> your <span class="token string">'PATH'</span><span class="token punctuation">.</span> Try update your <span class="token string">'PATH'</span> to include path to valid <span class="token constant">SDK</span> directory<span class="token punctuation">.</span>
</code></pre></div><p>这是因为我们没有配置环境变量：</p> <ul><li>设置 JAVA_HOME 环境变量，指定为 JDK 安装路径</li> <li>设置 ANDROID_HOME 环境变量，指定为 Android SDK 安装路径</li> <li>添加 Android SDK 的 tools 和 platform-tools 目录到你的 PATH</li></ul> <p>对于 android 平台下的环境配置在这里不再赘述，具体可以参考：</p> <ul><li><a href="http://cordova.axuer.com/docs/zh-cn/latest/guide/platforms/android/index.html#requirements-and-support" target="_blank" rel="noopener noreferrer">Android 平台的要求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://cordova.axuer.com/docs/zh-cn/latest/guide/platforms/ios/index.html#requirements-and-support" target="_blank" rel="noopener noreferrer">iOS 平台的要求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://cordova.axuer.com/docs/zh-cn/latest/guide/platforms/win8/index.html#requirements-and-support" target="_blank" rel="noopener noreferrer">Windows 平台的要求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_4-构建-app">4.构建 App</h3> <p>默认情况下, cordova create 生产基于 web 应用程序的骨架，项目开始页面位于 www/index.html
  文件。任何初始化任务应该在 www/js/index.js 文件中的<a href="http://cordova.axuer.com/docs/zh-cn/latest/cordova/events/events.html#deviceready" target="_blank" rel="noopener noreferrer">deviceready<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>事件的事件处理函数中。</p> <p>运行下面命令为所有添加的平台构建：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova build
</code></pre></div><p>你可以在每次构建中选择限制平台范围 - 这个例子中是<code>android</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova build android
</code></pre></div><p><img src="http://upload-images.jianshu.io/upload_images/1945738-78cb7f353967a07e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p> <p>注意：首次使用时，命令行提示 <code>Downloading https://services.gradle.org/distributions/gradle-2.14.1-all.zip</code>，是在下载对应的 gradle 并自动解压安装，根据网络状况，可能耗时极长，且容易报错。</p> <p>使用 Cordova 编译 Android 平台程序提示：Could not reserve enough space for 2097152KB object heap。</p> <div class="language- extra-class"><pre class="language-text"><code>Error occurred during initialization of VM
Could not reserve enough space for 2097152KB object heap
</code></pre></div><p>大体的意思是系统内存不够用，创建 VM 失败。试了网上好几种方法都不行，最后这个方法可以了：</p> <p>开始-&gt;控制面板-&gt;系统-&gt;高级设置-&gt;环境变量-&gt;系统变量新建变量，变量名: JAVA_OPTIONS 变量值: -Xmx512M</p> <h3 id="_5-运行-app">5.运行 App</h3> <p>我们有多种方式运行我们的 App，在不同场景下使用不同的方式有助于我们快速开发和测试我们的应用。</p> <p>在命令行运行下面的命令，会重新构建 App 并可以在特定平台的模拟器上查看：</p> <div class="language- extra-class"><pre class="language-text"><code>cordova emulate android
</code></pre></div><p>你可以将你的手机插入电脑，在手机上直接测试 App：</p> <div class="language- extra-class"><pre class="language-text"><code>cordova run android
</code></pre></div><p>在进行打包操作前，我们可以通过创建一个本地服务预览 app UI，使用指定的端口或缺省值为 8000 运行本地 Web 服务器 www/assets。访问项目：<a href="http://HOST_IP:PORT/PLATFORM/www" target="_blank" rel="noopener noreferrer">http://HOST_IP:PORT/PLATFORM/www<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language- extra-class"><pre class="language-text"><code>cordova serve [port]
</code></pre></div><p>参考文档：</p> <ul><li><a href="http://cordova.axuer.com/docs/zh-cn/latest/guide/platforms/android/index.html#setting-up-an-emulator" target="_blank" rel="noopener noreferrer">设置 Android 模拟器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://cordova.axuer.com/docs/zh-cn/latest/reference/cordova-cli/index.html#cordova-run-command" target="_blank" rel="noopener noreferrer">Cordova run 命令参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://cordova.axuer.com/docs/zh-cn/latest/reference/cordova-cli/index.html#cordova-emulate-command" target="_blank" rel="noopener noreferrer">Cordova emulate 命令参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_6-安装插件">6.安装插件</h3> <p>cordova 的强大之处在于我们可以通过安装插件，拓展我们 web 工程的能力，比如调用系统底层 API 来调用设备上的底层功能，如摄像头、相册。通过<code>cordova plugin</code>命令实现插件管理。</p> <p>可以在这里搜索需要的插件：<a href="http://cordova.apache.org/plugins/" target="_blank" rel="noopener noreferrer">Cordova Plugins<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。</p> <div class="language- extra-class"><pre class="language-text"><code>cordova {plugin | plugins} [
    add &lt;plugin-spec&gt; [..] {--searchpath=&lt;directory&gt; | --noregistry | --link | --save | --browserify | --force} |
    {remove | rm} {&lt;pluginid&gt; | &lt;name&gt;} --save |
    {list | ls} |
    search [&lt;keyword&gt;] |
    save |
]
</code></pre></div><p>添加插件：</p> <div class="language- extra-class"><pre class="language-text"><code>cordova plugin add &lt;plugin-spec&gt; [...]
</code></pre></div><p>移除插件：</p> <div class="language- extra-class"><pre class="language-text"><code>cordova plugin remove [...]
</code></pre></div><h3 id="_7-平台为中心的工作流开发-app">7.平台为中心的工作流开发 App</h3> <p>上面我们是在跨平台(CLI)的工作流进行，原则上如果我们不需要自己写原生层自定义组件，我们完全可以只在 CLI 上完成我们的工作，当然如果需要进一步深入了解 cordova native 与 js 的通信联系，我们需要切换到平台为中心的工作流，即将我们的 cordova 工程导入到原生工程。例如：我们可以使用 android studio 导入我们新建的 cordova 工程。</p> <p><img src="http://upload-images.jianshu.io/upload_images/1945738-e718f512d81ccd41.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p> <h2 id="自定义插件开发">自定义插件开发</h2> <p><a href="http://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html" target="_blank" rel="noopener noreferrer">自定义插件开发官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>官方推荐的插件遵循相同的目录结构，根目录下是<code>plugin.xml</code>配置文件，src 目录下放平台原生代码，www 下放 js 接口代码，基本配置方法和代码结构由一定规律，我们使用 plugman 可以生成一个插件模板，改改就可以写一个自定义插件。</p> <h3 id="_1-安装-plugman-，使用-plugman-创建插件模板">1.安装 plugman ，使用 plugman 创建插件模板</h3> <div class="language- extra-class"><pre class="language-text"><code>npm install -g plugman
</code></pre></div><p>比如这里我们创建一个 nativeUI 的插件：</p> <div class="language- extra-class"><pre class="language-text"><code>plugman create --name NativeUI --plugin_id cordova-plugin-nativeui --plugin_version 0.0.1
</code></pre></div><p>参数介绍：
pluginName: 插件名字：NativeUI
pluginID: 插件 id : cordova-plugin-nativeui
oversion: 版本 : 0.0.1
directory:一个绝对或相对路径的目录，该目录将创建插件项目
variable NAME=VALUE: 额外的描述，如作者信息和相关描述</p> <p>进入插件目录</p> <div class="language- extra-class"><pre class="language-text"><code>cd NativeUI
</code></pre></div><p>给 plugin.xml 增加 Android 平台</p> <div class="language- extra-class"><pre class="language-text"><code>plugman platform add --platform_name android
</code></pre></div><p>生成的插件文件结构为：</p> <div class="language- extra-class"><pre class="language-text"><code>NativeUI：

├── src
    └── android
        └── NativeUI.java
├── www
    └── NativeUI.js
└── plugin.xml
</code></pre></div><h3 id="_2-修改配置文件">2.修改配置文件</h3> <p><code>plugin.xml</code>文件字段含义：</p> <table><thead><tr><th style="text-align:center">元素</th> <th style="text-align:left">描述</th></tr></thead> <tbody><tr><td style="text-align:center">plugin</td> <td style="text-align:left">定义命名空间，ID 和插件版本。应该用定义在<em>http://apache.org/cordova/ns/plugins/1.0</em>命名空间。plugin 的 ID 在输入<em>cordova plugins</em>命令时在插件列表中显示。</td></tr> <tr><td style="text-align:center">name</td> <td style="text-align:left">定义插件的名字。</td></tr> <tr><td style="text-align:center">description</td> <td style="text-align:left">定义插件的描述信息。</td></tr> <tr><td style="text-align:center">author</td> <td style="text-align:left">定义插件作者的名字。</td></tr> <tr><td style="text-align:center">keywords</td> <td style="text-align:left">定义与插件相关的关键字。Cordova 研发组建立了公开、可搜索的插件仓库，添加的关键字能在你把插件提交到仓库后帮助被发现。</td></tr> <tr><td style="text-align:center">license</td> <td style="text-align:left">定义插件的许可。</td></tr> <tr><td style="text-align:center">engines</td> <td style="text-align:left">用来定义插件支持的 Cordova 版本。再添加<em>engine</em>元素定义每个支持的 Cordova 版本。</td></tr> <tr><td style="text-align:center">js-module</td> <td style="text-align:left">指 js 文件名，而这个文件会自动以<code>&lt;script</code>&gt;标签的形式添加到 Cordova 项目的起始页。通过在<em>js-module</em>中列出插件，可以减少开发者的工作。</td></tr> <tr><td style="text-align:center">info</td> <td style="text-align:left">它是另一个除了<em>description</em>外说插件信息的地方。</td></tr></tbody></table> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cordova-plugin-nativeui<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.0.1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://apache.org/cordova/ns/plugins/1.0<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>NativeUI<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>js-module</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NativeUI<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>www/NativeUI.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>clobbers</span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>agree.nativeUI<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>js-module</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>platform</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config-file</span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>res/xml/config.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>NativeUI<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cn.com.agree.nativeui.NativeUI<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config-file</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>config-file</span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AndroidManifest.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>config-file</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source-file</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/android/NativeUI.java<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target-dir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>src/cn/com/agree/nativeui<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>platform</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这个配置文件有几个地方很关键，一开始没有认真看，将插件导进工程跑的时候各种问题，十分头痛，不得不重新认真看看<a href="http://cordova.axuer.com/docs/zh-cn/6.x/plugin_ref/spec.html" target="_blank" rel="noopener noreferrer">plugin.xml 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <ul><li>id：原则上没有严格规定，参考官方插件写法，这里我也写的是<code>cordova-plugin-nativeui</code>，通过 plugman 创建插件模板的时候需要指定。</li> <li>name：插件名称。</li> <li>clobbers-&gt;target：用于指定插入 module.exports 的窗口对象下的命名空间，也就是用户调用该插件时的 js 层暴露的顶层对象。这个很关键，虽然可以任意指定，但是涉及到我们调用插件的属性或者方法，所以需要特别关注。plugman 默认生成的是将 id 中的<code>-</code>转换成`.'的对象。这里需要说明的是我们可以写多个 js-module，每个 js-module 下可以指定不同的 clobbers。</li> <li>feature -&gt; param - &gt; value 标识了实际提供服务的 Native 类别名称，这里直接定位至具体类，然而上述通过 plugman 生成模板的时候中没有指定 NativeUI 的包名，会自定生成<code>cordova-plugin-nativeui.NativeUI</code>，这里我们需要改成符合自己要求的类名，如我这里使用公司的域名：<code>cn.com.agree.nativeui.NativeUI</code>。需要说明的是这里的类名可以与插件名称不同。</li> <li>source-file -&gt; target-dir 同理<code>target-dir</code>需要修改为： <code>src/cn/com/agree/nativeui</code>，同时需要修改平台下的 native 部分的代码：如：<code>package cn.com.agree.nativeui;</code></li> <li>platform -&gt; config-file 下可以指定程序所需的权限<code>uses-permission</code>，如：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;config-file target=&quot;AndroidManifest.xml&quot; parent=&quot;/*&quot;&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
&lt;/config-file&gt;
</code></pre></div><h3 id="_3-导入到平台工程中的目录结构">3.导入到平台工程中的目录结构</h3> <p>这里我们以 android 平台为例：</p> <p><img src="http://upload-images.jianshu.io/upload_images/1945738-e4a0597e40ed7d32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p> <p>cordova.js 在创建 Android 工程的时候，是从 cordova 的 lib 目录下 Copy 到<code>platforms\android\assets\www\cordova.js</code>的。同时备份到<code>platforms\android\platform_www\cordova.js</code>。下一篇文章我会试着读一下 cordova.js 的源码，这里对 cordova.js 暂不做深入探究。</p> <p>这里我们主要关心几个地方，我们的原生代码在 src 目录下，assets/www 目录下是我们的 web 程序。www 目录下的 plugins 文件夹就是我们的插件 js 部分，cordova_plugins.js 是根据 plugins 文件夹的内容生成的。</p> <p>cordova_plugins.js 的整体结构：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'cordova/plugin_list'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cordova-plugin-nativeui.NativeUI&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;plugins/cordova-plugin-nativeui/www/NativeUI.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;pluginId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cordova-plugin-nativeui&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;clobbers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;agree.nativeUI&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>metadata <span class="token operator">=</span>
<span class="token comment">// TOP OF METADATA</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&quot;cordova-plugin-nativeui&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// BOTTOM OF METADATA</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="android-插件开发指南">Android 插件开发指南</h2> <p>Android 插件基于 Cordova-Android，它是基于具有 Javscript-to-native 桥接的 Android WebView 构建的。 Android 插件的本机部分至少包含一个扩展 CordovaPlugin 类的 Java 类，并重写其一个执行方法。</p> <blockquote><p><strong>插件类映射</strong></p></blockquote> <p>插件的 JavaScript 接口使用 cordova.exec 方法，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>successFunction<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>failFunction<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>service<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>action<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>args<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>function(winParam) {}: 成功回调</li> <li>function(error) {}: 错误回调</li> <li>&quot;service&quot;: 原生层服务名称</li> <li>&quot;action&quot;: js 层调用方法名</li> <li>[arguments]: js 层传递到原生层的数据</li></ul> <p>这将 WebView 的请求传递给 Android 本机端，有效地在服务类上调用 action 方法，并在 args 数组中传递其他参数。无论您将插件分发为 Java 文件还是作为自己的 jar 文件，必须在 Cordova-Android 应用程序的 res / xml / config.xml 文件中指定该插件。 有关如何使用 plugin.xml 文件注入此要素的详细信息，请参阅应用程序插件：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;service_name&gt;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;full_name_including_namespace&gt;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p><strong>插件初始化及其生命周期</strong></p></blockquote> <p>一个插件对象的一个实例是为每个 WebView 的生命创建的。 插件不会被实例化，直到它们被 JavaScript 的调用首次引用为止，除非在 config.xml 中将具有 onload name 属性的</p><param>设置为“true”。<p></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>feature</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Echo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android-package<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>&lt;full_name_including_namespace&gt;<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>feature</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>插件使用 initialize 初始化启动：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">CordovaInterface</span> cordova<span class="token punctuation">,</span> <span class="token class-name">CordovaWebView</span> webView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>cordova<span class="token punctuation">,</span> webView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// your init code here</span>
<span class="token punctuation">}</span>
</code></pre></div><p>插件还可以访问 Android 生命周期事件，并可以通过扩展所提供的方法（onResume，onDestroy 等）来处理它们。 具有长时间运行请求的插件，媒体播放，侦听器或内部状态等背景活动应实现 onReset() 方法。 当 WebView 导航到新页面或刷新时，它会执行，这会重新加载 JavaScript。</p> <blockquote><p><strong>编写 Android Java 插件</strong></p></blockquote> <p>一个 JavaScript 调用触发对本机端的插件请求，并且相应的 Java 插件在 config.xml 文件中正确映射，但最终的 Android Java Plugin 类是什么样的？ 使用 JavaScript 的 exec 函数发送到插件的任何东西都被传递到插件类的 execute 方法中。</p> <p>插件的 JavaScript 不会在 WebView 界面的主线程中运行; 而是在 WebCore 线程上运行，执行方法也是如此。 如果需要与用户界面进行交互，应该使用 Activity 的 runOnUiThread 方法。</p> <p>如果不需要在 UI 线程上运行，但不希望阻止 WebCore 线程，则应使用<code>cordova.getThreadPool()</code>获得的<code>Cordova ExecutorService</code>执行代码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">String</span> action<span class="token punctuation">,</span> <span class="token class-name">JSONArray</span> args<span class="token punctuation">,</span> <span class="token class-name">CallbackContext</span> callbackContext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JSONException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;toast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Builds and shows a native Android toast with given Strings
 *
 * @param message The message the toast should display
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">toast</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">CordovaInterface</span> cordova <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cordova<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> message<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> duration <span class="token operator">=</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">;</span>
        <span class="token class-name">Runnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Toast</span> toast <span class="token operator">=</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>cordova<span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
                toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        cordova<span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>js 部分的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> exec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cordova/exec'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">toast</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'NativeUI'</span><span class="token punctuation">,</span> <span class="token string">'toast'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>callbackContext.success</code>可以将原生层字符串作为参数传递给 JavaScript 层的成功回调，<code>callbackContext.error</code>可以将给 JavaScript 层的错误回调函数传递参数。</p> <blockquote><p><strong>添加依赖库</strong></p></blockquote> <p>如果你的 Android 插件有额外的依赖关系，那么它们必须以两种方式之一列在 plugin.xml 中：</p> <ul><li>首选的方法是使用<framework></framework>标签（有关详细信息，请参阅插件规范）。以这种方式指定库可以通过 Gradle 的依赖管理逻辑来解决。这允许诸如 gson，android-support-v4 和 google-play-services 之类的常用库被多个插件使用而没有冲突。</li> <li>第二个选项是使用<lib-file></lib-file>标签来指定 jar 文件的位置（有关更多详细信息，请参阅插件规范）。 只有当您确定没有其他插件将依赖于您所引用的库（例如，该库特定于您的插件）时，才应使用此方法。 否则，如果另一个插件添加了相同的库，则可能导致插件用户造成构建错误。 值得注意的是，Cordova 应用程序开发人员不一定是本地开发人员，因此本地平台构建错误可能特别令人沮丧。</li></ul> <blockquote><p><strong>Android 集成</strong></p></blockquote> <p>Android 具有 Intent 系统，允许进程相互通信。插件可以访问 CordovaInterface 对象，可以访问运行应用程序的 Android Activity。 这是启动新的 Android Intent 所需的上下文。 CordovaInterface 允许插件为结果启动 Activity，并为 Intent 返回应用程序时设置回调插件。</p> <p>从 Cordova 2.0 开始，插件无法再直接访问上下文，并且旧的 ctx 成员已被弃用。 所有的 ctx 方法都存在于 Context 中，所以 getContext()和 getActivity()都可以返回所需的对象。</p> <blockquote><p><strong>运行权限（Cordova-Android 5.0.0+）</strong></p></blockquote> <p>Android 6.0 &quot;Marshmallow&quot; 引入了新的权限模型，用户可以根据需要启用和禁用权限。这意味着应用程序必须将这些权限更改处理为将来，这是 Cordova-Android 5.0.0 发行版的重点。</p> <p>就插件而言，可以通过调用权限方法来请求权限，该签名如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span>CordovaPlugin plugin<span class="token punctuation">,</span> int requestCode<span class="token punctuation">,</span> String permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为了减少冗长度，将此值分配给本地静态变量是标准做法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">READ</span> <span class="token operator">=</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">READ_CONTACTS</span><span class="token punctuation">;</span>
</code></pre></div><p>定义 requestCode 的标准做法如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">SEARCH_REQ_CODE</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre></div><p>然后，在 exec 方法中，应该检查权限：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>cordova<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token constant">READ</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">search</span><span class="token punctuation">(</span>executeArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">getReadPermission</span><span class="token punctuation">(</span><span class="token constant">SEARCH_REQ_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这种情况下，我们只需调用 requestPermission：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">getReadPermission</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cordova<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> requestCode<span class="token punctuation">,</span> <span class="token constant">READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这将调用该活动并引起提示出现要求该权限。 一旦用户拥有权限，结果必须使用 onRequestPermissionResult 方法处理，每个插件应该覆盖该方法。 一个例子可以在下面找到：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JSONException</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token operator">:</span>grantResults<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_DENIED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbackContext<span class="token punctuation">.</span><span class="token function">sendPluginResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PluginResult</span><span class="token punctuation">(</span><span class="token class-name">PluginResult<span class="token punctuation">.</span>Status</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">,</span> <span class="token constant">PERMISSION_DENIED_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token constant">SEARCH_REQ_CODE</span><span class="token operator">:</span>
            <span class="token function">search</span><span class="token punctuation">(</span>executeArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">SAVE_REQ_CODE</span><span class="token operator">:</span>
            <span class="token function">save</span><span class="token punctuation">(</span>executeArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">REMOVE_REQ_CODE</span><span class="token operator">:</span>
            <span class="token function">remove</span><span class="token punctuation">(</span>executeArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的 switch 语句将从提示符返回，并且根据传入的 requestCode，它将调用该方法。 应该注意的是，如果执行不正确地处理权限提示可能会堆叠，并且应该避免这种情况。</p> <p>除了要求获得单一权限的权限之外，还可以通过定义权限数组来请求整个组的权限，如同 Geolocation 插件所做的那样：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> permissions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">ACCESS_COARSE_LOCATION</span><span class="token punctuation">,</span>
  <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">ACCESS_FINE_LOCATION</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>然后当请求权限时，需要完成的所有操作如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>cordova<span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这将请求数组中指定的权限。 提供公开访问的权限阵列是一个好主意，因为可以使用插件作为依赖关系使用，尽管这不是必需的。</p> <blockquote><p><strong>启动其他活动</strong></p></blockquote> <p>如果你的插件启动将 Cordova 活动推送到后台的活动，则需要特别考虑。 如果设备运行内存不足，Android 操作系统将在后台销毁活动。在这种情况下，CordovaPlugin 实例也将被销毁。 如果您的插件正在等待其启动的活动的结果，则当 Cordova 活动返回到前台并获得结果时，将创建一个新的插件实例。 但是，插件的状态不会自动保存或恢复，插件的 CallbackContext 将丢失。 CordovaPlugin 可以实现两种方法来处理这种情况：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * Called when the Activity is being destroyed (e.g. if a plugin calls out to an
 * external Activity and the OS kills the CordovaActivity in the background).
 * The plugin should save its state in this method only if it is awaiting the
 * result of an external Activity and needs to preserve some information so as
 * to handle that result; onRestoreStateForActivityResult() will only be called
 * if the plugin is the recipient of an Activity result
 *
 * @return  Bundle containing the state of the plugin or null if state does not
 *          need to be saved
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Bundle</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">/**
 * Called when a plugin is the recipient of an Activity result after the
 * CordovaActivity has been destroyed. The Bundle will be the same as the one
 * the plugin returned in onSaveInstanceState()
 *
 * @param state             Bundle containing the state of the plugin
 * @param callbackContext   Replacement Context to return the plugin result to
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRestoreStateForActivityResult</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> state<span class="token punctuation">,</span> <span class="token class-name">CallbackContext</span> callbackContext<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h2 id="总结">总结</h2> <p>cordova 是否能够发挥出它出彩的一面还是源于我们对原生的熟练程度，只有对原生足够熟练，对 cordova 的运行机制足够熟悉才能做出一个相对比较令人满意的 App，后面的文章我会尝试阅读 cordova 的源码，深入解析 cordova 的实现原理和插件机制，也会教大家封装一些常用的自定义组件。本文内容基本取材于官方文档，只是借助谷歌翻译以及自己在探索过程中的一些问题，做了一些增删，如果有任何问题，希望各位不吝指教。</p> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/55.80aa3d86.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
