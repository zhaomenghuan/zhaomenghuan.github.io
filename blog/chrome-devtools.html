<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解 Chrome DevTools | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/7.a2cd9d6c.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>深入理解 Chrome DevTools</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/chrome-devtools.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/chrome-devtools.html#chrome-devtools" class="sidebar-link">Chrome DevTools</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/chrome-devtools.html#chrome-extension" class="sidebar-link">Chrome Extension</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/chrome-devtools.html#chrome-devtools-extensions" class="sidebar-link">Chrome DevTools Extensions</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/chrome-devtools.html#chrome-devtools-protocol" class="sidebar-link">Chrome DevTools Protocol</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/chrome-devtools.html#electron-集成-devtools" class="sidebar-link">Electron 集成 DevTools</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/chrome-devtools.html#setdevtoolswebcontents" class="sidebar-link">setDevToolsWebContents</a></li><li class="sidebar-sub-header"><a href="/blog/chrome-devtools.html#remote-debugging" class="sidebar-link">Remote Debugging</a></li><li class="sidebar-sub-header"><a href="/blog/chrome-devtools.html#定制-inspector" class="sidebar-link">定制 Inspector</a></li></ul></li><li><a href="/blog/chrome-devtools.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="深入理解-chrome-devtools">深入理解 Chrome DevTools</h1> <h2 id="前言">前言</h2> <p>在移动端 H5 开发过程中经常会使用 Chrome DevTools 工具进行代码调试，之前对于 Chrome DevTools 底层原理的理解一直比较碎片化也比较浅，对很多概念例如 Chrome 调试协议、远程调试、Chrome 拓展等本质理解不够深入，本文尝试从新手角度从 0 到 1 去探索 Chrome DevTools 的常用用法。</p> <p>根据过去的使用经验，本文我尝试带着这几个问题去探索其中的答案：</p> <ul><li>1.Chrome DevTools 及微信小程序开发工具是如何实现模拟器与开发者工具元素面板进行联动交互？</li> <li>2.Chrome Inspect 是如何实现 Android/iOS 移动设备 WebView 视图与到 Chrome 开发者工具面板联动交互？</li> <li>3.如何实现例如 vue-devtools 的 Chrome DevTools 的拓展，且和 Chrome 拓展有什么区别？</li> <li>4.Stetho 类似的调试工具的工作原理是什么，为什么能够将 Native App 中的网络、存储等信息在 Chrome 上展示？</li></ul> <p>冥冥之中总觉得这几个问题有某种联系，但是又不能直接说出其中的本质联系，或许当我们搞清楚其中的联系与区别，再回头看这几个问题就会有种“原来如此”的感觉。</p> <h2 id="chrome-devtools">Chrome DevTools</h2> <p>Chrome 开发者工具 (Chrome DevTools) 是一套内置于 Google Chrome 中的 Web 开发和调试工具，可用来对网站进行迭代、调试和分析。</p> <ul><li>Chrome DevTools 官方文档：<a href="https://developers.google.com/web/tools/chrome-devtools?hl=zh-cn" target="_blank" rel="noopener noreferrer">https://developers.google.com/web/tools/chrome-devtools?hl=zh-cn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Chrome DevTools 是辅助开发者进行 Web 开发的重要调试工具，DevTools 是 Chromium 的一部分，可以作为独立项目被 Electron 等容器集成。DevTools 主要分为四部分：</p> <ul><li><a href="https://github.com/ChromeDevTools/devtools-frontend/wiki/Frontend" target="_blank" rel="noopener noreferrer">Frontend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：调试器前端，默认由 Chromium 内核层集成</li> <li><a href="https://github.com/ChromeDevTools/devtools-frontend/wiki/Chromium-Backend" target="_blank" rel="noopener noreferrer">Backend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：调试器后端，<a href="https://cs.chromium.org/chromium/src/third_party/blink/renderer/core/inspector/" target="_blank" rel="noopener noreferrer">Chromium<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、V8 或 Node.js</li> <li><a href="https://chromedevtools.github.io/devtools-protocol" target="_blank" rel="noopener noreferrer">Protocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：调试协议</li> <li><a href="https://github.com/ChromeDevTools/devtools-frontend/wiki/Message-Channels" target="_blank" rel="noopener noreferrer">Message Channels<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：消息通道，包括：Embedder Channel、WebSocket Channel、Chrome Extensions Channel、USB/ADB Channel</li></ul> <p>Chrome DevTools Frontend 是一个 Web 应用程序，通过 WebSocket 与 Blink 的 C++ 后端通信。</p> <p>Chrome DevTools Frontend 部分的资料：</p> <ul><li>官方仓库：<a href="https://github.com/ChromeDevTools/devtools-frontend" target="_blank" rel="noopener noreferrer">https://github.com/ChromeDevTools/devtools-frontend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>官方文档：<a href="https://chromedevtools.github.io/source-docs/index.html" target="_blank" rel="noopener noreferrer">https://chromedevtools.github.io/source-docs/index.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Chrome 开发者工具中有一个非常重要的概念是「面板」，主要有以下几个面板：</p> <table><thead><tr><th style="text-align:center">面板</th> <th style="text-align:center">作用</th></tr></thead> <tbody><tr><td style="text-align:center">设备模式</td> <td style="text-align:center">使用设备模式可以模拟移动设备视口、限制网络流量、限制 CPU 占用率、模拟地理定位、设置屏幕方向备</td></tr> <tr><td style="text-align:center">元素面板</td> <td style="text-align:center">使用元素面板可以自由的操作 DOM 和 CSS 来迭代布局和设计页面</td></tr> <tr><td style="text-align:center">控制台面板</td> <td style="text-align:center">在开发期间，可以使用控制台面板记录诊断信息，或者使用它作为 shell在页面上与JavaScript交互</td></tr> <tr><td style="text-align:center">源代码面板</td> <td style="text-align:center">在源代码面板中设置断点来调试 JavaScript ，或者通过 Workspaces（工作区）连接本地文件来使用开发者工具的实时编辑器</td></tr> <tr><td style="text-align:center">网络面板</td> <td style="text-align:center">使用网络面板了解请求和下载的资源文件并优化网页加载性能</td></tr> <tr><td style="text-align:center">性能面板</td> <td style="text-align:center">使用性能面板可以通过记录和查看网站生命周期内发生的各种事件来提高页面的运行时性能</td></tr> <tr><td style="text-align:center">内存面板</td> <td style="text-align:center">如果需要比时间轴面板提供的更多信息，可以使用“配置”面板，例如跟踪内存泄漏</td></tr> <tr><td style="text-align:center">应用面板</td> <td style="text-align:center">使用资源面板检查加载的所有资源，包括IndexedDB与Web SQL数据库，本地和会话存储，cookie，应用程序缓存，图像，字体和样式表</td></tr> <tr><td style="text-align:center">安全面板</td> <td style="text-align:center">使用安全面板调试混合内容问题，证书问题等等</td></tr></tbody></table> <p>关于 Chrome 开发者工具的详细使用可以看官方文档，本文不做赘述。Chrome DevTools Extensions 基于 Javascript、CSS、HTML 技术构建可以让用户根据业务需要为 DevTools 增强扩展功能项。当 Chrome DevTools 不能满足我们需求的时候，我们可以写一个 Chrome DevTools Extension，类似于 vue-devtools。</p> <p><img src="/assets/img/vue-devtools.62358a0c.png" alt></p> <p>目前主流小程序平台针对小程序特有的技术特征，基于 Chrome DevTools Extensions 进行扩展及改造，赋能小程序开发的各种调试能力。</p> <h2 id="chrome-extension">Chrome Extension</h2> <p>官方文档及示例如下：</p> <ul><li>Chrome Extensions: <a href="https://developer.chrome.com/extensions" target="_blank" rel="noopener noreferrer">https://developer.chrome.com/extensions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Sample Extensions: <a href="https://developer.chrome.com/extensions/samples" target="_blank" rel="noopener noreferrer">https://developer.chrome.com/extensions/samples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>因为 Chrome DevTools Extension 属于 Chrome Extension 中的一种特殊的拓展程序。在了解 Chrome DevTools Extension 之前，我们先简单的了解一下 Chrome Extension(Chrome 拓展)的内容。</p> <p>我们经常说的 Chrome “插件”，其实不是真正意义上的 Chrome Plug-in，一般是指 Chrome Extension(简称“拓展”)。</p> <ul><li>扩展（Extension），指的是通过调用 Chrome 提供的 Chrome API 来扩展浏览器功能的一种组件，工作在浏览器层面，使用 HTML + Javascript 语言开发。</li> <li>插件（Plug-in），指的是通过调用 Webkit 内核 NPAPI/PPAPI 来扩展内核功能的一种组件，工作在内核层面，理论上可以用任何一种生成本地二进制程序的语言开发，比如 C/C++、Delphi 等。比如 Flash player 插件，就属于这种类型。一般在网页中用 <code>&lt;object&gt;</code> 或者 <code>&lt;embed&gt;</code> 标签声明的部分，就要靠插件来渲染。</li></ul> <p>Chrome 拓展一般包含如下几个组件：</p> <ul><li>Manifest</li> <li>Background Script</li> <li>UI Elements</li> <li>Content Script</li> <li>Options Page</li> <li>DevTools</li></ul> <p>Chrome Extension 架构图：</p> <p><img src="/assets/img/extension-architecture.8fa0bc44.png" alt></p> <p>Chrome 拓展的 JS 主要可以分为这 5 类：injected script、content-script、popup js、background js 和 devtools js，</p> <table><thead><tr><th style="text-align:center">JS种类</th> <th style="text-align:center">可访问的API</th> <th style="text-align:center">DOM访问情况</th> <th style="text-align:center">JS访问情况</th> <th style="text-align:center">直接跨域</th></tr></thead> <tbody><tr><td style="text-align:center">injected script</td> <td style="text-align:center">和普通 JS 无任何差别，不能访问任何扩展 API</td> <td style="text-align:center">可以访问</td> <td style="text-align:center">可以访问</td> <td style="text-align:center">不可以</td></tr> <tr><td style="text-align:center">content script</td> <td style="text-align:center">只能访问 extension、runtime 等部分API</td> <td style="text-align:center">可以访问</td> <td style="text-align:center">不可以</td> <td style="text-align:center">不可以</td></tr> <tr><td style="text-align:center">popup js</td> <td style="text-align:center">可访问绝大部分 API，除了 devtools 系列</td> <td style="text-align:center">不可直接访问</td> <td style="text-align:center">不可以</td> <td style="text-align:center">可以</td></tr> <tr><td style="text-align:center">background js</td> <td style="text-align:center">可访问绝大部分 API，除了 devtools 系列</td> <td style="text-align:center">不可直接访问</td> <td style="text-align:center">不可以</td> <td style="text-align:center">可以</td></tr> <tr><td style="text-align:center">devtools js</td> <td style="text-align:center">只能访问 devtools、extension、runtime 等部分API</td> <td style="text-align:center">可以</td> <td style="text-align:center">可以</td> <td style="text-align:center">不可以</td></tr></tbody></table> <h2 id="chrome-devtools-extensions">Chrome DevTools Extensions</h2> <p>官方文档及示例如下：</p> <ul><li>官方文档：<a href="https://developer.chrome.com/extensions/devtools" target="_blank" rel="noopener noreferrer">https://developer.chrome.com/extensions/devtools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>中文文档：<a href="https://crxdoc-zh.appspot.com/extensions/devtools" target="_blank" rel="noopener noreferrer">https://crxdoc-zh.appspot.com/extensions/devtools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Sample DevTools Extensions：<a href="https://developer.chrome.com/devtools/docs/sample-extensions" target="_blank" rel="noopener noreferrer">https://developer.chrome.com/devtools/docs/sample-extensions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>awesome-chrome-devtools: <a href="https://github.com/ChromeDevTools/awesome-chrome-devtools" target="_blank" rel="noopener noreferrer">https://github.com/ChromeDevTools/awesome-chrome-devtools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Chrome DevTools 扩展程序的结构与 Chrome 其他任何的扩展程序一样：它可以具有背景页面(background)，内容脚本(content-scripts)和其他选项，此外每个 Chrome DevTools 扩展都有一个 Chrome DevTools 页面，该页面可以访问 DevTools API。Chrome DevTools 扩展程序可以为 Chrome DevTools 添加新功能，可以添加新的 UI 面板和侧边栏，与检查的页面进行交互，获取有关网络请求的信息等。</p> <p>Chrome DevTools Extension 架构图：</p> <p><img src="/assets/img/devtools-extension.b1967acb.png" alt></p> <p>DevTools page 在 manifest.json 中注册，必须为一个 html 页面，对用户不可见，可调用以下 Chrome DevTools Extension 特有的 API:</p> <ul><li><a href="https://developer.chrome.com/extensions/devtools.inspectedWindow" target="_blank" rel="noopener noreferrer">chrome.devtools.inspectedWindow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：获取被审查窗口的相关信息</li> <li><a href="https://developer.chrome.com/extensions/devtools_network" target="_blank" rel="noopener noreferrer">chrome.devtools.network<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：获取有关网络请求的信息</li> <li><a href="https://developer.chrome.com/extensions/devtools_panels" target="_blank" rel="noopener noreferrer">chrome.devtools.panels<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：面板相关</li></ul> <p>Background Page 是常驻后台运行的 JS 脚本，拥有对 Extensions API 的全部调用权限，可以和 DevTools Page 进行 通信; Inspected Window 指当前DevTools 检测的 Web 页，可被 Background Page 注入内容脚本。</p> <h2 id="chrome-devtools-protocol">Chrome DevTools Protocol</h2> <ul><li>官方文档：<a href="https://chromedevtools.github.io/devtools-protocol" target="_blank" rel="noopener noreferrer">https://chromedevtools.github.io/devtools-protocol<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>getting-started-with-cdp：<a href="https://github.com/aslushnikov/getting-started-with-cdp" target="_blank" rel="noopener noreferrer">https://github.com/aslushnikov/getting-started-with-cdp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Chrome DevTools Protocol 允许第三方对基于 Chrome 的 Web 应用程序进行调试、分析等，基于 WebSocket，利用 WebSocket 建立连接 DevTools 和浏览器内核的快速数据通道。基于 WebSocket 建立连接 DevTools 和浏览器内核的快速数据通道，DevTools Frontend 中的源代码(<a href>Connections.js</a>)：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * @param {function()} websocketConnectionLost
 * @return {!ProtocolModule.InspectorBackend.Connection}
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">_createMainConnection</span><span class="token punctuation">(</span><span class="token parameter">websocketConnectionLost</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wsParam <span class="token operator">=</span> Root<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span><span class="token function">queryParam</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> wssParam <span class="token operator">=</span> Root<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span><span class="token function">queryParam</span><span class="token punctuation">(</span><span class="token string">'wss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>wsParam <span class="token operator">||</span> wssParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ws <span class="token operator">=</span> wsParam <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ws://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wsParam<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wss://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wssParam<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebSocketConnection</span><span class="token punctuation">(</span>ws<span class="token punctuation">,</span> websocketConnectionLost<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Host<span class="token punctuation">.</span>InspectorFrontendHost<span class="token punctuation">.</span>InspectorFrontendHostInstance<span class="token punctuation">.</span><span class="token function">isHostedMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StubConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MainConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该协议把操作划分为不同的域(domain)，比如 DOM、Debugger、Network、Console 和 Timeline 等，可以理解为 DevTools 中的不同功能模块。</p> <p>每个域(domain)定义了它所支持的 command 和它所产生的 event。每个 command 包含 request 和 response 两部分，request 部分指定所要进行的操作以及操作说要的参数，response 部分表明操作状态，成功或失败。command 和 event 中可能涉及到非基本数据类型，在 domain 中被归为 Type，比如：’frameId’: <code>&lt;FrameId&gt;</code>，其中 FrameId 为非基本数据类型。</p> <p><img src="/assets/img/protocol-monitor.04da78fc.png" alt></p> <p>基于 Chrome Debugging Protocol 的 Client 端有常见几种：</p> <ul><li>基于 HTML5 标准的 WebSocket 或 Node <a href="https://github.com/websockets/ws" target="_blank" rel="noopener noreferrer">ws<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建立连接</span>
<span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:9222/devtools/page/A12A4B08-E5AF-4A84-A86A-A1C86E731D7F&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用 Command</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取数据：{&quot;method&quot;: &quot;Page.loadEventFired&quot;, &quot;params&quot;: {&quot;timestamp&quot;: 1402317772.874949}}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'{&quot;id&quot;: 1, &quot;method&quot;: &quot;Page.navigate&quot;, &quot;params&quot;: {&quot;url&quot;: &quot;http://www.github.com&quot;}}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>基于 Node <a href="https://github.com/cyrus-and/chrome-remote-interface" target="_blank" rel="noopener noreferrer">chrome-remote-interface<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CDP</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chrome-remote-interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">ws</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">CDP</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> target<span class="token punctuation">.</span>port<span class="token punctuation">,</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> target<span class="token punctuation">.</span>ws<span class="token punctuation">,</span>
  <span class="token literal-property property">local</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> Runtime<span class="token punctuation">,</span> Page <span class="token punctuation">}</span> <span class="token operator">=</span> client<span class="token punctuation">;</span>
Runtime<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Page<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> Runtime<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">'document.documentElement.outerHTML'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="electron-集成-devtools">Electron 集成 DevTools</h2> <h3 id="setdevtoolswebcontents">setDevToolsWebContents</h3> <p>Electron 官方文档 contents.setDevToolsWebContents(devToolsWebContents)，在 renderer 层建立两个 WebView，将 Simulator 和 DevTools 建立联系。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>webview</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>simulator<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://zhaomenghuan.js.org<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>webview</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>webview</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>devtools<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>webview</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> simulatorView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'simulator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devtoolsView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'devtools'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
simulatorView<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dom-ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> simulatorContents <span class="token operator">=</span> simulatorView<span class="token punctuation">.</span><span class="token function">getWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> devtoolsContents <span class="token operator">=</span> devtoolsView<span class="token punctuation">.</span><span class="token function">getWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  simulatorContents<span class="token punctuation">.</span><span class="token function">setDevToolsWebContents</span><span class="token punctuation">(</span>devtoolsContents<span class="token punctuation">)</span><span class="token punctuation">;</span>
  simulatorContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这种方法 devtools WebView 加载的地址是：</p> <div class="language- extra-class"><pre class="language-text"><code>chrome-devtools://devtools/bundled/inspector.html?remoteBase=https://chrome-devtools-frontend.appspot.com/serve_file/@7accc8730b0f99b5e7c0702ea89d1fa7c17bfe33/&amp;can_dock=&amp;toolbarColor=rgba(223,223,223,1)&amp;textColor=rgba(0,0,0,1)&amp;experiments=true
</code></pre></div><p>在 Electron 2.x 版本中上述的方法生效，通过 setDevToolsWebContents 方法，我们将两个 WebView 建立了联系，可以实现之间的交互，但是在 Electron 6.x 版本上测试发现居然不生效。通过 github issues (https://github.com/electron/electron/issues/17168#issuecomment-483224164 ) 找到一种新的解决办法，使用 BrowserView 代替 WebView 尝试了一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main process</span>
<span class="token keyword">let</span> mainWindow<span class="token punctuation">;</span>
<span class="token keyword">let</span> devtoolsView<span class="token punctuation">;</span>
<span class="token comment">// Workbench Window</span>
  mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    width<span class="token punctuation">,</span>
    height<span class="token punctuation">,</span>
    <span class="token literal-property property">useContentSize</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">titleBarStyle</span><span class="token operator">:</span> <span class="token string">'hidden'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">webPreferences</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">webSecurity</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">nodeIntegration</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">webviewTag</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mainWindow<span class="token punctuation">.</span><span class="token function">maximize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mainWindow<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>winURL<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Devtools View</span>
  devtoolsView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mainWindow<span class="token punctuation">.</span><span class="token function">setBrowserView</span><span class="token punctuation">(</span>devtoolsView<span class="token punctuation">)</span><span class="token punctuation">;</span>
  devtoolsView<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">330</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">101</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> width <span class="token operator">-</span> <span class="token number">330</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> height <span class="token operator">-</span> <span class="token number">101</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'initialized'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> webContents<span class="token punctuation">.</span><span class="token function">getAllWebContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    container<span class="token punctuation">.</span><span class="token function">setDevToolsWebContents</span><span class="token punctuation">(</span>devtoolsView<span class="token punctuation">.</span>webContents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span>debugger<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    container<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// renderer process</span>
<span class="token keyword">const</span> simulatorView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'simulator'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  simulatorView<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dom-ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'initialized'</span><span class="token punctuation">,</span> simulatorView<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/electron-setdevtoolswebcontents.d9cd5def.png" alt></p> <p>再回头看了看官方 v8.0.2 最新文档 ⚠️警告提示不要使用 WebView 标签，建议使用 iframe 和 BrowserView 替代。</p> <blockquote><p>Electron的 webview 标签基于 <a href="https://developer.chrome.com/apps/tags/webview" target="_blank" rel="noopener noreferrer">Chromium webview &lt;/0&gt;<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，后者正在经历巨大的架构变化。 这将影响 webview 的稳定性，包括呈现、导航和事件路由。 我们目前建议不使用 webview 标签，并考虑其他替代方案，如 iframe 、Electron的 BrowserView 或完全避免嵌入内容的体系结构。</p></blockquote> <p>这里的 BrowserView 相对 WebView、BrowserWindow 有什么区别呢？Electron 中 WebView 是 DOM 层级结构的一部分，BrowserView 位于操作系统窗口层次结构。BrowserView 与 Chrome 浏览器标签页类似，可以作为一个子窗口，它的位置是相对于父窗口。另外相对 WebView 而言，Chrome 浏览器标签页的错误修复很快，BrowserView 比 WebView 更容易解决一些错误，且 BrowserView 比 WebView 运行更快。</p> <p><img src="/assets/img/browser-view.59e77a14.png" alt></p> <p>重要结论：通过 Electron setDevToolsWebContents 方法，可以使用任何 WebContents 在其中显示 devtools，包括 BrowserWindow，BrowserView 和 webview 标签，这种方式适合 IDE 进行本地 Web 化模拟调试，模拟器与调试器建立联系。</p> <h3 id="remote-debugging">Remote Debugging</h3> <h4 id="基本原理">基本原理</h4> <p>什么是远程调试？远程调试可以让您从自己的开发计算机上检查 Android 设备上运行的页面，当然开发本地的页面也可以通过远程调试的方式实现。</p> <p><img src="/assets/img/remote-debugging-principle.a419d844.png" alt></p> <p>远程调试的交互流程：</p> <p><img src="/assets/img/remote-debugging-process.bf5f2e02.png" alt></p> <p>Electron 支持在 app 模块的 ready 事件触发之前使用 app.commandLine.appendSwitch 添加 Chrome 命令行参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主进程 main.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 远程调试</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EMP_REMOTE_DEBUGGING_PORT</span> <span class="token operator">=</span> port<span class="token punctuation">;</span>
app<span class="token punctuation">.</span>commandLine<span class="token punctuation">.</span><span class="token function">appendSwitch</span><span class="token punctuation">(</span><span class="token string">'remote-debugging-port'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span>commandLine<span class="token punctuation">.</span><span class="token function">appendSwitch</span><span class="token punctuation">(</span><span class="token string">'remote-debugging-address'</span><span class="token punctuation">,</span> <span class="token string">'http://127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以通过  /json 或 /json/list 获取所有可用的 WebSocket 目标地址。</p> <p><img src="/assets/img/remote-debugging-json.098e429a.png" alt></p> <p>返回一个数组，里面是所有可以远程调试的页面，其中包含以下字段信息：</p> <ul><li>description：页面信息描述</li> <li>devtoolsFrontendUrl：调试 URL 地址</li> <li>id：页面 ID</li> <li>webSocketDebuggerUrl：WebView Debug Server 的 WebSocket 地址</li></ul> <p>获取远程 WebView DevTools Frontend 地址：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getTargetWebViewDevtoolsFrontendUrl</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 	<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://127.0.0.1:9222/json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> target <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
        <span class="token parameter">child</span> <span class="token operator">=&gt;</span> child<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'webview'</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>url <span class="token operator">===</span> url
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> target<span class="token punctuation">.</span>devtoolsFrontendUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后加上 remote-debugging-address 和 remote-debugging-port 就是 DevTools Frontend 完整的地址，然后可以使用 WebView、BrowserView 展示出来，如下：</p> <div class="language- extra-class"><pre class="language-text"><code>http://127.0.0.1:9222/devtools/inspector.html?ws=127.0.0.1:9222/devtools/page/eac1573a-c713-4421-ad64-3e07fb20f034
</code></pre></div><p>这个地址相当于两部分组成，一个是 Inspector(调试器)，由 Chromium 默认提供集成，也可以进行修改  Chrome DevTools Frontend 源代码进行自定义集成，ws 是 Chromium 内核层为目标 WebView 生成的唯一的  websocketDebuggerUrl。目前 Electron 限制，WebView 集成 DevTools Frontend 前端页面不能加载自定义拓展。</p> <h4 id="真机调试">真机调试</h4> <p>真机调试整体流程如下：</p> <p><img src="/assets/img/remote-debugging-with-devices.f83c2f0b.png" alt></p> <p><strong>Android 平台真机调试</strong></p> <p>对于 Android WebView 调试，打开 Chrome://inspect 可以显示每一个连接上的设备，以及它们打开了的浏览器标签和启用调试的 WebViews，如下图：</p> <p><img src="/assets/img/android-inspect.456d56f5.png" alt></p> <p>基于 ADB 调试 Android WebView 的原理如下：</p> <p><img src="data:image/png;base64,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" alt></p> <div class="language- extra-class"><pre class="language-text"><code>$ adb shell cat /proc/net/unix | grep --text _devtools_remote
0000000000000000: 00000002 00000000 00010000 0001 01 28940245 @stetho_org.js.emp.engine.sample:emp_devtools_remote
0000000000000000: 00000002 00000000 00010000 0001 01 28942398 @webview_devtools_remote_14277
$ adb forward tcp:9223 localabstract:webview_devtools_remote_14277
</code></pre></div><p>webview_devtools_remote 后面带的 _14277 这种是对应的 pid，可以使用 adb forward 命令将本地 9223 端口映射到远程设备的 unix domain socket（webview_devtools_remote_8208），这样就可以在本地访问到 Android WebView Debug Server。</p> <p><img src="/assets/img/remote-debugging-forward-android.20eb584e.png" alt></p> <p>其中 devtoolsFrontendUrl 是 Chrome 云服务器提供，根据 Android WebView 集成的 Chromium 不同版本加载不同的前端地址，4cd8c034a5b41cc6da41e00e42d9aadfaa34932b 和 WebKit Version 对应。</p> <p><strong>iOS 平台真机调试</strong></p> <p>iOS 设备可以连接数据线借助 Safari 或者按安装 <a href="https://developer.apple.com/safari/technology-preview" target="_blank" rel="noopener noreferrer">Safari Technology Preview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 远程调试。如果想使用 Chrome 调试，可以使用 RemoteDebug iOS WebKit Adapter 进行代理。</p> <p><img src="/assets/img/ios-webkit-debug-proxy.4b0e28ee.png" alt></p> <p>关于 iOS 平台调试权限的问题，开发阶段，用开发者账号 build 出来的 app 可以很方便的调试， 但是苹果应用商店中的 app 使用 Distribution 签名，无法直接打开 webview 的远程调试。 因此我们通过替换 ipa 包签名方式改成开发者的签名实现远程调试。</p> <h3 id="定制-inspector">定制 Inspector</h3> <p>Electron 支持 Chrome DevTools 扩展程序，可增强开发工具调试流行 web 框架的能力。</p> <p>Electron 主进程通过 API 管理 DevTools Extension：</p> <ul><li>BrowserWindow.addDevToolsExtension(path)</li> <li>BrowserWindow.removeDevToolsExtension(name)</li> <li>BrowserWindow.getDevToolsExtensions()</li></ul> <p>经过测试发现 setDevToolsWebContents 模式下 DevTools 面板可以加载自定义 DevTools Extenson，但是远程调试模式下自定义 DevTools Extenson 无法加载。目前主流小程序平台调试器的自定义面板如 Wxml、Swan Element、AppData、Storage 等都是通过 Chrome DevTools Extension 实现，都是改造 <a href="https://github.com/ChromeDevTools/devtools-frontend" target="_blank" rel="noopener noreferrer">devtools-frontend<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 项目。</p> <p>可以通过 preload 或者注入 JS Script 可以实现对 DevTools 前端界面进行定制：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 隐藏默认面板</span>
<span class="token keyword">const</span> tabbedPane <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">UI</span><span class="token punctuation">.</span>inspectorView<span class="token punctuation">.</span>_tabbedLocation<span class="token punctuation">.</span>_tabbedPane<span class="token punctuation">;</span>
tabbedPane<span class="token punctuation">.</span><span class="token function">closeTab</span><span class="token punctuation">(</span><span class="token string">'elements'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tabbedPane<span class="token punctuation">.</span><span class="token function">closeTab</span><span class="token punctuation">(</span><span class="token string">'timeline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tabbedPane<span class="token punctuation">.</span><span class="token function">closeTab</span><span class="token punctuation">(</span><span class="token string">'resources'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 新增 Connection</span>
<span class="token keyword">const</span> <span class="token function-variable function">capabilitiesForPageFrameTarget</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Browser <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span><span class="token constant">DOM</span> <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>DeviceEmulation <span class="token operator">|</span>
    window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Emulation <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Input <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span><span class="token constant">JS</span> <span class="token operator">|</span>
    window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Log <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Network <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>ScreenCapture <span class="token operator">|</span>
    window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Security <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Target <span class="token operator">|</span> window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Tracing <span class="token operator">|</span>
    window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>Target<span class="token punctuation">.</span>Capability<span class="token punctuation">.</span>Inspector<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">createPageFrameConnection</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onDisconnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">message</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'-onDisconnect-'</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> wsConnection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>SDK<span class="token punctuation">.</span>WebSocketConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> onDisconnect<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">onMessage</span><span class="token operator">:</span> params<span class="token punctuation">.</span>onMessage<span class="token punctuation">,</span>
    onDisconnect
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  wsConnection<span class="token punctuation">.</span>isPageFrame <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> wsConnection<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token constant">SDK</span><span class="token punctuation">.</span>targetManager<span class="token punctuation">.</span><span class="token function">createTarget</span><span class="token punctuation">(</span><span class="token string">'page-frame'</span><span class="token punctuation">,</span> <span class="token string">'Page'</span><span class="token punctuation">,</span> <span class="token function">capabilitiesForPageFrameTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> createPageFrameConnection<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="参考">参考</h2> <ul><li><a href="https://www.cnblogs.com/liuxianan/p/chrome-plugin-develop.html" target="_blank" rel="noopener noreferrer">【干货】Chrome插件(扩展)开发全攻略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://slides.com/luyuan/rebuild-devtools-extension-runtime/fullscreen#/" target="_blank" rel="noopener noreferrer">再造一个DevTools Extension运行时环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.figma.com/blog/introducing-browserview-for-electron/" target="_blank" rel="noopener noreferrer">Introducing BrowserView for Electron<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.fed123.com/pwa/2105.html" target="_blank" rel="noopener noreferrer">Chrome 远程调试 Android 和 iOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.fed123.com/javascriptnodejs/2290.html" target="_blank" rel="noopener noreferrer">基于 Chrome DevTools 远程调试技术方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://fex.baidu.com/blog/2014/06/remote-debugging-protocol/" target="_blank" rel="noopener noreferrer">Chrome 远程调试协议分析与实战<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/47185925" target="_blank" rel="noopener noreferrer">智能小程序档案馆——真机调试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/45743027" target="_blank" rel="noopener noreferrer">智能小程序档案馆——远程调试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ayqy.net/blog/electron-webview%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/" target="_blank" rel="noopener noreferrer">Electron webview完全指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/luoshengyang/article/details/52246854" target="_blank" rel="noopener noreferrer">Chromium扩展（Extension）机制简要介绍和学习计划<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://memoryza.gitbook.io/chromedevtools-devtools-frontend/" target="_blank" rel="noopener noreferrer">Chrome DevTools 源码解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/7.a2cd9d6c.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
