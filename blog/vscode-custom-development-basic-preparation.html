<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vscode 定制开发 —— 基础准备 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/16.8f57294c.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>vscode 定制开发 —— 基础准备</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/vscode-custom-development-basic-preparation.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/vscode-custom-development-basic-preparation.html#起步" class="sidebar-link">起步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#从插件拓展入手" class="sidebar-link"> 从插件拓展入手</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#从官方源码入手" class="sidebar-link">从官方源码入手</a></li></ul></li><li><a href="/blog/vscode-custom-development-basic-preparation.html#技术架构" class="sidebar-link">技术架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#多进程架构" class="sidebar-link">多进程架构</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#主进程" class="sidebar-link"> 主进程</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#渲染进程" class="sidebar-link">渲染进程</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#插件进程" class="sidebar-link">插件进程</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#debug-进程" class="sidebar-link">Debug 进程</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#搜索进程" class="sidebar-link">搜索进程</a></li></ul></li><li><a href="/blog/vscode-custom-development-basic-preparation.html#定制开发" class="sidebar-link">定制开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#拓展-activitybar" class="sidebar-link">拓展 ActivityBar</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#拓展-statusbar" class="sidebar-link">拓展 StatusBar</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#欢迎页" class="sidebar-link">欢迎页</a></li><li class="sidebar-sub-header"><a href="/blog/vscode-custom-development-basic-preparation.html#语言包" class="sidebar-link">语言包</a></li></ul></li><li><a href="/blog/vscode-custom-development-basic-preparation.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vscode-定制开发-——-基础准备">vscode 定制开发 —— 基础准备</h1> <h2 id="前言">前言</h2> <p>前端开发现在最流行的 IDE 莫过于 vscode，对于一些特殊需求，例如移动端页面预览、自定义脚手架编译工程等等，如果能够通过 IDE 的插件拓展去完成，那定是一件美美的事情，后续相关工作有这块的需求，所以利用下班时间及周末做一下相关的技术储备，玩一下 vscode 插件拓展及源码改造。</p> <h2 id="起步">起步</h2> <p>目前 vscode 相关的开发主要有两种方式：插件拓展和&quot;魔改&quot;源码。插件开发相对比较简单，可以从<a href="https://marketplace.visualstudio.com/vscode" target="_blank" rel="noopener noreferrer">插件市场<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到很多一些功能插件然后学习改造。插件拓展在不修改 vscode 源码对基础上对先有 IDE 进行功能增强，但是受限于 vscode 的安全架构模型，功能相对比较局限，特别是 UI 类型的功能拓展改造。</p> <p>对于一些自定义工程管理的需求，很多时候需要改造界面，这个时候从源码角度入手才方便实现相关的功能，典型的例子：<a href="https://www.egret.com/products/wing.html" target="_blank" rel="noopener noreferrer">白鹭 Egret Wing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这个堪称对 vscode 的魔改，实现了很多自定义的交互功能。最近发现 <a href="http://emas.weex.io/zh/tools/ide.html" target="_blank" rel="noopener noreferrer">weex studio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://www.quickapp.cn/docCenter/IDEPublicity" target="_blank" rel="noopener noreferrer">快应用 IDE<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 也基于 vscode 改造的 IDE，看到这个真的很兴奋，哈哈，很多思路和我之前想的一样，只可惜之前没有去动手实现，所以也催促了对于想干的事情，动手要趁早。</p> <h3 id="从插件拓展入手"> 从插件拓展入手</h3> <p>微软官方提供了脚手架 <a href="https://github.com/Microsoft/vscode-generator-code" target="_blank" rel="noopener noreferrer">vscode-generator-code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 来生成项目结构，官方既然提供了那自然采用官方的靠谱。</p> <p>安装：</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g yo generator-code
yo code
</code></pre></div><p>新建一个测试工程，我  们重点看两个文件：package.json 和 extension.js。</p> <p>package.json：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;onCommand:extension.helloWorld&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./src/extension.js&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token string">&quot;extension.helloWorld&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>extension.js：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> vscode <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;vscode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Congratulations, your extension &quot;helloworld&quot; is now active!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> disposable <span class="token operator">=</span> vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span>
    <span class="token string">&quot;extension.helloWorld&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInformationMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  context<span class="token punctuation">.</span>subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>disposable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

exports<span class="token punctuation">.</span>activate <span class="token operator">=</span> activate<span class="token punctuation">;</span>
</code></pre></div><p>vscode.commands.registerCommand 是注册命令的 API，执行后会返回一个 Disposable 对象，所有注册类的 API 执行后都需要将返回结果放到 context.subscriptions 中去。</p> <h3 id="从官方源码入手">从官方源码入手</h3> <p>官方文档：https://github.com/Microsoft/vscode/wiki/How-to-Contribute</p> <p>按照官方文档下载 vscode 源码进行本地编译，由于 vscode 基于 Web 技术栈(HTML+ CSS+JS)构建，所以整体构建方式和前端工程类似。</p> <p>运行：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn watch
./scripts/code.sh
</code></pre></div><p>编译成产品包：</p> <div class="language- extra-class"><pre class="language-text"><code>yarn run gulp vscode-[platform]
yarn run gulp vscode-[platform]-min
</code></pre></div><blockquote><p>platforms: win32-ia32 | win32-x64 | darwin | linux-ia32 | linux-x64 | linux-arm</p></blockquote> <p>以下内容参考源码版本为 <a href="https://github.com/Microsoft/vscode/tree/1.32.3" target="_blank" rel="noopener noreferrer">v1.32.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>目录结构:</p> <div class="language- extra-class"><pre class="language-text"><code>├── build         # gulp编译构建脚本
├── extensions    # 内置插件
├── resources     # 平台相关静态资源，图标等
├── scripts       # 工具脚本，开发/测试
├── out           # 编译输出目录
├── src           # 源码目录
├── test          # 测试套件
├── gulpfile.js   # gulp task
└── product.json  # App meta 信息
</code></pre></div><p>src 下的结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>├── bootstrap-amd.js    # 子进程实际入口
├── bootstrap-fork.js   #
├── bootstrap-window.js #
├── bootstrap.js        # 子进程环境初始化
├── buildfile.js        # 构建config
├── cli.js              # CLI入口
├── main.js             # 主进程入口
├── paths.js            # AppDataPath与DefaultUserDataPath
├── typings
│   └── xxx.d.ts        # ts类型声明
└── vs
    ├── base            # 通用工具/协议和基础 DOM UI 控件
    │   ├── browser     # 基础UI组件，DOM操作、交互事件、DnD等
    │   ├── common      # diff描述，markdown解析器，worker协议，各种工具函数
    │   ├── node        # Node工具函数
    │   ├── parts       # IPC协议（Electron、Node），quickopen、tree组件
    │   ├── test        # base单测用例
    │   └── worker      # Worker factory 和 main Worker（运行IDE Core：Monaco）
    ├── code            # vscode主窗体相关
    |   ├── electron-browser # 需要 Electron 渲染器处理API的源代码（可以使用 common, browser, node）
    |   ├── electron-main    # 需要Electron主进程API的源代码（可以使用 common, node）
    |   ├── node        # 需要Electron主进程API的源代码（可以使用 common, node）
    |   ├── test
    |   └── code.main.ts
    ├── editor          # 对接 IDE Core（读取编辑/交互状态），提供命令、上下文菜单、hover、snippet等支持
    |   ├── browser     # 代码编辑器核心
    |   ├── common      # 代码编辑器核心
    |   ├── contrib     # vscode 与独立 IDE共享的代码
    |   ├── standalone  # 独立 IDE 独有的代码
    |   ├── test
    |   ├── editor.all.ts
    |   ├── editor.api.ts
    |   ├── editor.main.ts
    |   └── editor.worker.ts
    ├── platform        # 支持注入服务和平台相关基础服务（文件、剪切板、窗体、状态栏）
    ├── workbench       # 协调editor并给viewlets提供框架，比如目录查看器、状态栏等，全局搜索，集成Git、Debug
    ├── buildunit.json
    ├── css.build.js    # 用于插件构建的CSS loader
    ├── css.js          # CSS loader
    ├── loader.js       # AMD loader（用于异步加载AMD模块，类似于require.js）
    ├── nls.build.js    # 用于插件构建的 NLS loader
    └── nls.js          # NLS（National Language Support）多语言loader
</code></pre></div><p>其次，由于 VSCode 依赖 Electron，而在上述我们提到了 Electron 存在着主进程和渲染进程，而它们能使用的 API 有所不到，所以 VSCode Core 中每个目录的组织也按照它们能使用的 API 来组织安排。在 Core 下的每个子目录下，按照代码所运行的目标环境分为以下几类：</p> <ul><li>common: 只使用 JavaScript API 的源代码，可能运行在任何环境</li> <li>browser: 需要使用浏览器提供的 API 的源代码，如 DOM 操作等</li> <li>node: 需要使用 Node.js 提供的 API 的源代码</li> <li>electron-browser: 需要使用 Electron 渲染进程 API 的源代码</li> <li>electron-main: 需要使用 Electron 主进程 API 的源代码</li></ul> <p>参考：<a href="https://github.com/Microsoft/vscode/wiki/Code-Organization" target="_blank" rel="noopener noreferrer">VSCode 源码结构<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="技术架构">技术架构</h2> <h3 id="多进程架构">多进程架构</h3> <p>Visual Studio Code 是由微软公司开发的开源、免费、跨平台的代码编辑器，微软希望它在保持核心轻量化文本编辑器的基础上，为编辑器添加项目支持、智能感知和编译调试。</p> <p><img src="/assets/img/codevside.fc1f8870.png" alt></p> <p>作为微软推出的现代编辑器，它已经在 GitHub 上开源, 使用 Electron 架构，代码编辑器层为 Monaco。</p> <p>从实现上来看，Electron 的基本结构:</p> <blockquote><p>Electron = Node.js + Chromium + Native API</p></blockquote> <p>也就是说 Electron 拥有 Node 运行环境，依靠 Chromium 提供基于 Web 技术（HTML、CSS、JS）的界面交互支持，另外还具有一些平台特性，比如桌面通知。</p> <p>从 API 设计上来看，Electron App 一般都有 1 个 Main Process 和多个 Renderer Process：</p> <ul><li>main process：主进程环境下可以访问 Node 及 Native API；</li> <li>renderer process：渲染器进程环境下可以访问 Browser API 和 Node API 及一部分 Native API。</li></ul> <p>VSC 采用多进程架构，VSC 启动后主要有下面的几个进程：</p> <p><img src="/assets/img/processes.246227f5.png" alt></p> <ul><li>主进程</li> <li>渲染进程
<ul><li>HTML 编写的 UI
<ul><li>Activitybar: 最左边(也可以设置到右边)的选项卡</li> <li>Sidebar: Activitybar 选中的内容</li> <li>Panel: 状态栏上方的面板选项卡</li> <li>Editor: 编辑器部分</li> <li>Statusbar: 下方的状态栏</li></ul></li> <li>Nodejs 异步 IO
<ul><li>FileService</li> <li>ConfigurationService</li></ul></li></ul></li> <li>插件宿主进程</li> <li>Debug 进程</li> <li>Search 进程</li></ul> <h3 id="主进程"> 主进程</h3> <p>相当于后台服务，后台进程是 VSC 的入口，主要负责多窗体管理（创建/切换）、编辑器生命周期管理，进程间通信（IPC Server），自动更新，工具条菜单栏注册等。</p> <p>我们启动 VSC 的时候，后台进程会首先启动，读取各种配置信息和历史记录，然后将这些信息和主窗口 UI 的 HTML 主文件路径整合成一个 URL，启动一个浏览器窗口来显示编辑器的 UI。后台进程会一直关注 UI 进程的状态，当所有 UI 进程被关闭的时候，整个编辑器退出。</p> <p>此外后台进程还会开启一个本地的 Socket，当有新的 VSC 进程启动的时候，会尝试连接这个 Socket，并将启动的参数信息传递给它，由已经存在的 VSC 来执行相关的动作，这样能够保证 VSC 的唯一性，避免出现多开文件夹带来的问题。</p> <h3 id="渲染进程">渲染进程</h3> <p>编辑器窗口进程负责整个 UI 的展示，也就是我们所见的部分。UI 全部用 HTML 编写没有太多需要介绍的部分。</p> <p>项目文件的读取和保存由主进程的 NodeJS API 完成，因为全部是异步操作，即便有比较大的文件，也不会对 UI 造成阻塞。IO 跟 UI 在一个进程，并采用异步操作，在保证 IO 性能的基础上也保证了 UI 的响应速度。</p> <h3 id="插件进程">插件进程</h3> <p>每一个 UI 窗口会启动一个 NodeJS 子进程作为插件的宿主进程。所有的插件会共同运行在这个进程中。</p> <h3 id="debug-进程">Debug 进程</h3> <p>Debugger 插件跟普通的插件有一点区别，它不运行在插件进程中，而是在每次 debug 的时候由 UI 单独新开一个进程。</p> <h3 id="搜索进程">搜索进程</h3> <p>搜索是一个十分耗时的任务，VSC 也使用的单独的进程来实现这个功能，保证主窗口的效率。将耗时的任务分到多个进程中，有效的保证了主进程的响应速度。</p> <h2 id="定制开发">定制开发</h2> <p> 考虑基于 vscode 源码的定制，我们基本都是因为官方编辑器窗口功能不满足我们的功能，我们需要做一些个性化的功能，下面我们尝试从修改 vscode 原有界面逐步去理解 vscode 的技术架构。vscode 界面主要有以下几个部分，我将结合实际的例子进行研究。</p> <p>“工作台”是指整个 VS Code UI 和其中包含的下列 UI 组件：</p> <ul><li>标题栏: Title Bar</li> <li>活动栏: Activity Bar</li> <li>侧边栏: Side Bar</li> <li>面板: Panal</li> <li>编辑器群: Editor</li> <li>状态栏: Status Bar</li></ul> <p><img src="/assets/img/layout.8b0ced66.png" alt></p> <p>VS Code 提供了各式各样的 API 让在工作台你添加自己的组件。</p> <h3 id="拓展-activitybar">拓展 ActivityBar</h3> <p>将常用的功能放置于 ActivityBar，点击 ActivityBar 中的图标，然后右边编辑器区域进行切换，这是 vscode 插件中常用的方法，例如：<a href="https://github.com/auchenberg/vscode-browser-preview" target="_blank" rel="noopener noreferrer">vscode-browser-preview<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="views-viewscontainers">views &amp; viewsContainers</h4> <p>ActivityBar 通过 views &amp; viewsContainers 实现相关的功能：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;contributes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;viewsContainers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;activitybar&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aemp-preview&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;预览&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;resources/preview.svg&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;views&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;aemp-preview&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;targetTree1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Targets1&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;targetTree2&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Targets2&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>contributes.views 提供 VS Code 视图，必须为视图指定标识符和名称。当用户打开视图时，VS Code 将在 <code>onView:${viewId}</code> 上发出<code>activationEvent</code>（例如 onView:targetTree1，如下例所示）。您还可以通过提供 when context 值来控制视图的可见性。扩展编写者应该通过<code>createTreeView</code> API 提供数据提供者来创建 TreeView，或者通过 <code>registerTreeDataProvider</code> API 直接注册数据提供者来填充数据。参考：<a href="https://github.com/Microsoft/vscode-extension-samples/tree/master/tree-view-sample" target="_blank" rel="noopener noreferrer">tree-view-sample<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>效果如下：</p> <p><img src="/assets/img/activitybar-preview.3e7dc66b.png" alt></p> <p>图标规格：</p> <ul><li>Size：图标应为 28x28 并居中</li> <li>Color：图标应使用单一单色</li> <li>Format：虽然接受任何图像文件类型，但建议图标在 SVG 中。</li> <li>States：所有图标都继承以下状态样式：</li></ul> <table><thead><tr><th style="text-align:center">State</th> <th style="text-align:center">Opacity</th></tr></thead> <tbody><tr><td style="text-align:center">Default</td> <td style="text-align:center">60%</td></tr> <tr><td style="text-align:center">Hover</td> <td style="text-align:center">100%</td></tr> <tr><td style="text-align:center">Active</td> <td style="text-align:center">100%</td></tr></tbody></table> <p>参考文档：<a href="https://code.visualstudio.com/api/references/contribution-points#contributes.viewsContainers" target="_blank" rel="noopener noreferrer">contributes.viewsContainers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="激活事件-onview-viewid">激活事件-onView:${viewId}</h4> <p>package.json:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;activationEvents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;onView:targetTree1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;onCommand:aemp-debugger.openPreview&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>extension.ts：</p> <div class="language-ts extra-class"><pre class="language-ts"><code>vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">registerTreeDataProvider</span><span class="token punctuation">(</span><span class="token string">&quot;targetTree1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TargetTreeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
  vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">&quot;aemp-debugger.openPreview&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>url<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">showInformationMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>TargetTreeProvider.ts：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> vscode <span class="token keyword">from</span> <span class="token string">&quot;vscode&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Commands <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./commands&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">TargetTreeProvider</span>
  <span class="token keyword">implements</span> <span class="token class-name">vscode</span><span class="token punctuation">.</span>TreeDataProvider<span class="token operator">&lt;</span>object<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> _onDidChangeTreeData<span class="token operator">:</span> vscode<span class="token punctuation">.</span>EventEmitter<span class="token operator">&lt;</span>
    object <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">vscode</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">EventEmitter</span><span class="token generic class-name"><span class="token operator">&lt;</span>object <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">readonly</span> onDidChangeTreeData<span class="token operator">:</span> vscode<span class="token punctuation">.</span>Event<span class="token operator">&lt;</span>object <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token punctuation">.</span>_onDidChangeTreeData<span class="token punctuation">.</span>event<span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_onDidChangeTreeData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getTreeItem</span><span class="token punctuation">(</span>element<span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> vscode<span class="token punctuation">.</span>TreeItem <span class="token punctuation">{</span>
    <span class="token keyword">return</span> element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">getChildren</span><span class="token punctuation">(</span>element<span class="token operator">?</span><span class="token operator">:</span> object<span class="token punctuation">)</span><span class="token operator">:</span> Thenable<span class="token operator">&lt;</span>object<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token string">&quot;aemp-debugger.openPreview&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vscode<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token string">'workbench.view.explorer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Make sure collection is not cached.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_onDidChangeTreeData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="activitybar-主题定制">ActivityBar 主题定制</h4> <p><strong>ActivityBar 增加文字</strong>：</p> <p><img src="/assets/img/activitybar-text.fcf250f3.png" alt></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;Explorer&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;Search&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;Source Control&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;Debug&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;Extensions&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;资源管理器&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;搜索&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;源代码管理&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;调试&quot;],
.activitybar .composite-bar li.action-item[title^=&quot;扩展&quot;]</span> <span class="token punctuation">{</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;Explorer&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Search&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Source Control&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Debug&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Extensions&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;资源管理器&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;搜索&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;源代码管理&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;调试&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;扩展&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> -12px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #aaa<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 11px<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;资源管理器&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Explorer&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;代码&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;搜索&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Search&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;搜索&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;源代码管理&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Source Control&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;Git&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;调试&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Debug&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;调试&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.activitybar .composite-bar li.action-item[title^=&quot;扩展&quot;]::after,
.activitybar .composite-bar li.action-item[title^=&quot;Extensions&quot;]::after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;插件&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>ActivityBar 修改宽度</strong>：</p> <ul><li>legacyLayout.ts 文件 <code>ACTIVITY_BAR_WIDTH = 50</code> 修改为 <code>ACTIVITY_BAR_WIDTH = 70</code>;</li> <li>activitybarpart.css 修改如下：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>.monaco-workbench .part.activitybar {
	width: 70px;
}

.monaco-workbench .activitybar &gt; .content {
	width: 70px;
	...
}
</code></pre></div><h3 id="拓展-statusbar">拓展 StatusBar</h3> <p>状态栏上的按钮是可以响应我们创建的命令的，下面我们在状态栏上创建一个 debug 按钮，用来调试运行构建的程序：</p> <p><img src="/assets/img/ext-statusbar.361bf67b.png" alt></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">let</span> debugButton <span class="token operator">=</span> vscode<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">createStatusBarItem</span><span class="token punctuation">(</span>
  vscode<span class="token punctuation">.</span>StatusBarAlignment<span class="token punctuation">.</span>Left<span class="token punctuation">,</span>
  <span class="token number">4.5</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
debugButton<span class="token punctuation">.</span>command <span class="token operator">=</span> __CommandID__<span class="token punctuation">;</span>
debugButton<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$(bug)调试</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
debugButton<span class="token punctuation">.</span>tooltip <span class="token operator">=</span> <span class="token string">&quot;Debug the given target&quot;</span><span class="token punctuation">;</span>
debugButton<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>注：<code>__CommandID__</code>为需要响应的命令的 ID。</p> <h3 id="欢迎页">欢迎页</h3> <p>VS Code 欢迎页的实现有多种实现方法，基于 Extension API 的方式或者修改源码的方式。这里我们采用最彻底的方式修改，我们找到欢迎页的源码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/vs/workbench/contrib/welcome/page/welcomePage.ts</span>
<span class="token keyword">const</span> recentlyOpened <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>windowService<span class="token punctuation">.</span><span class="token function">getRecentlyOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> installedExtensions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instantiationService<span class="token punctuation">.</span><span class="token function">invokeFunction</span><span class="token punctuation">(</span>
  getInstalledExtensions
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token constant">URI</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">toUrl</span><span class="token punctuation">(</span><span class="token string">&quot;./vs_code_welcome_page&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">scheme</span><span class="token operator">:</span> Schemas<span class="token punctuation">.</span>walkThrough<span class="token punctuation">,</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">moduleId</span><span class="token operator">:</span> <span class="token string">&quot;vs/workbench/contrib/welcome/page/browser/vs_code_welcome_page&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>editorInput <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instantiationService<span class="token punctuation">.</span><span class="token function">createInstance</span><span class="token punctuation">(</span>WalkThroughInput<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">typeId</span><span class="token operator">:</span> welcomeInputTypeId<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token function">localize</span><span class="token punctuation">(</span><span class="token string">&quot;welcome.title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Welcome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  resource<span class="token punctuation">,</span>
  telemetryFrom<span class="token punctuation">,</span>
  <span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">container</span><span class="token operator">:</span> HTMLElement</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> recentlyOpened<span class="token punctuation">,</span> installedExtensions<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>vs_code_welcome_page.ts 里面定义了欢迎页的视图，我们进行必要的修改就行了。</p> <h3 id="语言包">语言包</h3> <p>在 v1.32.3 这个版本的 vscode 源码中，不包含 i18n 相关的包，所以默认的源码中不包含中文字体包，对于我们需要本地化的产品是不太合适的，我们可以从 github 上下载 vscode i18n 的代码。</p> <p>vscode Localization Extension: <a href="https://github.com/Microsoft/vscode-loc" target="_blank" rel="noopener noreferrer">https://github.com/Microsoft/vscode-loc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>我们默认将 <a href="https://github.com/Microsoft/vscode-loc/tree/master/i18n/vscode-language-pack-zh-hans" target="_blank" rel="noopener noreferrer">VS Code 中文（简体）语言包: vscode-language-pack-zh-hans<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://github.com/Microsoft/vscode-loc/tree/master/i18n/vscode-language-pack-zh-hant" target="_blank" rel="noopener noreferrer">VS Code 中文(繁體)語言套件: vscode-language-pack-zh-hant<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 集成到我们下载的 vscode 源码 extensions 中。</p> <p>locale.json:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 定义 VS Code 的显示语言。</span>
  <span class="token comment">// 请参阅 https://go.microsoft.com/fwlink/?LinkId=761051，了解支持的语言列表。</span>

  <span class="token property">&quot;locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zh-CN&quot;</span> <span class="token comment">// 更改将在重新启动 VS Code 之后生效。</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考">参考</h2> <ul><li><a href="https://code.visualstudio.com/api" target="_blank" rel="noopener noreferrer">Extension API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://liiked.github.io/VS-Code-Extension-Doc-ZH" target="_blank" rel="noopener noreferrer">VS Code 插件开发文档-中文版<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/microsoft/vscode-extension-samples" target="_blank" rel="noopener noreferrer">vscode-extension-samples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ayqy.net/blog/vs-code%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/" target="_blank" rel="noopener noreferrer">vscode 源码简析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://imzc.me/dev/2016/08/15/vscode-the-architecture/" target="_blank" rel="noopener noreferrer">Visual Studio Code / Egret Wing 技术架构：基础<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/16.8f57294c.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
