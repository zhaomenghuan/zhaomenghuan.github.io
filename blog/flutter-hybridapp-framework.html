<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于 Flutter 的混合式开发框架设计 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/19.c7be2474.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>基于 Flutter 的混合式开发框架设计</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/flutter-hybridapp-framework.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/flutter-hybridapp-framework.html#flutetr-整体架构" class="sidebar-link">Flutetr 整体架构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/flutter-hybridapp-framework.html#flutter-插件开发" class="sidebar-link">Flutter 插件开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/flutter-hybridapp-framework.html#platform-channel-架构" class="sidebar-link">Platform Channel 架构</a></li><li class="sidebar-sub-header"><a href="/blog/flutter-hybridapp-framework.html#plugin-创建" class="sidebar-link">Plugin 创建</a></li><li class="sidebar-sub-header"><a href="/blog/flutter-hybridapp-framework.html#plugin-注册与调用" class="sidebar-link">Plugin 注册与调用</a></li></ul></li><li><a href="/blog/flutter-hybridapp-framework.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="基于-flutter-的混合式开发框架设计">基于 Flutter 的混合式开发框架设计</h1> <h2 id="前言">前言</h2> <p><img src="/assets/img/flutter.cf1d173c.png" alt></p> <p>随着 Flutter 发布 1.0 版本，Flutter 在移动开发社区热度不断升高，在 Flutter 出现之前，移动开发领域出现过很多跨平台(Android、iOS)技术框架，目前主要的架构可以分为三类：</p> <ul><li>Hybrid 方向(H5 + Native)，基于单 webview 构建的 SPA 应用或者原生骨架 + 多 webview 的混合式应用，利用 JSBridge 调用系统平台功能，典型的框架：Cordova(PhoneGap)、Html5Plus、微信小程序；</li> <li>JavaScript DSL + 原生渲染，使用 JS 语法进行 UI 开发，通过构建 DSL 和渲染引擎调用系统平台 UI，典型的框架：React Native、Weex、NativeScrip、快应用；</li> <li>UI 自绘引擎 + 原生，原生跨平台工具允许开发者编写一次代码，然后将该代码转换为适配多个操作系统的本地代码，让开发者以最小的成本在不同的平台上发布移动应用，典型的框架：Xamarin、Titanium、Flutter。</li></ul> <p>笔者主要做 Hybrid 方向架构设计和开发，对 Flutter UI 渲染方式、性能、开发效率的表现都很有兴趣。Flutter 不使用浏览器技术，也不使用 Native 的原生控件，它使用自己的渲染引擎来绘制 widget，从而在展现层面表现的平台一致性和高性能，这个是 Flutter 非常大的优势。Flutter 作为移动开发新秀，暂时整体生态还不及之前的方案，直接的迁移到新技术也是有风险的，那么如何平滑的过度或者做一些融合呢？</p> <p>目前 Flutetr 集成到原生开发工程中官方提供了方法：</p> <p><a href="https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#experiment-turn-the-flutter-project-into-a-module" target="_blank" rel="noopener noreferrer">https://github.com/flutter/flutter/wiki/Add-Flutter-to-existing-apps#experiment-turn-the-flutter-project-into-a-module<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>目前 Web 开发资源和人员都相对较多，如何复用 Web 技术和资源，将 Hybrid App 的内容集中到 Flutter 工程中也是一个需要探索的方向。</p> <p>笔者找过一些 JS To Dart 的方案，基本目前 Flutter 没有太好的方式，虽然有一些插件如 <a href="https://github.com/PonnamKarthik/FlutterHtmlView" target="_blank" rel="noopener noreferrer">FlutterHtmlView<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, 官方也出了 <a href="https://github.com/flutter/plugins/tree/master/packages/webview_flutter" target="_blank" rel="noopener noreferrer">webview_flutter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的组件，但是还不足以支撑 WebView 完整的调用，本文主要是探索一下在 Flutter 中复用 H5 开发的资源，这样在资源使用上 Flutter 可以更好的使用 WebView 相关的一些资源。</p> <h2 id="flutetr-整体架构">Flutetr 整体架构</h2> <p>Flutter 框架包括：Framework 和 Engine，他们运行在各自的 Platform 上。</p> <p><img src="/assets/img/flutter-framework.3a3497d8.png" alt></p> <p>Flutter 的特点：</p> <ul><li>快速开发：Flutter 的热重载可以快速地进行测试、构建 UI、添加功能并更快地修复错误；</li> <li>富有表现力，漂亮的用户界面：自带的 Material Design 和 Cupertino（iOS 风格）widget、丰富的 motion API、平滑而自然的滑动效果；</li> <li>响应式框架：使用 Flutter 的现代、响应式框架，和一系列基础 widget，轻松构建您的用户界面；</li> <li>访问本地功能和 SDK：Flutter 可以复用现有的 Java、Swift 或 Objective-C 代码，访问 iOS 和 Android 上的原生系统功能和系统 SDK；</li> <li>统一的应用开发体验：Flutter 拥有丰富的工具和库，可以帮助开发者轻松地同时在 iOS 和 Android 系统中实现想法和创意；</li> <li>原生性能：Flutter 包含了许多核心的 widget，如滚动、导航、图标和字体等，这些都可以在 iOS 和 Android 上达到原生应用一样的性能。</li></ul> <p>Flutter 正是是通过使用相同的渲染器、框架和一组 widget，来同时构建 iOS 和 Android 应用，而无需维护两套独立的代码库。</p> <p><img src="data:image/jpeg;base64,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" alt></p> <p>Flutter 将 UI 组件和渲染器从平台移动到应用程序中，这使得它们可以自定义和可扩展。Flutter 唯一要求系统提供的是 canvas，以便定制的 UI 组件可以出现在设备的屏幕上。</p> <h2 id="flutter-插件开发">Flutter 插件开发</h2> <h3 id="platform-channel-架构">Platform Channel 架构</h3> <p><img src="/assets/img/platform-channels.2326714a.png" alt="Platform Channel 架构图"></p> <p>Flutter App (Client) 通过 MethodChannel 类向 Platform 发送调用消息；Android Platform (Host) 通过 MethodChannel 类接收调用消息；iOS Platform (Host)，通过 FlutterMethodChannel 类接收调用消息。</p> <p>消息和响应以异步方式传递，以确保用户界面保持响应。</p> <p>标准平台通道使用标准消息编解码器，支持有效的二进制序列化简单类 JSON 值，例如布尔值，数字，字符串，字节缓冲区以及这些值的列表和映射。当发送和接收值时，会自动对这些值进行序列化和反序列化。</p> <p>Flutter 默认的消息编解码器是 StandardMessageCodec,其支持的数据类型如下：</p> <p><img src="/assets/img/standard-message-codec.f4dbeab5.jpg" alt></p> <h3 id="plugin-创建">Plugin 创建</h3> <p>我们通过 IDE (如 Android Studio) 创建一个插件工程，一个插件工程和一个 Flutter 工程类型，这里过程和工程结构不做详细介绍。</p> <p>Dart 层：</p> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/services.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FlutterBridge</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">MethodChannel</span> _channel <span class="token operator">=</span>
      <span class="token keyword">const</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'flutter_bridge'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">get</span> platformVersion <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> version <span class="token operator">=</span> <span class="token keyword">await</span> _channel<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'getPlatformVersion'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> version<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Android 层：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/** FlutterBridgePlugin */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlutterBridgePlugin</span> <span class="token keyword">implements</span> <span class="token class-name">MethodCallHandler</span> <span class="token punctuation">{</span>
  <span class="token comment">/** Plugin registration. */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerWith</span><span class="token punctuation">(</span><span class="token class-name">Registrar</span> registrar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">MethodChannel</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span>registrar<span class="token punctuation">.</span><span class="token function">messenger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;flutter_bridge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    channel<span class="token punctuation">.</span><span class="token function">setMethodCallHandler</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FlutterBridgePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMethodCall</span><span class="token punctuation">(</span><span class="token class-name">MethodCall</span> call<span class="token punctuation">,</span> <span class="token class-name">Result</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>call<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;getPlatformVersion&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;Android &quot;</span> <span class="token operator">+</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>iOS 层：</p> <div class="language-objectivec extra-class"><pre class="language-objectivec"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">import</span> <span class="token string">&quot;FlutterBridgePlugin.h&quot;</span></span>

<span class="token keyword">@implementation</span> FlutterBridgePlugin
<span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>registerWithRegistrar<span class="token punctuation">:</span><span class="token punctuation">(</span>NSObject<span class="token operator">&lt;</span>FlutterPluginRegistrar<span class="token operator">&gt;</span><span class="token operator">*</span><span class="token punctuation">)</span>registrar <span class="token punctuation">{</span>
  FlutterMethodChannel<span class="token operator">*</span> channel <span class="token operator">=</span> <span class="token punctuation">[</span>FlutterMethodChannel
      methodChannelWithName<span class="token punctuation">:</span><span class="token string">@&quot;flutter_bridge&quot;</span>
            binaryMessenger<span class="token punctuation">:</span><span class="token punctuation">[</span>registrar messenger<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  FlutterBridgePlugin<span class="token operator">*</span> instance <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>FlutterBridgePlugin alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>registrar addMethodCallDelegate<span class="token punctuation">:</span>instance channel<span class="token punctuation">:</span>channel<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>handleMethodCall<span class="token punctuation">:</span><span class="token punctuation">(</span>FlutterMethodCall<span class="token operator">*</span><span class="token punctuation">)</span>call result<span class="token punctuation">:</span><span class="token punctuation">(</span>FlutterResult<span class="token punctuation">)</span>result <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">@&quot;getPlatformVersion&quot;</span> isEqualToString<span class="token punctuation">:</span>call<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">@&quot;iOS &quot;</span> stringByAppendingString<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">[</span>UIDevice currentDevice<span class="token punctuation">]</span> systemVersion<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">result</span><span class="token punctuation">(</span>FlutterMethodNotImplemented<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre></div><p>我们可以看出来我们只需要在 Platform 中实现完成 registerWith 和 onMethodCall 两步就可以完成对一个插件的调用，我们可以按照这个例子初步尝试去开发一个新插件，那么一个插件是如何完整被调用的呢？我们发现不管是 Android 还是 iOS 都和 Registrar 和 MethodChannel 两个类相关。下面我们从源码角度去看一下调用的流程。</p> <h3 id="plugin-注册与调用">Plugin 注册与调用</h3> <h4 id="android-platform-部分">Android Platform 部分</h4> <p>MainActivity.java：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">FlutterActivity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">GeneratedPluginRegistrant</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">FlutterActivity</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GeneratedPluginRegistrant</span><span class="token punctuation">.</span><span class="token function">registerWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>GeneratedPluginRegistrant.java:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugins</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">PluginRegistry</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>com<span class="token punctuation">.</span>agree<span class="token punctuation">.</span>flutterbridge<span class="token punctuation">.</span></span><span class="token class-name">FlutterBridgePlugin</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * Generated file. Do not edit.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">GeneratedPluginRegistrant</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerWith</span><span class="token punctuation">(</span><span class="token class-name">PluginRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">alreadyRegisteredWith</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">FlutterBridgePlugin</span><span class="token punctuation">.</span><span class="token function">registerWith</span><span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">registrarFor</span><span class="token punctuation">(</span><span class="token string">&quot;cn.com.agree.flutterbridge.FlutterBridgePlugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">alreadyRegisteredWith</span><span class="token punctuation">(</span><span class="token class-name">PluginRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">GeneratedPluginRegistrant</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>registry<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    registry<span class="token punctuation">.</span><span class="token function">registrarFor</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过自动生成的类 GeneratedPluginRegistrant 注册 Plugin，GeneratedPluginRegistrant 类的 registerWith 方法参数类型是 PluginRegistry，显而易见这是注册插件。我们可以看一下 FlutterActivity 的实现：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlutterActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token keyword">implements</span> <span class="token class-name">Provider</span><span class="token punctuation">,</span> <span class="token class-name">PluginRegistry</span><span class="token punctuation">,</span> <span class="token class-name">ViewFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FlutterActivityDelegate</span> delegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlutterActivityDelegate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">FlutterActivityEvents</span> eventDelegate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Provider</span> viewProvider<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PluginRegistry</span> pluginRegistry<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FlutterActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventDelegate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>viewProvider <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pluginRegistry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">hasPlugin</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pluginRegistry<span class="token punctuation">.</span><span class="token function">hasPlugin</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">valuePublishedByPlugin</span><span class="token punctuation">(</span><span class="token class-name">String</span> pluginKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pluginRegistry<span class="token punctuation">.</span><span class="token function">valuePublishedByPlugin</span><span class="token punctuation">(</span>pluginKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Registrar</span> <span class="token function">registrarFor</span><span class="token punctuation">(</span><span class="token class-name">String</span> pluginKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pluginRegistry<span class="token punctuation">.</span><span class="token function">registrarFor</span><span class="token punctuation">(</span>pluginKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>FlutterActivity 中 实现了 PluginRegistry 接口，其中 registrarFor 和 hasPlugin 两个方法我们在 GeneratedPluginRegistrant 类中注册插件时有使用。</p> <p>我们接下来看看 MethodChannel 类，主要有三个重要成员变量：</p> <ul><li>name: String 类型，Channel 的名字，也是其唯一标识符；</li> <li>messager：BinaryMessenger 类型，消息信使，是消息的发送与接收的工具；</li> <li>codec: MethodCodec 类型，消息的编解码器。</li></ul> <blockquote><p>消息信使: BinaryMessenger</p></blockquote> <p>BinaryMessenger 是 Platform 端与 Flutter 端通信的工具，其通信使用的消息格式为二进制格式数据。当我们初始化一个 Channel，并向该 Channel 注册处理消息的 Handler 时，实际上会生成一个与之对应的 BinaryMessageHandler，并以 channel name 为 key，注册到 BinaryMessenger 中。当 Flutter 端发送消息到 BinaryMessenger 时，BinaryMessenger 会根据其入参 channel 找到对应的 BinaryMessageHandler，并交由其处理。</p> <p>BinaryMessenger 在 Android 端是一个接口，其具体实现为 FlutterNativeView。而其在 iOS 端是一个协议，名称为 FlutterBinaryMessenger，FlutterViewController 遵循了它。</p> <p>BinaryMessenger 并不知道 Channel 的存在，它只和 BinaryMessageHandler 打交道。而 Channel 和 BinaryMessageHandler 则是一一对应的。由于 Channel 从 BinaryMessageHandler 接收到的消息是二进制格式数据，无法直接使用，故 Channel 会将该二进制消息通过 Codec（消息编解码器）解码为能识别的消息并传递给 Handler 进行处理。</p> <p>​ 当 Handler 处理完消息之后，会通过回调函数返回 result，并将 result 通过编解码器编码为二进制格式数据，通过 BinaryMessenger 发送回 Flutter 端。</p> <blockquote><p>消息处理器：Handler</p></blockquote> <p>​ 当我们接收二进制格式消息并使用 Codec 将其解码为 Handler 能处理的消息后，就该 Handler 上场了。Flutter 定义了三种类型的 Handler，与 Channel 类型一一对应。我们向 Channel 注册一个 Handler 时，实际上就是向 BinaryMessager 注册一个与之对应的 BinaryMessageHandler。当消息派分到 BinaryMessageHandler 后，Channel 会通过 Codec 将消息解码，并传递给 Handler 处理。</p> <p>MethodChannel.MethodCallHandler 接口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MethodCallHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">onMethodCall</span><span class="token punctuation">(</span><span class="token class-name">MethodCall</span> var1<span class="token punctuation">,</span> <span class="token class-name">MethodChannel<span class="token punctuation">.</span>Result</span> var2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>MethodChannel.Result 接口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> var1<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> var2<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> var3<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="参考">参考</h2> <ul><li><a href="https://juejin.im/post/5a38e3f651882527a13d9eb2" target="_blank" rel="noopener noreferrer">Flutter 的革命之处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://flutter.io/docs/development/platform-integration/platform-channels" target="_blank" rel="noopener noreferrer">flutter.io/platform-channels<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/38477584" target="_blank" rel="noopener noreferrer">Flutter Plugin 调用 Native APIs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/43163159" target="_blank" rel="noopener noreferrer">深入理解 Flutter Platform Channel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Flutter 在混合项目中的构建和集成:
https://juejin.im/post/5bac9b1de51d450e452ac1c7</p> <p>Flutter 初始化流程:
https://www.jianshu.com/p/02dfe839c4d4?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</p> <p>Android 的 Flutter 依赖的文件：</p> <ol><li>Flutter 库和引擎：</li></ol> <p>icudtl.dat、libflutter.so、还有一些 class 文件。这些都封装在 flutter.jar 中，这个 jar 文件位于 Flutter 库目录下的[flutter/bin/cache/artifacts/engine]下。</p> <ol start="2"><li>Flutter工程产物：</li></ol> <p>isolate_snapshot_data、isolate_snapshot_instr、vm_snapshot_data、vm_snapshot_instr、flutter_assets。</p> <p>isolate_snapshot_data 应用程序数据段
isolate_snapshot_instr 应用程序指令段
vm_snapshot_data VM 虚拟机数据段
vm_snapshot_instr VM 虚拟机指令段</p> <ol start="3"><li>Flutter Plugin：</li></ol> <p>各个plugin编译出来的aar文件。</p> <p>iOS的Flutter依赖的文件：</p> <ol><li>Flutter库和引擎：Flutter.framework</li> <li>Flutter工程的产物：App.framework</li> <li>Flutter Plugin：编译出来的各种plugin的framework，图中的其他framework</li></ol> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/19.c7be2474.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
