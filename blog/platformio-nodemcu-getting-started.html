<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于 PlatformIO 平台玩转 NodeMCU 入门篇 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/4.61024115.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/67.5cf5a3bc.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>基于 PlatformIO 平台玩转 NodeMCU 入门篇</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/platformio-nodemcu-getting-started.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#platformio-简介" class="sidebar-link">PlatformIO 简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#platform" class="sidebar-link">Platform</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#frameworks" class="sidebar-link">Frameworks</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#boards" class="sidebar-link">Boards</a></li></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#nodemcu-开发板" class="sidebar-link">NodeMCU 开发板</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#环境准备" class="sidebar-link">环境准备</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#新建工程" class="sidebar-link">新建工程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#工程配置" class="sidebar-link">工程配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#platformio-ini" class="sidebar-link">platformio.ini</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#监视器波特率" class="sidebar-link">监视器波特率</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#查看串口端口" class="sidebar-link">查看串口端口</a></li></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#代码烧写" class="sidebar-link">代码烧写</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#代码构建" class="sidebar-link">代码构建</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#固件上传" class="sidebar-link">固件上传</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#串口监视器" class="sidebar-link">串口监视器</a></li></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#代码分析" class="sidebar-link">代码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#esp8266-工作模式" class="sidebar-link">ESP8266 工作模式</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#wifi-接口核心函数" class="sidebar-link">WiFi 接口核心函数</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#软件定时器核心函数" class="sidebar-link">软件定时器核心函数</a></li><li class="sidebar-sub-header"><a href="/blog/platformio-nodemcu-getting-started.html#wifi-station-machine-demo-分析" class="sidebar-link">wifistationmachine_demo 分析</a></li></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#后记" class="sidebar-link">后记</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/platformio-nodemcu-getting-started.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="基于-platformio-平台玩转-nodemcu-入门篇">基于 PlatformIO 平台玩转 NodeMCU 入门篇</h1> <h2 id="前言">前言</h2> <p>近期关注到《物联网开发实战》课程，买了一套极客商城的开发套件，打算把自己业余时间学习过程中的一些收获记录一下。之前学习 Gokit3 开发板的过程中是在 Windows 系统上从零开始搭建编译环境的，整体的开发体验上感觉还是比较麻烦琐碎，不过对 Flash 下载固件有了一些基本认知，这次打算在 MacOS 平台基于 PlatformIO IDE 进行尝试。</p> <h2 id="platformio-简介">PlatformIO 简介</h2> <p><img src="/assets/img/platformio.d457bbef.png" alt="PlatformIO 简介"></p> <p>PlatformIO 是专业的嵌入式开发协作平台，支持 924 个的嵌入式设备，41 个的开发平台，23 个的框架。Arduino, ARM mbed, Espressif (ESP8266/ESP32), RISC-V, STM32, FPGA, FreeRTOS 等都在 PlatformIO 的支持范围内。PlatformIO 在 Atom, Subliem Text, Vim, VS Code, Eclipse 等开发工具上都有支持，而 VS Code 的 PlatformIO IDE 是其主力推荐的开发环境。智能的代码提示和 Linter，代码库管理，统一的代码调试体验，内置的 PlatformIO Terminal 等等强大的功能，使得不管你开发任何一个设备，都能得到相近的开发体验。</p> <p>在使用 PlatformIO 之前我们先来了解一些基本概念。</p> <h3 id="platform"><a href="https://platformio.org/platforms" target="_blank" rel="noopener noreferrer">Platform<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>平台，指的是芯片平台，具体来说就是芯片公司推出的系列芯片的开发平台。PlatformIO 支持嵌入式和桌面两种类型的开发平台，提供对各平台预先构建的工具链，调试器，上传器和框架，支持在 Mac、Linux (+ARM) 和 Windows 上开发。</p> <p>支持的嵌入式平台包括：</p> <ul><li>Atmel 公司：<a href="https://platformio.org/platforms/atmelavr" target="_blank" rel="noopener noreferrer">Atmel AVR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/platforms/atmelsam" target="_blank" rel="noopener noreferrer">Atmel SAM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/platforms/atmelmegaavr" target="_blank" rel="noopener noreferrer">Atmel megaAVR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>乐鑫(Espressif)公司：<a href="https://platformio.org/platforms/espressif8266" target="_blank" rel="noopener noreferrer">ESP8266<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/platforms/espressif32" target="_blank" rel="noopener noreferrer">ESP32<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>飞思卡尔(Freescale)公司：<a href="https://platformio.org/platforms/freescalekinetis" target="_blank" rel="noopener noreferrer">Freescale Kinetis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Intel 公司：<a href="https://platformio.org/platforms/intel_arc32" target="_blank" rel="noopener noreferrer">Intel ARC32<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/platforms/intel_mcs51" target="_blank" rel="noopener noreferrer">Intel MCS-51 (8051)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>ST 公司：<a href="https://platformio.org/platforms/ststm32" target="_blank" rel="noopener noreferrer">ST STM32<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/platforms/ststm8" target="_blank" rel="noopener noreferrer">ST STM8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>德州仪器(TI)公司：<a href="https://docs.platformio.org/en/latest/platforms/timsp430.html" target="_blank" rel="noopener noreferrer">TI MSP430<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://docs.platformio.org/en/latest/platforms/titiva.html" target="_blank" rel="noopener noreferrer">TI TIVA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>GreenWaves公司：<a href="https://docs.platformio.org/en/latest/platforms/riscv_gap.html" target="_blank" rel="noopener noreferrer">RISC-V GAP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>...</li></ul> <p>Atmel AVR 一般指的就是 Arduino 系列开发板使用的芯片。之前大学的时候基于 TI 的 MSP430 做过智能小车和电子设计大赛，现在关于嵌入式的基础认知就是那个时候建立的。很多人入门 IoT 都会选择 ESP8266 平台，本文实战也会以 ESP8266 平台为例说明。</p> <h3 id="frameworks"><a href="https://platformio.org/frameworks" target="_blank" rel="noopener noreferrer">Frameworks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>框架，指的是开发框架，通俗来讲就是 SDK，一般会由官方或第三方提供一个软件库。目前支持的框架包括：</p> <ul><li><a href="https://platformio.org/frameworks/arduino" target="_blank" rel="noopener noreferrer">Arduino<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/cmsis" target="_blank" rel="noopener noreferrer">CMSIS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/esp8266-nonos-sdk" target="_blank" rel="noopener noreferrer">ESP8266 Non-OS SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/esp8266-rtos-sdk" target="_blank" rel="noopener noreferrer">ESP8266 RTOS SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/espidf" target="_blank" rel="noopener noreferrer">Espressif IoT Development Framework<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/freertos" target="_blank" rel="noopener noreferrer">FreeRTOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/freedom-e-sdk" target="_blank" rel="noopener noreferrer">Freedom E SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/gd32vf103-sdk" target="_blank" rel="noopener noreferrer">GigaDevice GD32V SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/kendryte-freertos-sdk" target="_blank" rel="noopener noreferrer">Kendryte FreeRTOS SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/kendryte-standalone-sdk" target="_blank" rel="noopener noreferrer">Kendryte Standalone SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/mbed" target="_blank" rel="noopener noreferrer">Mbed<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/nuclei-sdk" target="_blank" rel="noopener noreferrer">Nuclei SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/pulp-os" target="_blank" rel="noopener noreferrer">PULP OS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/pumbaa" target="_blank" rel="noopener noreferrer">Pumbaa<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/siwisdk" target="_blank" rel="noopener noreferrer">SIWI GSM Software Development Kit for MT6261 and MT2503 SoC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/stm32cube" target="_blank" rel="noopener noreferrer">STM32Cube<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/shakti-sdk" target="_blank" rel="noopener noreferrer">Shakti SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/simba" target="_blank" rel="noopener noreferrer">Simba<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/spl" target="_blank" rel="noopener noreferrer">Standard Peripheral Library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/wd-riscv-sdk" target="_blank" rel="noopener noreferrer">WD-Firmware<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/wiringpi" target="_blank" rel="noopener noreferrer">WiringPi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/zephyr" target="_blank" rel="noopener noreferrer">Zephyr RTOS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://platformio.org/frameworks/libopencm3" target="_blank" rel="noopener noreferrer">libopencm3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>因为 Arduino 极具影响力，所以很多芯片平台也都有了自己的 Arduino 框架，现在 Arduino 框架平台支持的平台有很多，比如 Atmel AVR、Atmel SAM、Espressif 32、Espressif 8266、Infineon XMC、Intel ARC32、Kendryte K210、Microchip PIC32、Nordic nRF51、Nordic nRF52、T STM32、ST STM8 、Teensy、TI MSP430 、TI TIVA。</p> <p>反过来讲，一个平台有可能支持多个不同开发框架。例如 ESP8266 平台支持的框架有：<a href="https://platformio.org/frameworks/esp8266-nonos-sdk" target="_blank" rel="noopener noreferrer">ESP8266 Non-OS SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/frameworks/esp8266-rtos-sdk" target="_blank" rel="noopener noreferrer">ESP8266 RTOS SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/frameworks/arduino" target="_blank" rel="noopener noreferrer">Arduino<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://platformio.org/frameworks/simba" target="_blank" rel="noopener noreferrer">Simba<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 等。ESP8266 官方的 SDK 按照是否基于操作系统可分为：Non-OS 和 RTOS 两种版本。</p> <ul><li><strong>Non-OS SDK</strong>：Non-OS SDK 是不基于操作系统的 SDK，提供 IOT_Demo 和 AT 的编译。
<ul><li>开源项目地址：<a href="https://github.com/espressif/ESP8266_NONOS_SDK" target="_blank" rel="noopener noreferrer">https://github.com/espressif/ESP8266_NONOS_SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>SDK API 文档：<a href="https://www.espressif.com/sites/default/files/documentation/2c-esp8266_non_os_sdk_api_reference_cn.pdf" target="_blank" rel="noopener noreferrer">https://www.espressif.com/sites/default/files/documentation/2c-esp8266_non_os_sdk_api_reference_cn.pdf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>RTOS SDK</strong>：RTOS SDK 基于 FreeRTOS。
<ul><li>开源项目地址： <a href="https://github.com/espressif/ESP8266_RTOS_SDK" target="_blank" rel="noopener noreferrer">https://github.com/espressif/ESP8266_RTOS_SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>SDK API 文档：<a href="https://www.espressif.com/sites/default/files/documentation/20b-esp8266_rtos_sdk_api_reference.pdf" target="_blank" rel="noopener noreferrer">https://www.espressif.com/sites/default/files/documentation/20b-esp8266_rtos_sdk_api_reference.pdf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>RTOS SDK 是 Non-OS 的新版本，新版 ESP8266_RTOS_SDK 可帮助客户避免对单一 SDK 的依赖，允许客户应用程序同时兼容多款乐鑫芯片，包括 ESP8266 系列、ESP32 系列以及未来发布的新产品。</p> <h3 id="boards"><a href="https://platformio.org/boards" target="_blank" rel="noopener noreferrer">Boards<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>开发版，PlatformIO 支持绝大部分流行的开发板，比如 Arduino 的全系开发板、NodeMCU 的全系列开发板，STM32 的 Nucleo 和 Discovery 系列评估板。PlatformIO 针对支持的开发板都提供完整的项目生成脚本，新建项目的时候选择对应的开发板和框架即可完成工程初始化。</p> <p>这里我们类比一下 Android 生态来总结一下上述的三个概念：Platform 类比于 Android 平台，Frameworks 类比 Android 系统上层的 SDK 及框架，Boards 类似于基于 Android 的移动设备，例如华为、小米等厂商的各系列手机、Pad 之类的设备。</p> <h2 id="nodemcu-开发板">NodeMCU 开发板</h2> <p>我手上拿到是下面这款安信可 NodeMCU ESP8266 的开发板，该开发板延续了 NodeMCU 1.0 的设计，搭建了 ESP8266 ESP-12D 模组及 CP2102 驱动。NodeMCU 极大的简化 ESP8266 刷写固件的接线方式，直接即插即用。详细参数可以参考 <a href="https://docs.ai-thinker.com/_media/esp8266/docs/nodemcu8266_v1.2%E8%A7%84%E6%A0%BC%E4%B9%A6.pdf" target="_blank" rel="noopener noreferrer">NodeMCU-8266 规格书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><img src="/assets/img/nodemcu.36d9bca0.png" alt="NodeMCU"></p> <p>乐鑫 ESP8266 芯片官网：<a href="https://www.espressif.com/zh-hans/products/socs/esp8266" target="_blank" rel="noopener noreferrer">https://www.espressif.com/zh-hans/products/socs/esp8266<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ESP8266 是一款面向物联网应用的 WiFi MCU，具有以下特点：</p> <p><img src="/assets/img/esp8266.2b44abf0.png" alt="ESP8266"></p> <h2 id="环境准备">环境准备</h2> <p>1.下载 VS Code IDE，然后在 VS Code  拓展市场安装 PlatformIO IDE 拓展。</p> <p><img src="/assets/img/pio-vscode.f793c78e.png" alt="VS Code 插件"></p> <p>2.CP2102 USB 转 UART 驱动：<a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers" target="_blank" rel="noopener noreferrer">https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>下载完成后可以在 <strong>关于本机 / 系统报告</strong> 中查看：</p> <p><img src="/assets/img/usb-to-uart.fae6581c.png" alt></p> <h2 id="新建工程">新建工程</h2> <p>这里我以 NodeMCU 1.0 开发板选择 ESP8266 RTOS SDK 框架为例加以说明。</p> <p><img src="/assets/img/new-project.29ef25f8.png" alt></p> <p>选择好参数、设置好项目名称之后就可以点击 Finish 完成了，然后等待第一次自动配置环境。自动生成的工程目录结构如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>├── <span class="token punctuation">.</span>pio            # 存放工程编译产生的文件
	└── build
		├── nodemcuv2
		└── project<span class="token punctuation">.</span>checksum
├── <span class="token punctuation">.</span>vscode         # 存放针对工程定制化的 vscode 配置文件
	├── c_cpp_properties<span class="token punctuation">.</span>json
	├── extensions<span class="token punctuation">.</span>json
	└── launch<span class="token punctuation">.</span>json
├── include         # 存放统一管理的 h 头文件
├── lib             # 存放自己编写的库文件
├── src             # 存放工程项目的 <span class="token constant">C</span><span class="token operator">/</span><span class="token constant">C</span><span class="token operator">++</span> 源文件
├── test            # 存放工程项目的测试文件
└── platformio<span class="token punctuation">.</span>ini  # 项目的核心配置文件，需要了解用到的配置项
</code></pre></div><p>c_cpp_properties.json 是 VS Code C/C++ 工程配置文件，c_cpp_properties.json 中定义了工程依赖的库及交叉编译工具 xtensa-lx106-elf-gcc 的路径。我们可以看到工程主要用到了两个包：</p> <ul><li>framework-esp8266-rtos-sdk：RTOS SDK 框架文件，位于 ~/.platformio/packages/framework-esp8266-rtos-sdk 目录</li> <li>toolchain-xtensa：交叉编译工具链，位于 ~/.platformio/packages/toolchain-xtensa@1.40802.0</li></ul> <p>launch.json 是工程调试配置文件，具体文档可以参考：<a href="https://docs.platformio.org/en/latest/plus/debugging.html" target="_blank" rel="noopener noreferrer">Debugging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>我们看一下 ~/.platformio 的目录结构如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>├── appstate<span class="token punctuation">.</span>json
├── homestate<span class="token punctuation">.</span>json
├── packages        # 平台依赖的包
	├── framework<span class="token operator">-</span>esp8266<span class="token operator">-</span>rtos<span class="token operator">-</span>sdk
	├── tool<span class="token operator">-</span>esptool
	├── tool<span class="token operator">-</span>esptoolpy
	├── tool<span class="token operator">-</span>mklittlefs
	├── toolchain<span class="token operator">-</span>xtensa
	<span class="token operator">...</span>
├── penv             # Python版本管理工具
├── platforms        # 本地缓存的平台文件
	├── espressif8266
    <span class="token operator">...</span>
└── python3          # Python3 环境
</code></pre></div><p>新建的项目是空白的项目，我们可以从 SDK 文件夹拷贝一份代码示例进行修改。我们可以 packages/framework-esp8266-rtos-sdk/examples 或 platforms/espressif8266/examples 中拷贝一份示例工程开始。</p> <p><img src="/assets/img/framework-example.97719794.png" alt></p> <p><img src="/assets/img/platform-example.f85d78fc.png" alt></p> <p>下面我将以 wifi_station_machine_demo 为例说明。</p> <h2 id="工程配置">工程配置</h2> <p>我们从 wifi_station_machine_demo 中将 user/user_main.c 和 user/wifi_state_machine.c 拷贝到工程的 src 目录下，将 include/user_config.h 和 include/wifi_state_machine.h 拷贝到 include 目录下。修改 include/user_config.h 中的 SSID 和 PASSWORD，并修改 platformio.ini 配置文件。</p> <h3 id="platformio-ini">platformio.ini</h3> <p>platformio.ini 配置文件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>env<span class="token operator">:</span>nodemcuv2<span class="token punctuation">]</span>
platform <span class="token operator">=</span> espressif8266
board <span class="token operator">=</span> nodemcuv2
framework <span class="token operator">=</span> esp8266<span class="token operator">-</span>rtos<span class="token operator">-</span>sdk
monitor_speed <span class="token operator">=</span> <span class="token number">74880</span>
monitor_port <span class="token operator">=</span> <span class="token operator">/</span>dev<span class="token operator">/</span>cu<span class="token punctuation">.</span>SLAB_USBtoUART
</code></pre></div><p>参数说明：</p> <ul><li>monitor_speed：监视器波特率设置为 74880</li> <li>monitor_port：监视器端口设置，设置为连接的串口端口</li></ul> <h3 id="监视器波特率">监视器波特率</h3> <p>ESP8266_RTOS_SDK 默认使用 UART0 打印调试信息，默认波特率为 74880。我们也可以使用下面的方法修改成 115200。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>#include <span class="token string">&quot;uart.h&quot;</span>

<span class="token operator">...</span>

<span class="token keyword">void</span> <span class="token function">user_init</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span></span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    UART_ConfigTypeDef  uart_config<span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>baud_rate               <span class="token operator">=</span>   <span class="token constant">BIT_RATE_115200</span><span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>data_bits               <span class="token operator">=</span>   UART_WordLength_8b<span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>parity                  <span class="token operator">=</span>   USART_Parity_None<span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>stop_bits               <span class="token operator">=</span>   USART_StopBits_1<span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>flow_ctrl               <span class="token operator">=</span>   USART_HardwareFlowControl_None<span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>UART_RxFlowThresh       <span class="token operator">=</span>   <span class="token number">120</span><span class="token punctuation">;</span>
    uart_config<span class="token punctuation">.</span>UART_InverseMask        <span class="token operator">=</span>   UART_None_Inverse<span class="token punctuation">;</span>
    <span class="token function">UART_ParamConfig</span><span class="token punctuation">(</span><span class="token constant">UART0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uart_config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="查看串口端口">查看串口端口</h3> <p>Mac OS 系统查看串口端口的两种方法。</p> <p><strong>1.通用方法</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ls <span class="token operator">/</span>dev<span class="token operator">/</span>cu<span class="token punctuation">.</span><span class="token operator">*</span>
</code></pre></div><p><img src="/assets/img/dev-ls.fecfcdc7.png" alt></p> <p>串口 port 为 /dev/cu.SLAB_USBtoUART。</p> <p><strong>2.使用 pio device list 命令</strong></p> <p><img src="/assets/img/pio-cli.c9d96905.png" alt></p> <p>打开 PlatformIO CLI，输入 pio device list 命令可以获取连接的串口信息。</p> <h2 id="代码烧写">代码烧写</h2> <h3 id="代码构建">代码构建</h3> <p>我们修改完代码后，可以点击 Project Tasks 中的 Build 任务或点击状态栏的图标进行构建。构建的过程是编译代码，工程 .pio/build/nodemcuv2 目录下的文件就是编译生成的产物。</p> <p><img src="/assets/img/pio-build.7291d233.png" alt></p> <h3 id="固件上传">固件上传</h3> <p>上传的过程就是将编译产物(也称固件)上传到我们的开发板上。</p> <p><img src="/assets/img/pio-upload.0cace878.png" alt></p> <h3 id="串口监视器">串口监视器</h3> <p>我们可以直接在 IDE 端打开串口调试器查看日志信息，不需要额外的串口调试工具即可查看日志还是比较方便的。注意需要按一下 RST 按键重启模组。</p> <p><img src="/assets/img/pio-monitor.e9a347c3.png" alt></p> <h2 id="代码分析">代码分析</h2> <h3 id="esp8266-工作模式">ESP8266 工作模式</h3> <p>ESP8266 利用 WiFi 联网时有三种工作模式。</p> <ul><li><strong>Station 模式</strong>：工作在 Station 模式下的 ESP8266 就像是一个接收机一样，它可以接收来自无线路由器发出的信号。ESP8266 模块通过路由器连接互联网，手机或电脑通过互联网实现对设备的远程控制。</li></ul> <p><img src="/assets/img/NodeMCU-Station.eef9f475.png" alt></p> <ul><li><strong>SoftAP 模式</strong>：无线接入点的简称，ESP8266 模块作为热点，实现手机或电脑直接与模块通信，实现局域网无线控制。</li></ul> <p><img src="/assets/img/NodeMCU-Access-Point.cdc5a882.png" alt></p> <ul><li><strong>Station + SoftAP 模式</strong>：两种模式共存，既可以通过路由器连接到互联网，也可以作为 WiFi 热点，使其他设备连接到模块，实现广域网与局域网的无缝切换。<br></li></ul> <h3 id="wifi-接口核心函数">WiFi 接口核心函数</h3> <p>RTOS SDK API 基本兼容 Non-OS SDK API，可以参考：<a href="https://www.espressif.com/sites/default/files/documentation/2c-esp8266_non_os_sdk_api_reference_cn.pdf" target="_blank" rel="noopener noreferrer">ESP8266 Non-OS SDK API 手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>示例采用固定 WiFi SSID 和密码的方式连接，主要用到的函数为：</p> <p><img src="/assets/img/wifi-set-opmode.40df97c3.png" alt></p> <p><img src="/assets/img/wifi-set-event-handler-cb.a9aca9f6.png" alt></p> <p><img src="/assets/img/wifi-station-set-config.597b9e57.png" alt></p> <p><img src="/assets/img/wifi-station-dhcpc-status.3a4033d9.png" alt></p> <p><img src="/assets/img/wifi-station-connect.f27af3f9.png" alt></p> <p><img src="/assets/img/wifi-station-get-connect-status.f33c7d80.png" alt></p> <h3 id="软件定时器核心函数">软件定时器核心函数</h3> <p><img src="/assets/img/os-timer-arm.f7786e8f.png" alt></p> <p><img src="/assets/img/os-timer-disarm.942ebf7f.png" alt></p> <p><img src="/assets/img/os-timer-setfn.baa220aa.png" alt></p> <h3 id="wifi-station-machine-demo-分析">wifi_station_machine_demo 分析</h3> <p>ESP8266 物联网平台的所有网络功能均在库中实现，对用户来说是不透明。用户应用的初始化功能可以在 user_main.c 中实现。void user_init(void) 是上层程序的入口函数，给用户提供一个初始化接口，用户可在该函数内增加硬件初始化、网络参数设置、定时器器初始化等功能。 示例中 ESP8266 RTOS SDK 使用的版本是 1.5.0-beta.5，接下来我将分析一下示例代码的关键逻辑。</p> <p>示例代码的整体逻辑为：</p> <ol><li>初始化 station 建立连接和断开连接的回调函数</li> <li>设置 ESP8266 的工作模式为 Station 模式</li> <li>设置 WiFi 的 SSID 和 密码</li> <li>开始连接 WiFi</li> <li>监听 station 连接，检查 WiFi 连接状态</li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/******************************************************************************
 * FunctionName : user_init
 * Description  : entry of user application, init user function here
 * Parameters   : none
 * Returns      : none
*******************************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">user_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 打印 ESP8266 RTOS SDK 版本</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SDK version:%s\n&quot;</span><span class="token punctuation">,</span> <span class="token function">system_get_sdk_version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 监听 station 连接</span>
    <span class="token function">set_on_station_connect</span><span class="token punctuation">(</span>on_wifi_connect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听 station 断开连接</span>
    <span class="token function">set_on_station_disconnect</span><span class="token punctuation">(</span>on_wifi_disconnect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 初始化 WiFi 模块 </span>
    <span class="token function">init_esp_wifi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 停止 WiFi AP 模式</span>
    <span class="token function">stop_wifi_ap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 启动 WiFi station 模式</span>
    <span class="token function">start_wifi_station</span><span class="token punctuation">(</span>SSID<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到 user_init 中代码逻辑非常简单清晰，除了 system_get_sdk_version 是 SDK 的 API，其他都是 wifi_state_machine.c 驱动中定义的方法。上面的代码开启了 ESP8266 的 Station 模式，从而可以通过路由连接互联网。</p> <p>代码中有几处代码值得说一下：</p> <ol><li>使用 &amp;= ~ 位运算关闭 SoftAP 模式，使用 |= 位运算开启 Station 模式</li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// 关闭 SOFTAP_MODE</span>
WIFI_MODE mode <span class="token operator">=</span> <span class="token function">wifi_get_opmode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mode <span class="token operator">&amp;=</span> <span class="token operator">~</span>SOFTAP_MODE<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">wifi_set_mode</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">os_printf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to disable AP mode!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开启 STATION_MODE</span>
WIFI_MODE mode <span class="token operator">=</span> <span class="token function">wifi_get_opmode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> STATION_MODE<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	mode <span class="token operator">|=</span> STATION_MODE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">wifi_set_mode</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">os_printf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to enable Station mode!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>使用软件定时器检查 WiFi 连接状态</li></ol> <div class="language-c extra-class"><pre class="language-c"><code>LOCAL <span class="token keyword">void</span> ICACHE_FLASH_ATTR <span class="token function">wait_for_connection_ready</span><span class="token punctuation">(</span>uint8 flag<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">os_timer_disarm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">wifi_station_connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">os_printf</span><span class="token punctuation">(</span><span class="token string">&quot;connected\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">os_printf</span><span class="token punctuation">(</span><span class="token string">&quot;reconnect after 2s\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">os_timer_setfn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">os_timer_func_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>wait_for_connection_ready<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">os_timer_arm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

LOCAL <span class="token keyword">void</span> ICACHE_FLASH_ATTR <span class="token function">on_wifi_connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 取消定时器定时</span>
    <span class="token function">os_timer_disarm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置定时器回调函数，使⽤定时器，必须设置回调函数。</span>
    <span class="token function">os_timer_setfn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">os_timer_func_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>wait_for_connection_ready<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 使能毫秒级定时器</span>
    <span class="token function">os_timer_arm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>timer<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>软件定时器由软件实现，定时器的函数在任务中被执⾏。因为任务可能被中断，或者被 其他⾼优先级的任务延迟，因此以下 os_timer 系列的接⼝并不能保证定时器精确执⾏。 如果需要精确的定时，例如，周期性操作某 GPIO，请使⽤硬件中断定时器，具体可参考 hw_timer.c，硬件定时器的执⾏函数在中断⾥被执⾏。</p> <p>注意：</p> <ul><li>对于同⼀个 timer，os_timer_arm 或 os_timer_arm_us 不能重复调⽤，必须先 os_timer_disarm；</li> <li>os_timer_setfn 必须在 timer 未使能的情况下调⽤，在 os_timer_arm 或 os_timer_arm_us 之前或者 os_timer_disarm 之后。</li></ul> <h2 id="后记">后记</h2> <p>本文行文至此，我们基于 PlatformIO 平台在 NodeMCU 运行了一个示例代码，对 ESP8266 三种工作模式有一个基本认识，基本掌握 Station 模式的使用流程，也初步掌握软件定时器的用法。后续会继续围绕 ESP8266，并结合具体的传感器完成实战的开发。</p> <h2 id="参考">参考</h2> <ul><li><a href="https://www.espressif.com/sites/default/files/documentation/2a-esp8266-sdk_getting_started_guide_cn.pdf" target="_blank" rel="noopener noreferrer">ESP8266 SDK 入门指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.espressif.com/sites/default/files/documentation/esp8266-technical_reference_cn.pdf" target="_blank" rel="noopener noreferrer">ESP8266 技术参考手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.espressif.com/sites/default/files/documentation/0a-esp8266ex_datasheet_cn.pdf" target="_blank" rel="noopener noreferrer">ESP8266EX 技术规格书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/4.61024115.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
