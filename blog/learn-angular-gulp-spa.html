<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Angular 系列学习笔记（二）—— 基于 gulp 构建 Angular 单页面应用 | 匠心博客</title>
    <meta name="description" content="小青年,匠心,小青年博客,匠心博客,前端开发,android,技术宅,菜鸟教程,一个神奇的博客。">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.685c010a.css" as="style"><link rel="preload" href="/assets/js/app.f3e141ba.js" as="script"><link rel="preload" href="/assets/js/67.5cf5a3bc.js" as="script"><link rel="preload" href="/assets/js/18.c373a36e.js" as="script"><link rel="preload" href="/assets/js/34.124c31c0.js" as="script"><link rel="prefetch" href="/assets/js/1.1950ec81.js"><link rel="prefetch" href="/assets/js/10.7f857e71.js"><link rel="prefetch" href="/assets/js/100.e03c01d2.js"><link rel="prefetch" href="/assets/js/101.7b790a2f.js"><link rel="prefetch" href="/assets/js/102.a7aa77f9.js"><link rel="prefetch" href="/assets/js/103.d473991c.js"><link rel="prefetch" href="/assets/js/104.9fe8785c.js"><link rel="prefetch" href="/assets/js/105.7291ae49.js"><link rel="prefetch" href="/assets/js/106.2c35a2f4.js"><link rel="prefetch" href="/assets/js/107.a71ccb64.js"><link rel="prefetch" href="/assets/js/108.9d6f54a8.js"><link rel="prefetch" href="/assets/js/109.e77d12ca.js"><link rel="prefetch" href="/assets/js/11.5378ae65.js"><link rel="prefetch" href="/assets/js/12.9aca40f8.js"><link rel="prefetch" href="/assets/js/13.ce2b655c.js"><link rel="prefetch" href="/assets/js/14.7488ca24.js"><link rel="prefetch" href="/assets/js/15.9c07ac98.js"><link rel="prefetch" href="/assets/js/16.8f57294c.js"><link rel="prefetch" href="/assets/js/17.4f7ae4ec.js"><link rel="prefetch" href="/assets/js/19.c7be2474.js"><link rel="prefetch" href="/assets/js/2.7f7e5268.js"><link rel="prefetch" href="/assets/js/20.f8833113.js"><link rel="prefetch" href="/assets/js/21.e71dd521.js"><link rel="prefetch" href="/assets/js/22.92dc7b77.js"><link rel="prefetch" href="/assets/js/23.285557d3.js"><link rel="prefetch" href="/assets/js/24.a803551c.js"><link rel="prefetch" href="/assets/js/25.dbeaa19d.js"><link rel="prefetch" href="/assets/js/26.9ca97076.js"><link rel="prefetch" href="/assets/js/27.d1a2911b.js"><link rel="prefetch" href="/assets/js/28.25c216b3.js"><link rel="prefetch" href="/assets/js/29.9dc30af4.js"><link rel="prefetch" href="/assets/js/30.1e9d6e06.js"><link rel="prefetch" href="/assets/js/31.3d7dbe62.js"><link rel="prefetch" href="/assets/js/32.36371ba7.js"><link rel="prefetch" href="/assets/js/33.78edc66d.js"><link rel="prefetch" href="/assets/js/35.a5470008.js"><link rel="prefetch" href="/assets/js/36.acde7543.js"><link rel="prefetch" href="/assets/js/37.f6648812.js"><link rel="prefetch" href="/assets/js/38.1885784f.js"><link rel="prefetch" href="/assets/js/39.af4b4bbd.js"><link rel="prefetch" href="/assets/js/4.61024115.js"><link rel="prefetch" href="/assets/js/40.ec6e88a9.js"><link rel="prefetch" href="/assets/js/41.67d4e8b7.js"><link rel="prefetch" href="/assets/js/42.7de428af.js"><link rel="prefetch" href="/assets/js/43.b4f51fa8.js"><link rel="prefetch" href="/assets/js/44.487d119d.js"><link rel="prefetch" href="/assets/js/45.2206665b.js"><link rel="prefetch" href="/assets/js/46.125163cc.js"><link rel="prefetch" href="/assets/js/47.8722f507.js"><link rel="prefetch" href="/assets/js/48.b8bfe77f.js"><link rel="prefetch" href="/assets/js/49.77fac897.js"><link rel="prefetch" href="/assets/js/5.3395f0b5.js"><link rel="prefetch" href="/assets/js/50.d68289a2.js"><link rel="prefetch" href="/assets/js/51.d9d70556.js"><link rel="prefetch" href="/assets/js/52.6a2c9e02.js"><link rel="prefetch" href="/assets/js/53.ff13cf8b.js"><link rel="prefetch" href="/assets/js/54.7e844902.js"><link rel="prefetch" href="/assets/js/55.80aa3d86.js"><link rel="prefetch" href="/assets/js/56.a4124774.js"><link rel="prefetch" href="/assets/js/57.55eb7355.js"><link rel="prefetch" href="/assets/js/58.7d0e2bc5.js"><link rel="prefetch" href="/assets/js/59.9cdd695c.js"><link rel="prefetch" href="/assets/js/6.77e8533c.js"><link rel="prefetch" href="/assets/js/60.54318be9.js"><link rel="prefetch" href="/assets/js/61.82e1ea82.js"><link rel="prefetch" href="/assets/js/62.b065e499.js"><link rel="prefetch" href="/assets/js/63.bb770dde.js"><link rel="prefetch" href="/assets/js/64.996fdbfd.js"><link rel="prefetch" href="/assets/js/65.54f3baf3.js"><link rel="prefetch" href="/assets/js/66.38d28ab3.js"><link rel="prefetch" href="/assets/js/68.f2418476.js"><link rel="prefetch" href="/assets/js/69.162d06c4.js"><link rel="prefetch" href="/assets/js/7.a2cd9d6c.js"><link rel="prefetch" href="/assets/js/70.80f1252b.js"><link rel="prefetch" href="/assets/js/71.970dda3c.js"><link rel="prefetch" href="/assets/js/72.a073c997.js"><link rel="prefetch" href="/assets/js/73.674106d1.js"><link rel="prefetch" href="/assets/js/74.a0336873.js"><link rel="prefetch" href="/assets/js/75.37fbb329.js"><link rel="prefetch" href="/assets/js/76.a9439343.js"><link rel="prefetch" href="/assets/js/77.d52439f1.js"><link rel="prefetch" href="/assets/js/78.fbffcd6c.js"><link rel="prefetch" href="/assets/js/79.c6d73001.js"><link rel="prefetch" href="/assets/js/8.f0af9f9c.js"><link rel="prefetch" href="/assets/js/80.eab87966.js"><link rel="prefetch" href="/assets/js/81.9931436f.js"><link rel="prefetch" href="/assets/js/82.b29080c9.js"><link rel="prefetch" href="/assets/js/83.d94ed517.js"><link rel="prefetch" href="/assets/js/84.600be30f.js"><link rel="prefetch" href="/assets/js/85.a6938cc3.js"><link rel="prefetch" href="/assets/js/86.7dec6ed4.js"><link rel="prefetch" href="/assets/js/87.5d2c1dc9.js"><link rel="prefetch" href="/assets/js/88.8f2410d4.js"><link rel="prefetch" href="/assets/js/89.fe8c04e8.js"><link rel="prefetch" href="/assets/js/9.f542ab97.js"><link rel="prefetch" href="/assets/js/90.f25166a8.js"><link rel="prefetch" href="/assets/js/91.038ee701.js"><link rel="prefetch" href="/assets/js/92.19e610e0.js"><link rel="prefetch" href="/assets/js/93.22cd83c8.js"><link rel="prefetch" href="/assets/js/94.7495cfa6.js"><link rel="prefetch" href="/assets/js/95.f149c41d.js"><link rel="prefetch" href="/assets/js/96.cee91e1f.js"><link rel="prefetch" href="/assets/js/97.27a1bb57.js"><link rel="prefetch" href="/assets/js/98.67d4f125.js"><link rel="prefetch" href="/assets/js/99.35daa60c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.685c010a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">匠心博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">博文</a></div><div class="nav-item"><a href="/book/index.html" class="nav-link">专栏</a></div><div class="nav-item"><a href="/note/index.html" class="nav-link">笔记</a></div><div class="nav-item"><a href="/nav/index.html" class="nav-link">导航</a></div><div class="nav-item"><a href="/about/index.html" class="nav-link">关于</a></div> <a href="https://github.com/zhaomenghuan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Angular 系列学习笔记（二）—— 基于 gulp 构建 Angular 单页面应用</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/learn-angular-gulp-spa.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/learn-angular-gulp-spa.html#gulp-基础入门" class="sidebar-link">gulp 基础入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learn-angular-gulp-spa.html#基本流程" class="sidebar-link">基本流程</a></li><li class="sidebar-sub-header"><a href="/blog/learn-angular-gulp-spa.html#gulpfile-js-配置说明" class="sidebar-link">gulpfile.js 配置说明</a></li></ul></li><li><a href="/blog/learn-angular-gulp-spa.html#项目结构" class="sidebar-link">项目结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/learn-angular-gulp-spa.html#ui-router-使用指南" class="sidebar-link">ui-router 使用指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learn-angular-gulp-spa.html#stateprovider" class="sidebar-link">$stateProvider</a></li><li class="sidebar-sub-header"><a href="/blog/learn-angular-gulp-spa.html#urlrouterprovider" class="sidebar-link">$urlRouterProvider</a></li></ul></li><li><a href="/blog/learn-angular-gulp-spa.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="angular-系列学习笔记（二）——-基于-gulp-构建-angular-单页面应用">Angular 系列学习笔记（二）—— 基于 gulp 构建 Angular 单页面应用</h1> <h2 id="前言">前言</h2> <p>构建打包工具之前一直是使用 webpack，由于公司这边是使用 gulp，为了和公司同步，私下还是要学习学习，毕竟懂点万一需要和老大交流也不至于说有啥问题，这篇文章将会以零基础的角度去写一下基于 gulp 搭建 angular 的工程，借这个机会顺便重构一下自己的博客。</p> <h2 id="gulp-基础入门">gulp 基础入门</h2> <p>在开工之前确保自己已经安装了 node 环境，没有安装的自行安装好 node，安装的时候默认会安装 npm 包管理器。安装好了通过下列的命令检查版本：</p> <div class="language-js extra-class"><pre class="language-js"><code>$ node <span class="token operator">-</span>v
v7<span class="token punctuation">.</span><span class="token number">5.0</span>
$ npm <span class="token operator">-</span>v
<span class="token number">4.1</span><span class="token number">.2</span>
</code></pre></div><p>然后看看 gulp 的文档和文章取取经开始我们今天的工作：</p> <ul><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener noreferrer">node 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">npm 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.gulpjs.com.cn/docs/getting-started/" target="_blank" rel="noopener noreferrer">gulp 中文网入门指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.w3ctech.com/topic/134" target="_blank" rel="noopener noreferrer">Gulp 开发教程（翻译）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="基本流程">基本流程</h3> <h4 id="创建-package-json-文件">创建 package.json 文件</h4> <p>新建一个文件夹开始，这里我以 zhaomenghuan-blog，然后然后命令行进入项目目录：</p> <div class="language-js extra-class"><pre class="language-js"><code># 创建 <span class="token keyword">package</span><span class="token punctuation">.</span>json 文件，直接一路回车就好
npm init
</code></pre></div><p>这是在创建一个 package.json 文件，定义了这个项目所需要的各种模块，以及项目的配置信息（比如名称、版本、许可证等元数据）。详细介绍可以看阮一峰老师的这篇文章：<a href="http://javascript.ruanyifeng.com/nodejs/packagejson.html" target="_blank" rel="noopener noreferrer">package.json 文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="安装-gulp">安装 gulp</h4> <p>全局安装 gulp</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install gulp <span class="token operator">-</span>g
</code></pre></div><p>作为项目的开发依赖（devDependencies）安装：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install gulp <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>这两者的区别可以看看这篇文章：<a href="http://zhaomenghuan.github.io/#!/blog/20161115" target="_blank" rel="noopener noreferrer">npm 常用命令详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。执行完这一步，目录下就多了一个 node_modules 文件夹，里面都是依赖的模块。一般来说，我们可能会在其它项目中使用的工具，如这里的 gulp 我们会先进行全局按照，这样会在本地有一个“仓库”，以后再用的时候直接下载到项目中岂可，避免每次不必要的下载等待。另外，dependencies 字段指定了项目运行所依赖的模块，devDependencies 指定项目开发所需要的模块。下载模块的时候注意区分，分清楚依赖模块的差异有助于我们后期优化代码，避免不必要的模块引入到项目最终源码中，造成代码打包过大的问题。</p> <h4 id="创建-gulpfile-js-文件">创建 gulpfile.js 文件</h4> <p>在项目根目录下创建一个名为 gulpfile.js 的文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将你的默认的任务代码放在这</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="运行-gulp">运行 gulp</h4> <div class="language-js extra-class"><pre class="language-js"><code>gulp 或 gulp <span class="token keyword">default</span>
</code></pre></div><p>默认的名为 default 的任务（task）将会被运行，在这里，这个任务并未做任何事情。想要单独执行特定的任务（task），请输入
<code>gulp &lt;task&gt; &lt;othertask&gt;</code>，例如在 gulpfile.js 里面添加如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后执行<code>gulp console</code>就会输入<code>hello gulp</code>。</p> <p>很显然我们通过一些命令就可以执行一下任务（task），那么接下来的重点就是写 task 相关的代码。</p> <h3 id="gulpfile-js-配置说明">gulpfile.js 配置说明</h3> <p>上面的流程只是对 gulp 基本流程入门，但是对于 gulp 的强大功能还没有直观的感觉，下面我们通过常用的几段配置看看配置的基本方法。需要说明的是，在使用插件之前我们都需要先安装相关的模块。</p> <h4 id="创建具有热更新的本地服务-——-browser-sync">创建具有热更新的本地服务 —— browser-sync</h4> <p>参考文档<a href="http://www.gulpjs.com.cn/docs/recipes/server-with-livereload-and-css-injection/" target="_blank" rel="noopener noreferrer">拥有实时重载（live-reloading）和 CSS 注入的服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这篇文章可知，使用  <a href="http://browsersync.io/" target="_blank" rel="noopener noreferrer">BrowserSync<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  和 gulp，你可以轻松地创建一个开发服务器，然后同一个 WiFi 中的任何设备都可以方便地访问到。BrowserSync 同时集成了 live-reload 所以不需要另外做配置了。</p> <p>安装 browser-sync 模块：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install browser<span class="token operator">-</span>sync <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>可以通过 gulp.watch 监听文件变动并且自动刷新，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-ruby-sass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> browserSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;browser-sync&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> reload <span class="token operator">=</span> browserSync<span class="token punctuation">.</span>reload<span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;sass&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">sass</span><span class="token punctuation">(</span><span class="token string">&quot;scss/styles.scss&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&quot;app/css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">stream</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监视 Sass 文件的改动，如果发生变更，运行 'sass' 任务，并且重载文件</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;serve&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;sass&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">browserSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">baseDir</span><span class="token operator">:</span> <span class="token string">&quot;app&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">&quot;app/scss/*.scss&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;sass&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="jade-模板文件转换为-html-文件-——-gulp-jade">Jade 模板文件转换为 HTML 文件 —— gulp-jade</h4> <p>我们可以通过 gulp-jade 插件将 jade 模板转成 html 文件，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">templates</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.jade&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dist</span><span class="token operator">:</span> <span class="token string">&quot;./app/&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&quot;./src/components/**/*.jade&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">dist</span><span class="token operator">:</span> <span class="token string">&quot;./app/components/&quot;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;templates&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  source<span class="token punctuation">.</span>templates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gulp
      <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">jade</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">pretty</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>dist<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">stream</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="less-文件转换成-css-文件-——-gulp-less">less 文件转换成 css 文件 —— gulp-less</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> less <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-less&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解析less</span>
<span class="token keyword">var</span> minifycss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-minify-css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 压缩css</span>
<span class="token keyword">var</span> uglify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-uglify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 压缩代码</span>
<span class="token keyword">var</span> concat <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-concat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 合并文件</span>

<span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;./src/index.less&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;./src/components/**/*.less&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;./src/pages/**/*.less&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;styles:source&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>styles<span class="token punctuation">)</span> <span class="token comment">// 压缩的文件</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">less</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">minifycss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 执行压缩</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;all.min.css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&quot;./app/css/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//输出到指定目录</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">stream</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="压缩图片——gulp-imagemin">压缩图片——gulp-imagemin</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> imagemin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-imagemin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图片压缩</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">images</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&quot;./src/assets/images/*&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dist</span><span class="token operator">:</span> <span class="token string">&quot;./app/assets/images&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>images<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">imagemin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">optimizationLevel</span><span class="token operator">:</span> <span class="token number">7</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>images<span class="token punctuation">.</span>dist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="从命令行传递参数设置项目开发模式">从命令行传递参数设置项目开发模式</h4> <p>项目开发环境下我们经常写很多<code>console.log</code>调试程序，在上线的时候我们又不想手动删除这些调试日志，这时候我们可以通过插件来完成。我们需要来配置两个环境：</p> <ul><li>DEV 模式：在开发环境中，为了方便 debug，JavaScript 通常不做压缩和混淆；</li> <li>PROD 模式：上生产环境时，JavaScript 必须并合压缩、混淆并成一个文件，同时需要去除所有的 log 输出语句。</li></ul> <p>我们可以通过命令行传递参数说明是什么模式，我们可以通过官方的例子<a href="http://www.gulpjs.com.cn/docs/recipes/pass-arguments-from-cli/" target="_blank" rel="noopener noreferrer">从命令行传递参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>学习如何使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// npm install --save-dev gulp gulp-if gulp-uglify minimist gulp-strip-debug</span>

<span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> gulpif <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-if&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> uglify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-uglify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> stripDebug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-strip-debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> minimist <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;minimist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> knownOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">string</span><span class="token operator">:</span> <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">env</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">||</span> <span class="token string">&quot;production&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token function">minimist</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> knownOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">&quot;**/*.js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">gulpif</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span> <span class="token function">uglify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 仅在生产环境时候进行压缩</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">gulpif</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span> <span class="token function">stripDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 去掉console.log</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>默认是 development 环境下，如果想使用 production 环境可以通过如下命令运行 gulp：</p> <div class="language-js extra-class"><pre class="language-js"><code>$ gulp scripts <span class="token operator">--</span>env development
</code></pre></div><p>每次在命令行输入参数容易出错，为了方便我们可以将脚本写在 package.json 中的 scripts 字段里面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gulp serve --env development&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gulp serve --env production&quot;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>然后执行<code>npm run dev</code>和<code>npm run build</code>命令就可以。</p> <p>对于新手而言，可能理解这个流程更重要，这个流程跑通了，接下来无非就是看文档入门了，关于 gulp 后文不再一步步赘述，而是直接给出 gulpfile.js 的代码。这里我们可以看出来 gulp 强大的功能得以实现，依赖于各种方便的插件，与 webpack 中提供的各种 loader 十分类似。可见要想完成各种负责的功能，需要对常用插件进行学习，我们可以通过这里的例子学习相关的插件使用方法：<a href="http://www.gulpjs.com.cn/docs/recipes/" target="_blank" rel="noopener noreferrer">gulp 技巧集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="项目结构">项目结构</h2> <p>上面的例子对于我们搭建一个基础工程足够了，下面我们通过一个实际例子来说明。</p> <p>项目结构：</p> <div class="language-js extra-class"><pre class="language-js"><code>├── node_modules <span class="token comment">// 打包过程中依赖的包</span>
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json <span class="token comment">// 包含各种所需模块以及项目的配置信息</span>
├── gulpfile<span class="token punctuation">.</span>js <span class="token comment">// 打包配置文件</span>
├── app <span class="token comment">// 打包之后最终部署到服务器上的文件（名称自定义）</span>
├── src  <span class="token comment">// 资源文件（名称自定义）</span>
   ├── components <span class="token comment">// 自定义全局组件</span>
       ├── pageloading （如：页面切换loading）
       <span class="token operator">...</span>
   ├── pages <span class="token comment">// 页面路由组件</span>
       ├── index
           ├── index<span class="token punctuation">.</span>jade 默认路由视图
           ├── index<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>js 默认路由控制器
           └── index<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js 默认视图路由配置
       ├── blog
       ···
   ├── assets <span class="token comment">// 静态资源</span>
       ├── images <span class="token comment">// 图片资源</span>
   ├── app<span class="token punctuation">.</span>module<span class="token punctuation">.</span>js <span class="token comment">// 全局模块</span>
   ├── index<span class="token punctuation">.</span>jade <span class="token comment">// 入口视图模板</span>
   └── index<span class="token punctuation">.</span>less <span class="token comment">// 入口视图样式</span>
└── vendor<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js <span class="token comment">// 依赖的库配置文件（自定义）</span>
</code></pre></div><p>本文工程地址：<a href="https://github.com/zhaomenghuan/learn-angular/tree/master/project/angular-material" target="_blank" rel="noopener noreferrer">learn-angular =&gt; angular-material<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="ui-router-使用指南">ui-router 使用指南</h2> <p>我们知道一个大型的单页面应用离不开路由，angular 自带了 ngRouter，但是我们常用的是 angularUI 的 ui-router，这是因为 UI-Router 有两个重要的特性：</p> <ul><li>多样化视图</li> <li>嵌入式视图</li></ul> <p>ui-router 支持多样化视图，并且每一个视图都有自己相应的控制，所以每个区块都是封装好，可以复用到整个应用程序需要的地方，这就意味着我们可以实现视图的复用和分治。ui-router 引进了状态机设计模式，抽象高于传统的路由。路由成了状态，URL 就成了状态的一个简单属性。</p> <p>对于 ui-router 最好的学习教程就是<a href="https://github.com/angular-ui/ui-router/wiki" target="_blank" rel="noopener noreferrer">ui-router 官方 wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我们下面会来讲解一下新手常见的几个问题。</p> <p>下载：</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install angular<span class="token operator">-</span>ui<span class="token operator">-</span>router <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><p>引入依赖:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;ui.router&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：是 ui.router 不是 ui-router!</p></blockquote> <h3 id="stateprovider">$stateProvider</h3> <blockquote><p>处理路由状态的服务，路由的状态反映了该项在应用程序中的位置，描述了在当前状态下 UI 是应该怎么样的，并且该做什么。</p></blockquote> <p><strong>依赖：</strong></p> <p><code>$urlRouterProvider $urlMatcherFactoryProvider</code></p> <blockquote><p>decorator(name,func)————通过内部的$stateProvider 以扩展或者重写状态生成器。可用于添加 ui-router 的自定义功能，例如，基于状态名称推断 templateUrl。</p></blockquote> <p><strong>警告：</strong> 因为生成器的函数执行顺序的不确定，decorator 不应该相互依赖。</p> <p><strong>参数：</strong></p> <ul><li>name：需要修改的生成函数名称。</li> <li>func：负责修改生成器函数的函数。</li></ul> <blockquote><p>state(name,stateConfig)————注册一个状态，并给定其配置。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>name：状态的名称。</li> <li>stateConfig：状态配置对象。配置具有以下各项属性：</li> <li>template： string/function，html 模板字符串，或者一个返回 html 模板字符串的函数；</li> <li>templateUrl：string/function，模板路径的字符串，或者返回模板路径字符串的函数；</li> <li>templateProvider：function，返回 html 模板字符串或模板路径的服务；</li> <li>controller：string/function，新注册一个控制器函数或者一个已注册的控制器的名称字符串；</li> <li>controllerProvider：function，返回控制器或者控制器名称的服务；</li> <li>controllerAs：string，控制器别名；</li> <li>parent：string/object，手动指定该状态的父级；</li> <li>resolve：object，将会被注入 controller 去执行的函数，<code>&lt;string,function&gt;</code> 形式。</li> <li>url：string，当前状态的对应 url；</li> <li>views：object，视图展示的配置，<code>&lt;string,object&gt;</code> 形式；</li> <li>abstract：boolean，一个永远不会被激活的抽象的状态，但可以给其子级提供特性的继承。默认是 true；</li> <li>onEnter：function，当进入一个状态后的回调函数；</li> <li>onExit：function，当退出一个状态后的回调函数；</li> <li>reloadOnSearch：boolean，如果为 false，那么当一个 search/query 参数改变时不会触发相同的状态，用于当你修改$location.search()的时候不想重新加载页面。默认为 true；</li> <li>data：object，任意对象数据，用于自定义配置。继承父级状态的 data 属性。换句话说，通过原型继承可以达到添加一个 data 数据从而整个树结构都能获取到；</li> <li>params：url 里的参数值，通过它可以实现页面间的参数传递。</li></ul> <h3 id="urlrouterprovider">$urlRouterProvider</h3> <blockquote><p>$urlRouterProvider 在这里有两个主要目的：一是建立一个默认路由，用于管理未知的 URL（统一跳转到某处）；二是监听浏览器地址栏 URL 的变化，重定向到路由定义的状态中。总之，$urlRouterProvider 让我们处理状态机抽象的$stateProvider 没有检测到的情况。</p></blockquote> <p>$urlRouterProvider 负责监听$location.当$location 变化的时候，$urlRouterProvider 开始在一个规则的列表中一个个的查找，直到找到匹配的值。$urlRouterProvider 用于在后端指定 url 的状态配置。所有的 url 被编译成 UrlMatcher 对象。</p> <p><strong>依赖：</strong></p> <p><code>$urlMatcherFactoryProvider $locationProvider</code></p> <blockquote><p>deferIntercept(defer)————禁用（或启用）延迟 location 变化的拦截。如果你想定制与 URL 同步的行为（例如，你需要保持当前的 URL 去并且推迟一个变化），那么在配置的时候使用这个方法。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>defer：boolean，确定是禁止还是启用该拦截。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;ui.router&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token string">&quot;$urlRouterProvider&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $urlRouterProvider<span class="token punctuation">.</span><span class="token function">deferIntercept</span><span class="token punctuation">(</span>defer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>otherwise(rule)————定义一个当请求的路径是无效路径时跳转的路径。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>rule：你想重定向的 url 路径或一个返回的网址路径的规则函数。函数传入两个参数：$injector 和$location 服务，而且必须返回一个 string 的 url。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;ui.router&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token string">&quot;$urlRouterProvider&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $urlRouterProvider<span class="token punctuation">.</span><span class="token function">otherwise</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rule = 重定向的url规则</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>rule(rule) ———— 定义使用$urlRouterProvider 来匹配指定的 URL 的规则。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>rule：将$injector 和$location 作为 arguments 传入的处理函数。用来返回一个 string 类型的 url 路径。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;ui.router&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token string">&quot;$urlRouterProvider&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$urlRouterProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $urlRouterProvider<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$injector<span class="token punctuation">,</span> $location</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> path <span class="token operator">=</span> $location<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        normalized <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">!==</span> normalized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> normalized<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>when(what,handler)————为给定的 URL 匹配注册一个处理程序。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>what：需要重定向的传入路径。</li> <li>handler：你想要重定向的路径/处理程序。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'Demo'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ui.router'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;$urlRouterProvider&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$urlRouterProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
$urlRouterProvider<span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span>$state<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$match<span class="token punctuation">,</span> $stateParams</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$state<span class="token punctuation">.</span>$current<span class="token punctuation">.</span>navigable <span class="token operator">!==</span> state <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">equalForKeys</span><span class="token punctuation">(</span><span class="token parameter">$match<span class="token punctuation">,</span> $stateParams</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $state<span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> $match<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="urlrouter">$urlRouter</h4> <p><strong>依赖：</strong></p> <p><code>$location $rootScope $injector $browser</code></p> <blockquote><p>href(urlMacther,params,options)————一个生成 URL 的方法，为给定的 UrlMatcher 返回编译后的 URL，并且用提供的参数填充。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>urlMacther：用于当作生成 URL 的模板的 UrlMacther 对象。</li> <li>params：一个参数值的对象用来填补所需的匹配参数。</li> <li>options：option 对象，absolute-boolean，如果为 true，将会生成一个绝对地址。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$bob <span class="token operator">=</span> $urlRouter<span class="token punctuation">.</span><span class="token function">href</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UrlMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/about/:person&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token string">&quot;bob&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// $bob == &quot;/about/bob&quot;;</span>
</code></pre></div><p>触发更新：发生在地址栏 URL 变化时执行相同的更新。</p> <h4 id="state">$state</h4> <blockquote><p>$state 服务负责代表状态及提供状态之间的转换。它还提供你当前的状态及上一个状态。</p></blockquote> <p><strong>依赖：</strong></p> <p><code>$rootScope $q $view $injector $resolve $stateParams $urlRouter</code></p> <blockquote><p>get(stateOrName,context)————返回任何指定的状态或所有状态的配置对象。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>stateOrName：如果提供此参数，返回的是指定状态的配置对象；如果不提供此参数，则返回全部状态的配置对象。</li> <li>context：当 context 是一个相对的参考状态，状态会在相关上下文中检索。</li></ul> <blockquote><p>go(to,params,options)</p></blockquote> <p><strong>参数：</strong></p> <ul><li>to：string，即将跳转的状态。</li> <li>params:object，跳转所带的参数。</li> <li>options：object，可选配置对象。有 location(是否更新地址栏的 url，或以什么字符串替换 url)，inherit(是否继承当前 url 的参数)，relative(当变化相对路径：如&quot;^,定义的状态是相对的)，notify(是否广播$stateChangeStart 和$stateChangeSuccess 事件)，reload(是否重新载入)。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$state<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">&quot;contact.detail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>href(stateOeName, params, options)————一个 URL 生成方法，返回为给定的状态填充指定的参数编译后的链接。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>stateOeName：string，你想要生成的 url 的状态或者状态对象。</li> <li>params：object，一个用于填充状态需要的参数的对象。</li> <li>options：可选配置对象。有 lossy(当第一个参数 url 未被提供时是否继承导航的 url 进行构建 href),inherit(是否继承当前 url 的参数),relative(当变化相对路径：如&quot;^,定义的状态是相对的),absolute(是否生成绝对 url)。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$state<span class="token punctuation">.</span><span class="token function">href</span><span class="token punctuation">(</span><span class="token string">&quot;about.person&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token string">&quot;bob&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>include(stateOrName,params,options)————一个确定当前有效的状态是不是与 stateOrName 平级的还是其子状态。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>stateOeName：string，部分名称，相对名称，或者通过当前状态进行全局模式查找。</li> <li>params：object，一个参数对象。</li> <li>options：可选配置对象。有 relative。</li></ul> <blockquote><p>is(stateOrName,params,options)————与$state.include 相似，只是这个针对的是全名。参数性质同上。</p></blockquote> <blockquote><p>reload(state)————重新载入当前状态的方法。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>state：一个状态名称或者状态对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$state<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token string">&quot;contact.detail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>transitionTo(to,toParams,options)————过渡到一个新状态的方法。</p></blockquote> <p><strong>参数：</strong></p> <ul><li>to：状态名称。</li> <li>toParams：将会发送到下一个状态的参数。</li> <li>options：可选参数。有 location，inherit，relative，notify，reload。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>$state<span class="token punctuation">.</span><span class="token function">transitionTo</span><span class="token punctuation">(</span>$state<span class="token punctuation">.</span>current<span class="token punctuation">,</span> $stateParams<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">reload</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">inherit</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">notify</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>**current：**获取当前路由</p> <blockquote><p>$stateChangeError————路由状态变化发生错误时触发的事件。</p></blockquote> <p><strong>参数：</strong>
event，toState，toParams，fromState，fromParams，error。</p> <blockquote><p>$stateChangeStart————路由状态变化发生前触发的事件。</p></blockquote> <p>**参数：**event，toState，toParams，fromState，fromParams。</p> <blockquote><p>$stateChangeSuccess————路由状态变化正确时触发的事件。</p></blockquote> <p>**参数：**event，toState，toParams，fromState，fromParams。</p> <p><strong>$stateNotFound：</strong>
路由状态没找到的时候触发的事件。</p> <p><strong>参数：</strong></p> <p>event，unfoundState，fromState，fromParams。</p> <h4 id="三种常用的方式激活路由状态">三种常用的方式激活路由状态</h4> <ul><li>$state.go()：优先级较高的便利方式</li> <li>ui-sref：点击包含此指令跳转</li> <li>url：url 导航</li></ul> <p>**ui-sref：**一种将链接（<code>&lt;a&gt;</code>标签）绑定到一个状态的指令。点击该链接将触发一个可以带有可选参数的状态转换。ui-sref 此指令必须绑定到<code>&lt;a&gt;</code>标签，如果该路由有对应的关联 URL，其通过 <code>$state.href()</code> 自动生成和更新 href 属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>a ui<span class="token operator">-</span>sref<span class="token operator">=</span><span class="token string">&quot;blog&quot;</span> ui<span class="token operator">-</span>sref<span class="token operator">-</span>active<span class="token operator">=</span><span class="token string">&quot;active&quot;</span><span class="token operator">&gt;</span>博客<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a ui<span class="token operator">-</span>sref<span class="token operator">=</span><span class="token string">&quot;blog({id: pageId})&quot;</span><span class="token operator">&gt;</span>博客<span class="token operator">-</span><span class="token number">2017</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</code></pre></div><p>ui-sref-active=&quot;active&quot; 该路由激活，则对应增加 active 样式名称，ui-sref-opts 传递参数。</p> <h4 id="html5-模式-or-hashbang">html5 模式 or Hashbang</h4> <p>$location 服务有两种用来控制地址栏 URL 格式的配置：Hashbang 模式（默认）和 HTML5 模式（使用 HTML5 历史 API）。应用会使用两种模式中相同的 API，并且$location 服务会使用需要的 URL 片段和浏览器 API 来帮助改变 URL 或者进行历史管理。</p> <p><img src="http://upload-images.jianshu.io/upload_images/1945738-78637b3f92e3df9c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="html5模式 or Hashbang"></p> <table><thead><tr><th style="text-align:center">对比</th> <th style="text-align:center">Hashbang 模式</th> <th style="text-align:center">HTML5 模式</th></tr></thead> <tbody><tr><td style="text-align:center">配置</td> <td style="text-align:center">默认</td> <td style="text-align:center">{ html5Mode: true }</td></tr> <tr><td style="text-align:center">URL 格式</td> <td style="text-align:center">所有浏览器都支持</td> <td style="text-align:center">hashbang URLs 在高级浏览器中使用 regular URLs，低级浏览器使用 hashbang URLs</td></tr> <tr><td style="text-align:center"><code>&lt;a href=&quot;&quot;&gt;</code> 链接重写</td> <td style="text-align:center">否</td> <td style="text-align:center">是</td></tr> <tr><td style="text-align:center">需要服务器端配置</td> <td style="text-align:center">否</td> <td style="text-align:center">是</td></tr></tbody></table> <blockquote><p>Hashbang 模式(默认 mode)</p></blockquote> <p>使用这个模式的话，$location 会在所有浏览器中使用 Hashbang URLs。</p> <div class="language-js extra-class"><pre class="language-js"><code>$locationProvider<span class="token punctuation">.</span>html5mode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
$locationProvider<span class="token punctuation">.</span>hashPrefix <span class="token operator">=</span> <span class="token string">&quot;!&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>支持网络爬虫</p> <p>你需要添加特别的 meta 标记在你的文档的头部才能支持对你的 AJAX 应用的索引。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;fragment&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;!&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>这能让网络爬虫请求带有<em>escaped_fragment</em>形式的参数链接，这样你就能识别爬虫并且返回一个 HTML 的快照了。</p> <blockquote><p>HTML5 模式</p></blockquote> <p>在 HTML5 模式中，$location 服务的读写器和浏览器的 URL 地址通过 HTML5 历史 API 交互，这使你能用 regular URL path 并且搜索各组成部分，和 hashbang 是等效的。 如果浏览器不支持 HTML5 历史 API， $location 服务会自动回退成使用 hashbang URLs。你就不用担心浏览器的支持性了。$location 服务总是会用最好的选择。</p> <p>在低级浏览器中使用了 regular URL -&gt; 重定向成 hashbang URL
在现代浏览器中打开了一个 hashbang URL -&gt; 重写成 regular URL</p> <div class="language-js extra-class"><pre class="language-js"><code>$locationProvider<span class="token punctuation">.</span>html5mode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>服务器端:</strong> 使用这种模式需要开启服务器端的 URL 重写功能，基本上你需要重写所有指向你应用的链接(如 index.html)。</p> <p><strong>相对链接:</strong> 记住要检查所有的相对连接、图片、脚本等。你必须指定你主页面的 <code>base url(&lt;base href=&quot;/my-base&quot;&gt;)</code>，或者你使用绝对路径也行，因为相对路径会结合文档的初始绝对路径转换成绝对路径。文档初始路径通常和应用的根路径不一样。</p> <h2 id="参考">参考</h2> <ul><li><a href="http://www.gulpjs.com.cn/docs/recipes/" target="_blank" rel="noopener noreferrer">gulp 技巧集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/angular-ui/ui-router/wiki/Quick-Reference" target="_blank" rel="noopener noreferrer">ui-router wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.jianshu.com/p/35c0acdea86c" target="_blank" rel="noopener noreferrer">UI-Router:为什么开发者都不喜欢 Angular.js 内置的路由<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/ys-ys/p/5052660.html" target="_blank" rel="noopener noreferrer">AngularJs ui-router 路由的简单介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.angularjs.cn/A00M" target="_blank" rel="noopener noreferrer">AngularJS 开发指南 27：使用$location<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div data-v-3bd334e8><p class="descript" data-v-3bd334e8>写这些代码也许就一两个小时的事，写一篇大家好接受的文章需要几天的酝酿，如果文章对您有帮助请我喝杯咖啡吧！</p> <img src="/supportme.png" class="pay-code" data-v-3bd334e8> <div data-v-3bd334e8><div id="container"></div></div> <div class="footer" data-v-4f0df4b0 data-v-3bd334e8><p data-v-4f0df4b0>站点总访问量： 站点总访客数：</p> <p data-v-4f0df4b0>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" data-v-4f0df4b0>知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></p> <p data-v-4f0df4b0>赵梦欢 © 2015 - 2023</p></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.f3e141ba.js" defer></script><script src="/assets/js/67.5cf5a3bc.js" defer></script><script src="/assets/js/18.c373a36e.js" defer></script><script src="/assets/js/34.124c31c0.js" defer></script>
  </body>
</html>
